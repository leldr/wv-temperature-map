{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar CollectionMode;\n(function (CollectionMode) {\n  CollectionMode[CollectionMode[\"key\"] = 0] = \"key\";\n  CollectionMode[CollectionMode[\"value\"] = 1] = \"value\";\n})(CollectionMode || (CollectionMode = {}));\nconst CONFIG = Object.freeze({\n  key: {\n    terminator: '=',\n    quotes: {}\n  },\n  value: {\n    terminator: ';',\n    quotes: {\n      '\"': '\"',\n      \"'\": \"'\",\n      '{': '}'\n    }\n  }\n});\nfunction connectionStringParser(connectionString, parserConfig = CONFIG) {\n  const parsed = {};\n  let collectionMode = CollectionMode.key;\n  let started = false;\n  let finished = false;\n  let quoted = false;\n  let quote = '';\n  let buffer = '';\n  let currentKey = '';\n  let pointer = 0;\n  function start() {\n    started = true;\n  }\n  function finish() {\n    finished = true;\n  }\n  function reset() {\n    started = false;\n    finished = false;\n    quoted = false;\n    quote = '';\n    buffer = '';\n  }\n  function config() {\n    return collectionMode === CollectionMode.key ? parserConfig.key : parserConfig.value;\n  }\n  function isTerminator(char) {\n    return config().terminator === char;\n  }\n  function isStartQuote(char) {\n    return Object.keys(config().quotes).some(val => char === val);\n  }\n  function isEndQuote(char) {\n    return quoted && char === config().quotes[quote];\n  }\n  function push(char) {\n    buffer += char;\n  }\n  function collect() {\n    if (!quoted) {\n      buffer = buffer.trim();\n    }\n    switch (collectionMode) {\n      case CollectionMode.key:\n        currentKey = buffer.toLowerCase();\n        collectionMode = CollectionMode.value;\n        break;\n      case CollectionMode.value:\n        collectionMode = CollectionMode.key;\n        parsed[currentKey] = buffer;\n        currentKey = '';\n        break;\n    }\n    reset();\n  }\n  while (pointer < connectionString.length) {\n    const current = connectionString.charAt(pointer);\n    if (!finished) {\n      if (!started) {\n        if (current.trim()) {\n          start();\n          if (isStartQuote(current)) {\n            quoted = true;\n            quote = current;\n          } else {\n            push(current);\n          }\n        }\n      } else {\n        if (quoted && isEndQuote(current)) {\n          const next = connectionString.charAt(pointer + 1);\n          if (current === next) {\n            push(current);\n            pointer++;\n          } else {\n            finish();\n          }\n        } else if (!quoted && isTerminator(current)) {\n          const next = connectionString.charAt(pointer + 1);\n          if (current === next) {\n            push(current);\n            pointer++;\n          } else {\n            collect();\n          }\n        } else {\n          push(current);\n        }\n      }\n    } else if (isTerminator(current)) {\n      collect();\n    } else if (current.trim()) {\n      throw new Error('Malformed connection string');\n    }\n    pointer++;\n  }\n  if (quoted && !finished) {\n    throw new Error('Connection string terminated unexpectedly');\n  } else {\n    collect();\n  }\n  return parsed;\n}\nexports.default = connectionStringParser;","map":{"version":3,"names":["CollectionMode","CONFIG","Object","freeze","key","terminator","quotes","value","connectionStringParser","connectionString","parserConfig","parsed","collectionMode","started","finished","quoted","quote","buffer","currentKey","pointer","start","finish","reset","config","isTerminator","char","isStartQuote","keys","some","val","isEndQuote","push","collect","trim","toLowerCase","length","current","charAt","next","Error","exports","default"],"sources":["../../src/parser/connection-string.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}