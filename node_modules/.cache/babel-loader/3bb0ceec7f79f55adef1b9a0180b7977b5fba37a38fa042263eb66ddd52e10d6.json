{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\nvar _os = _interopRequireDefault(require(\"os\"));\nvar tls = _interopRequireWildcard(require(\"tls\"));\nvar net = _interopRequireWildcard(require(\"net\"));\nvar _dns = _interopRequireDefault(require(\"dns\"));\nvar _constants = _interopRequireDefault(require(\"constants\"));\nvar _stream = require(\"stream\");\nvar _identity = require(\"@azure/identity\");\nvar _coreAuth = require(\"@azure/core-auth\");\nvar _bulkLoad = _interopRequireDefault(require(\"./bulk-load\"));\nvar _debug = _interopRequireDefault(require(\"./debug\"));\nvar _events = require(\"events\");\nvar _instanceLookup = require(\"./instance-lookup\");\nvar _transientErrorLookup = require(\"./transient-error-lookup\");\nvar _packet = require(\"./packet\");\nvar _preloginPayload = _interopRequireDefault(require(\"./prelogin-payload\"));\nvar _login7Payload = _interopRequireDefault(require(\"./login7-payload\"));\nvar _ntlmPayload = _interopRequireDefault(require(\"./ntlm-payload\"));\nvar _request = _interopRequireDefault(require(\"./request\"));\nvar _rpcrequestPayload = _interopRequireDefault(require(\"./rpcrequest-payload\"));\nvar _sqlbatchPayload = _interopRequireDefault(require(\"./sqlbatch-payload\"));\nvar _messageIo = _interopRequireDefault(require(\"./message-io\"));\nvar _tokenStreamParser = require(\"./token/token-stream-parser\");\nvar _transaction = require(\"./transaction\");\nvar _errors = require(\"./errors\");\nvar _connector = require(\"./connector\");\nvar _library = require(\"./library\");\nvar _tdsVersions = require(\"./tds-versions\");\nvar _message = _interopRequireDefault(require(\"./message\"));\nvar _ntlm = require(\"./ntlm\");\nvar _dataType = require(\"./data-type\");\nvar _bulkLoadPayload = require(\"./bulk-load-payload\");\nvar _specialStoredProcedure = _interopRequireDefault(require(\"./special-stored-procedure\"));\nvar _package = require(\"../package.json\");\nvar _url = require(\"url\");\nvar _handler = require(\"./token/handler\");\nfunction _getRequireWildcardCache(e) {\n  if (\"function\" != typeof WeakMap) return null;\n  var r = new WeakMap(),\n    t = new WeakMap();\n  return (_getRequireWildcardCache = function (e) {\n    return e ? t : r;\n  })(e);\n}\nfunction _interopRequireWildcard(e, r) {\n  if (!r && e && e.__esModule) return e;\n  if (null === e || \"object\" != typeof e && \"function\" != typeof e) return {\n    default: e\n  };\n  var t = _getRequireWildcardCache(r);\n  if (t && t.has(e)) return t.get(e);\n  var n = {\n      __proto__: null\n    },\n    a = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var u in e) if (\"default\" !== u && Object.prototype.hasOwnProperty.call(e, u)) {\n    var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;\n    i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];\n  }\n  return n.default = e, t && t.set(e, n), n;\n}\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n/**\n * @private\n */\nconst KEEP_ALIVE_INITIAL_DELAY = 30 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CONNECT_TIMEOUT = 15 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CLIENT_REQUEST_TIMEOUT = 15 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CANCEL_TIMEOUT = 5 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CONNECT_RETRY_INTERVAL = 500;\n/**\n * @private\n */\nconst DEFAULT_PACKET_SIZE = 4 * 1024;\n/**\n * @private\n */\nconst DEFAULT_TEXTSIZE = 2147483647;\n/**\n * @private\n */\nconst DEFAULT_DATEFIRST = 7;\n/**\n * @private\n */\nconst DEFAULT_PORT = 1433;\n/**\n * @private\n */\nconst DEFAULT_TDS_VERSION = '7_4';\n/**\n * @private\n */\nconst DEFAULT_LANGUAGE = 'us_english';\n/**\n * @private\n */\nconst DEFAULT_DATEFORMAT = 'mdy';\n\n/** Structure that defines the options that are necessary to authenticate the Tedious.JS instance with an `@azure/identity` token credential. */\n\n/**\n * @private\n */\n\n/**\n * @private\n */\nconst CLEANUP_TYPE = {\n  NORMAL: 0,\n  REDIRECT: 1,\n  RETRY: 2\n};\n/**\n * A [[Connection]] instance represents a single connection to a database server.\n *\n * ```js\n * var Connection = require('tedious').Connection;\n * var config = {\n *  \"authentication\": {\n *    ...,\n *    \"options\": {...}\n *  },\n *  \"options\": {...}\n * };\n * var connection = new Connection(config);\n * ```\n *\n * Only one request at a time may be executed on a connection. Once a [[Request]]\n * has been initiated (with [[Connection.callProcedure]], [[Connection.execSql]],\n * or [[Connection.execSqlBatch]]), another should not be initiated until the\n * [[Request]]'s completion callback is called.\n */\nclass Connection extends _events.EventEmitter {\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * Note: be aware of the different options field:\n   * 1. config.authentication.options\n   * 2. config.options\n   *\n   * ```js\n   * const { Connection } = require('tedious');\n   *\n   * const config = {\n   *  \"authentication\": {\n   *    ...,\n   *    \"options\": {...}\n   *  },\n   *  \"options\": {...}\n   * };\n   *\n   * const connection = new Connection(config);\n   * ```\n   *\n   * @param config\n   */\n  constructor(config) {\n    super();\n    if (typeof config !== 'object' || config === null) {\n      throw new TypeError('The \"config\" argument is required and must be of type Object.');\n    }\n    if (typeof config.server !== 'string') {\n      throw new TypeError('The \"config.server\" property is required and must be of type string.');\n    }\n    this.fedAuthRequired = false;\n    let authentication;\n    if (config.authentication !== undefined) {\n      if (typeof config.authentication !== 'object' || config.authentication === null) {\n        throw new TypeError('The \"config.authentication\" property must be of type Object.');\n      }\n      const type = config.authentication.type;\n      const options = config.authentication.options === undefined ? {} : config.authentication.options;\n      if (typeof type !== 'string') {\n        throw new TypeError('The \"config.authentication.type\" property must be of type string.');\n      }\n      if (type !== 'default' && type !== 'ntlm' && type !== 'token-credential' && type !== 'azure-active-directory-password' && type !== 'azure-active-directory-access-token' && type !== 'azure-active-directory-msi-vm' && type !== 'azure-active-directory-msi-app-service' && type !== 'azure-active-directory-service-principal-secret' && type !== 'azure-active-directory-default') {\n        throw new TypeError('The \"type\" property must one of \"default\", \"ntlm\", \"token-credential\", \"azure-active-directory-password\", \"azure-active-directory-access-token\", \"azure-active-directory-default\", \"azure-active-directory-msi-vm\" or \"azure-active-directory-msi-app-service\" or \"azure-active-directory-service-principal-secret\".');\n      }\n      if (typeof options !== 'object' || options === null) {\n        throw new TypeError('The \"config.authentication.options\" property must be of type object.');\n      }\n      if (type === 'ntlm') {\n        if (typeof options.domain !== 'string') {\n          throw new TypeError('The \"config.authentication.options.domain\" property must be of type string.');\n        }\n        if (options.userName !== undefined && typeof options.userName !== 'string') {\n          throw new TypeError('The \"config.authentication.options.userName\" property must be of type string.');\n        }\n        if (options.password !== undefined && typeof options.password !== 'string') {\n          throw new TypeError('The \"config.authentication.options.password\" property must be of type string.');\n        }\n        authentication = {\n          type: 'ntlm',\n          options: {\n            userName: options.userName,\n            password: options.password,\n            domain: options.domain && options.domain.toUpperCase()\n          }\n        };\n      } else if (type === 'token-credential') {\n        if (!(0, _coreAuth.isTokenCredential)(options.credential)) {\n          throw new TypeError('The \"config.authentication.options.credential\" property must be an instance of the token credential class.');\n        }\n        authentication = {\n          type: 'token-credential',\n          options: {\n            credential: options.credential\n          }\n        };\n      } else if (type === 'azure-active-directory-password') {\n        if (typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n        if (options.userName !== undefined && typeof options.userName !== 'string') {\n          throw new TypeError('The \"config.authentication.options.userName\" property must be of type string.');\n        }\n        if (options.password !== undefined && typeof options.password !== 'string') {\n          throw new TypeError('The \"config.authentication.options.password\" property must be of type string.');\n        }\n        if (options.tenantId !== undefined && typeof options.tenantId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.tenantId\" property must be of type string.');\n        }\n        authentication = {\n          type: 'azure-active-directory-password',\n          options: {\n            userName: options.userName,\n            password: options.password,\n            tenantId: options.tenantId,\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-access-token') {\n        if (typeof options.token !== 'string') {\n          throw new TypeError('The \"config.authentication.options.token\" property must be of type string.');\n        }\n        authentication = {\n          type: 'azure-active-directory-access-token',\n          options: {\n            token: options.token\n          }\n        };\n      } else if (type === 'azure-active-directory-msi-vm') {\n        if (options.clientId !== undefined && typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n        authentication = {\n          type: 'azure-active-directory-msi-vm',\n          options: {\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-default') {\n        if (options.clientId !== undefined && typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n        authentication = {\n          type: 'azure-active-directory-default',\n          options: {\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-msi-app-service') {\n        if (options.clientId !== undefined && typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n        authentication = {\n          type: 'azure-active-directory-msi-app-service',\n          options: {\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-service-principal-secret') {\n        if (typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n        if (typeof options.clientSecret !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientSecret\" property must be of type string.');\n        }\n        if (typeof options.tenantId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.tenantId\" property must be of type string.');\n        }\n        authentication = {\n          type: 'azure-active-directory-service-principal-secret',\n          options: {\n            clientId: options.clientId,\n            clientSecret: options.clientSecret,\n            tenantId: options.tenantId\n          }\n        };\n      } else {\n        if (options.userName !== undefined && typeof options.userName !== 'string') {\n          throw new TypeError('The \"config.authentication.options.userName\" property must be of type string.');\n        }\n        if (options.password !== undefined && typeof options.password !== 'string') {\n          throw new TypeError('The \"config.authentication.options.password\" property must be of type string.');\n        }\n        authentication = {\n          type: 'default',\n          options: {\n            userName: options.userName,\n            password: options.password\n          }\n        };\n      }\n    } else {\n      authentication = {\n        type: 'default',\n        options: {\n          userName: undefined,\n          password: undefined\n        }\n      };\n    }\n    this.config = {\n      server: config.server,\n      authentication: authentication,\n      options: {\n        abortTransactionOnError: false,\n        appName: undefined,\n        camelCaseColumns: false,\n        cancelTimeout: DEFAULT_CANCEL_TIMEOUT,\n        columnEncryptionKeyCacheTTL: 2 * 60 * 60 * 1000,\n        // Units: milliseconds\n        columnEncryptionSetting: false,\n        columnNameReplacer: undefined,\n        connectionRetryInterval: DEFAULT_CONNECT_RETRY_INTERVAL,\n        connectTimeout: DEFAULT_CONNECT_TIMEOUT,\n        connector: undefined,\n        connectionIsolationLevel: _transaction.ISOLATION_LEVEL.READ_COMMITTED,\n        cryptoCredentialsDetails: {},\n        database: undefined,\n        datefirst: DEFAULT_DATEFIRST,\n        dateFormat: DEFAULT_DATEFORMAT,\n        debug: {\n          data: false,\n          packet: false,\n          payload: false,\n          token: false\n        },\n        enableAnsiNull: true,\n        enableAnsiNullDefault: true,\n        enableAnsiPadding: true,\n        enableAnsiWarnings: true,\n        enableArithAbort: true,\n        enableConcatNullYieldsNull: true,\n        enableCursorCloseOnCommit: null,\n        enableImplicitTransactions: false,\n        enableNumericRoundabort: false,\n        enableQuotedIdentifier: true,\n        encrypt: true,\n        fallbackToDefaultDb: false,\n        encryptionKeyStoreProviders: undefined,\n        instanceName: undefined,\n        isolationLevel: _transaction.ISOLATION_LEVEL.READ_COMMITTED,\n        language: DEFAULT_LANGUAGE,\n        localAddress: undefined,\n        maxRetriesOnTransientErrors: 3,\n        multiSubnetFailover: false,\n        packetSize: DEFAULT_PACKET_SIZE,\n        port: DEFAULT_PORT,\n        readOnlyIntent: false,\n        requestTimeout: DEFAULT_CLIENT_REQUEST_TIMEOUT,\n        rowCollectionOnDone: false,\n        rowCollectionOnRequestCompletion: false,\n        serverName: undefined,\n        serverSupportsColumnEncryption: false,\n        tdsVersion: DEFAULT_TDS_VERSION,\n        textsize: DEFAULT_TEXTSIZE,\n        trustedServerNameAE: undefined,\n        trustServerCertificate: false,\n        useColumnNames: false,\n        useUTC: true,\n        workstationId: undefined,\n        lowerCaseGuids: false\n      }\n    };\n    if (config.options) {\n      if (config.options.port && config.options.instanceName) {\n        throw new Error('Port and instanceName are mutually exclusive, but ' + config.options.port + ' and ' + config.options.instanceName + ' provided');\n      }\n      if (config.options.abortTransactionOnError !== undefined) {\n        if (typeof config.options.abortTransactionOnError !== 'boolean' && config.options.abortTransactionOnError !== null) {\n          throw new TypeError('The \"config.options.abortTransactionOnError\" property must be of type string or null.');\n        }\n        this.config.options.abortTransactionOnError = config.options.abortTransactionOnError;\n      }\n      if (config.options.appName !== undefined) {\n        if (typeof config.options.appName !== 'string') {\n          throw new TypeError('The \"config.options.appName\" property must be of type string.');\n        }\n        this.config.options.appName = config.options.appName;\n      }\n      if (config.options.camelCaseColumns !== undefined) {\n        if (typeof config.options.camelCaseColumns !== 'boolean') {\n          throw new TypeError('The \"config.options.camelCaseColumns\" property must be of type boolean.');\n        }\n        this.config.options.camelCaseColumns = config.options.camelCaseColumns;\n      }\n      if (config.options.cancelTimeout !== undefined) {\n        if (typeof config.options.cancelTimeout !== 'number') {\n          throw new TypeError('The \"config.options.cancelTimeout\" property must be of type number.');\n        }\n        this.config.options.cancelTimeout = config.options.cancelTimeout;\n      }\n      if (config.options.columnNameReplacer) {\n        if (typeof config.options.columnNameReplacer !== 'function') {\n          throw new TypeError('The \"config.options.cancelTimeout\" property must be of type function.');\n        }\n        this.config.options.columnNameReplacer = config.options.columnNameReplacer;\n      }\n      if (config.options.connectionIsolationLevel !== undefined) {\n        (0, _transaction.assertValidIsolationLevel)(config.options.connectionIsolationLevel, 'config.options.connectionIsolationLevel');\n        this.config.options.connectionIsolationLevel = config.options.connectionIsolationLevel;\n      }\n      if (config.options.connectTimeout !== undefined) {\n        if (typeof config.options.connectTimeout !== 'number') {\n          throw new TypeError('The \"config.options.connectTimeout\" property must be of type number.');\n        }\n        this.config.options.connectTimeout = config.options.connectTimeout;\n      }\n      if (config.options.connector !== undefined) {\n        if (typeof config.options.connector !== 'function') {\n          throw new TypeError('The \"config.options.connector\" property must be a function.');\n        }\n        this.config.options.connector = config.options.connector;\n      }\n      if (config.options.cryptoCredentialsDetails !== undefined) {\n        if (typeof config.options.cryptoCredentialsDetails !== 'object' || config.options.cryptoCredentialsDetails === null) {\n          throw new TypeError('The \"config.options.cryptoCredentialsDetails\" property must be of type Object.');\n        }\n        this.config.options.cryptoCredentialsDetails = config.options.cryptoCredentialsDetails;\n      }\n      if (config.options.database !== undefined) {\n        if (typeof config.options.database !== 'string') {\n          throw new TypeError('The \"config.options.database\" property must be of type string.');\n        }\n        this.config.options.database = config.options.database;\n      }\n      if (config.options.datefirst !== undefined) {\n        if (typeof config.options.datefirst !== 'number' && config.options.datefirst !== null) {\n          throw new TypeError('The \"config.options.datefirst\" property must be of type number.');\n        }\n        if (config.options.datefirst !== null && (config.options.datefirst < 1 || config.options.datefirst > 7)) {\n          throw new RangeError('The \"config.options.datefirst\" property must be >= 1 and <= 7');\n        }\n        this.config.options.datefirst = config.options.datefirst;\n      }\n      if (config.options.dateFormat !== undefined) {\n        if (typeof config.options.dateFormat !== 'string' && config.options.dateFormat !== null) {\n          throw new TypeError('The \"config.options.dateFormat\" property must be of type string or null.');\n        }\n        this.config.options.dateFormat = config.options.dateFormat;\n      }\n      if (config.options.debug) {\n        if (config.options.debug.data !== undefined) {\n          if (typeof config.options.debug.data !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.data\" property must be of type boolean.');\n          }\n          this.config.options.debug.data = config.options.debug.data;\n        }\n        if (config.options.debug.packet !== undefined) {\n          if (typeof config.options.debug.packet !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.packet\" property must be of type boolean.');\n          }\n          this.config.options.debug.packet = config.options.debug.packet;\n        }\n        if (config.options.debug.payload !== undefined) {\n          if (typeof config.options.debug.payload !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.payload\" property must be of type boolean.');\n          }\n          this.config.options.debug.payload = config.options.debug.payload;\n        }\n        if (config.options.debug.token !== undefined) {\n          if (typeof config.options.debug.token !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.token\" property must be of type boolean.');\n          }\n          this.config.options.debug.token = config.options.debug.token;\n        }\n      }\n      if (config.options.enableAnsiNull !== undefined) {\n        if (typeof config.options.enableAnsiNull !== 'boolean' && config.options.enableAnsiNull !== null) {\n          throw new TypeError('The \"config.options.enableAnsiNull\" property must be of type boolean or null.');\n        }\n        this.config.options.enableAnsiNull = config.options.enableAnsiNull;\n      }\n      if (config.options.enableAnsiNullDefault !== undefined) {\n        if (typeof config.options.enableAnsiNullDefault !== 'boolean' && config.options.enableAnsiNullDefault !== null) {\n          throw new TypeError('The \"config.options.enableAnsiNullDefault\" property must be of type boolean or null.');\n        }\n        this.config.options.enableAnsiNullDefault = config.options.enableAnsiNullDefault;\n      }\n      if (config.options.enableAnsiPadding !== undefined) {\n        if (typeof config.options.enableAnsiPadding !== 'boolean' && config.options.enableAnsiPadding !== null) {\n          throw new TypeError('The \"config.options.enableAnsiPadding\" property must be of type boolean or null.');\n        }\n        this.config.options.enableAnsiPadding = config.options.enableAnsiPadding;\n      }\n      if (config.options.enableAnsiWarnings !== undefined) {\n        if (typeof config.options.enableAnsiWarnings !== 'boolean' && config.options.enableAnsiWarnings !== null) {\n          throw new TypeError('The \"config.options.enableAnsiWarnings\" property must be of type boolean or null.');\n        }\n        this.config.options.enableAnsiWarnings = config.options.enableAnsiWarnings;\n      }\n      if (config.options.enableArithAbort !== undefined) {\n        if (typeof config.options.enableArithAbort !== 'boolean' && config.options.enableArithAbort !== null) {\n          throw new TypeError('The \"config.options.enableArithAbort\" property must be of type boolean or null.');\n        }\n        this.config.options.enableArithAbort = config.options.enableArithAbort;\n      }\n      if (config.options.enableConcatNullYieldsNull !== undefined) {\n        if (typeof config.options.enableConcatNullYieldsNull !== 'boolean' && config.options.enableConcatNullYieldsNull !== null) {\n          throw new TypeError('The \"config.options.enableConcatNullYieldsNull\" property must be of type boolean or null.');\n        }\n        this.config.options.enableConcatNullYieldsNull = config.options.enableConcatNullYieldsNull;\n      }\n      if (config.options.enableCursorCloseOnCommit !== undefined) {\n        if (typeof config.options.enableCursorCloseOnCommit !== 'boolean' && config.options.enableCursorCloseOnCommit !== null) {\n          throw new TypeError('The \"config.options.enableCursorCloseOnCommit\" property must be of type boolean or null.');\n        }\n        this.config.options.enableCursorCloseOnCommit = config.options.enableCursorCloseOnCommit;\n      }\n      if (config.options.enableImplicitTransactions !== undefined) {\n        if (typeof config.options.enableImplicitTransactions !== 'boolean' && config.options.enableImplicitTransactions !== null) {\n          throw new TypeError('The \"config.options.enableImplicitTransactions\" property must be of type boolean or null.');\n        }\n        this.config.options.enableImplicitTransactions = config.options.enableImplicitTransactions;\n      }\n      if (config.options.enableNumericRoundabort !== undefined) {\n        if (typeof config.options.enableNumericRoundabort !== 'boolean' && config.options.enableNumericRoundabort !== null) {\n          throw new TypeError('The \"config.options.enableNumericRoundabort\" property must be of type boolean or null.');\n        }\n        this.config.options.enableNumericRoundabort = config.options.enableNumericRoundabort;\n      }\n      if (config.options.enableQuotedIdentifier !== undefined) {\n        if (typeof config.options.enableQuotedIdentifier !== 'boolean' && config.options.enableQuotedIdentifier !== null) {\n          throw new TypeError('The \"config.options.enableQuotedIdentifier\" property must be of type boolean or null.');\n        }\n        this.config.options.enableQuotedIdentifier = config.options.enableQuotedIdentifier;\n      }\n      if (config.options.encrypt !== undefined) {\n        if (typeof config.options.encrypt !== 'boolean') {\n          if (config.options.encrypt !== 'strict') {\n            throw new TypeError('The \"encrypt\" property must be set to \"strict\", or of type boolean.');\n          }\n        }\n        this.config.options.encrypt = config.options.encrypt;\n      }\n      if (config.options.fallbackToDefaultDb !== undefined) {\n        if (typeof config.options.fallbackToDefaultDb !== 'boolean') {\n          throw new TypeError('The \"config.options.fallbackToDefaultDb\" property must be of type boolean.');\n        }\n        this.config.options.fallbackToDefaultDb = config.options.fallbackToDefaultDb;\n      }\n      if (config.options.instanceName !== undefined) {\n        if (typeof config.options.instanceName !== 'string') {\n          throw new TypeError('The \"config.options.instanceName\" property must be of type string.');\n        }\n        this.config.options.instanceName = config.options.instanceName;\n        this.config.options.port = undefined;\n      }\n      if (config.options.isolationLevel !== undefined) {\n        (0, _transaction.assertValidIsolationLevel)(config.options.isolationLevel, 'config.options.isolationLevel');\n        this.config.options.isolationLevel = config.options.isolationLevel;\n      }\n      if (config.options.language !== undefined) {\n        if (typeof config.options.language !== 'string' && config.options.language !== null) {\n          throw new TypeError('The \"config.options.language\" property must be of type string or null.');\n        }\n        this.config.options.language = config.options.language;\n      }\n      if (config.options.localAddress !== undefined) {\n        if (typeof config.options.localAddress !== 'string') {\n          throw new TypeError('The \"config.options.localAddress\" property must be of type string.');\n        }\n        this.config.options.localAddress = config.options.localAddress;\n      }\n      if (config.options.multiSubnetFailover !== undefined) {\n        if (typeof config.options.multiSubnetFailover !== 'boolean') {\n          throw new TypeError('The \"config.options.multiSubnetFailover\" property must be of type boolean.');\n        }\n        this.config.options.multiSubnetFailover = config.options.multiSubnetFailover;\n      }\n      if (config.options.packetSize !== undefined) {\n        if (typeof config.options.packetSize !== 'number') {\n          throw new TypeError('The \"config.options.packetSize\" property must be of type number.');\n        }\n        this.config.options.packetSize = config.options.packetSize;\n      }\n      if (config.options.port !== undefined) {\n        if (typeof config.options.port !== 'number') {\n          throw new TypeError('The \"config.options.port\" property must be of type number.');\n        }\n        if (config.options.port <= 0 || config.options.port >= 65536) {\n          throw new RangeError('The \"config.options.port\" property must be > 0 and < 65536');\n        }\n        this.config.options.port = config.options.port;\n        this.config.options.instanceName = undefined;\n      }\n      if (config.options.readOnlyIntent !== undefined) {\n        if (typeof config.options.readOnlyIntent !== 'boolean') {\n          throw new TypeError('The \"config.options.readOnlyIntent\" property must be of type boolean.');\n        }\n        this.config.options.readOnlyIntent = config.options.readOnlyIntent;\n      }\n      if (config.options.requestTimeout !== undefined) {\n        if (typeof config.options.requestTimeout !== 'number') {\n          throw new TypeError('The \"config.options.requestTimeout\" property must be of type number.');\n        }\n        this.config.options.requestTimeout = config.options.requestTimeout;\n      }\n      if (config.options.maxRetriesOnTransientErrors !== undefined) {\n        if (typeof config.options.maxRetriesOnTransientErrors !== 'number') {\n          throw new TypeError('The \"config.options.maxRetriesOnTransientErrors\" property must be of type number.');\n        }\n        if (config.options.maxRetriesOnTransientErrors < 0) {\n          throw new TypeError('The \"config.options.maxRetriesOnTransientErrors\" property must be equal or greater than 0.');\n        }\n        this.config.options.maxRetriesOnTransientErrors = config.options.maxRetriesOnTransientErrors;\n      }\n      if (config.options.connectionRetryInterval !== undefined) {\n        if (typeof config.options.connectionRetryInterval !== 'number') {\n          throw new TypeError('The \"config.options.connectionRetryInterval\" property must be of type number.');\n        }\n        if (config.options.connectionRetryInterval <= 0) {\n          throw new TypeError('The \"config.options.connectionRetryInterval\" property must be greater than 0.');\n        }\n        this.config.options.connectionRetryInterval = config.options.connectionRetryInterval;\n      }\n      if (config.options.rowCollectionOnDone !== undefined) {\n        if (typeof config.options.rowCollectionOnDone !== 'boolean') {\n          throw new TypeError('The \"config.options.rowCollectionOnDone\" property must be of type boolean.');\n        }\n        this.config.options.rowCollectionOnDone = config.options.rowCollectionOnDone;\n      }\n      if (config.options.rowCollectionOnRequestCompletion !== undefined) {\n        if (typeof config.options.rowCollectionOnRequestCompletion !== 'boolean') {\n          throw new TypeError('The \"config.options.rowCollectionOnRequestCompletion\" property must be of type boolean.');\n        }\n        this.config.options.rowCollectionOnRequestCompletion = config.options.rowCollectionOnRequestCompletion;\n      }\n      if (config.options.tdsVersion !== undefined) {\n        if (typeof config.options.tdsVersion !== 'string') {\n          throw new TypeError('The \"config.options.tdsVersion\" property must be of type string.');\n        }\n        this.config.options.tdsVersion = config.options.tdsVersion;\n      }\n      if (config.options.textsize !== undefined) {\n        if (typeof config.options.textsize !== 'number' && config.options.textsize !== null) {\n          throw new TypeError('The \"config.options.textsize\" property must be of type number or null.');\n        }\n        if (config.options.textsize > 2147483647) {\n          throw new TypeError('The \"config.options.textsize\" can\\'t be greater than 2147483647.');\n        } else if (config.options.textsize < -1) {\n          throw new TypeError('The \"config.options.textsize\" can\\'t be smaller than -1.');\n        }\n        this.config.options.textsize = config.options.textsize | 0;\n      }\n      if (config.options.trustServerCertificate !== undefined) {\n        if (typeof config.options.trustServerCertificate !== 'boolean') {\n          throw new TypeError('The \"config.options.trustServerCertificate\" property must be of type boolean.');\n        }\n        this.config.options.trustServerCertificate = config.options.trustServerCertificate;\n      }\n      if (config.options.serverName !== undefined) {\n        if (typeof config.options.serverName !== 'string') {\n          throw new TypeError('The \"config.options.serverName\" property must be of type string.');\n        }\n        this.config.options.serverName = config.options.serverName;\n      }\n      if (config.options.useColumnNames !== undefined) {\n        if (typeof config.options.useColumnNames !== 'boolean') {\n          throw new TypeError('The \"config.options.useColumnNames\" property must be of type boolean.');\n        }\n        this.config.options.useColumnNames = config.options.useColumnNames;\n      }\n      if (config.options.useUTC !== undefined) {\n        if (typeof config.options.useUTC !== 'boolean') {\n          throw new TypeError('The \"config.options.useUTC\" property must be of type boolean.');\n        }\n        this.config.options.useUTC = config.options.useUTC;\n      }\n      if (config.options.workstationId !== undefined) {\n        if (typeof config.options.workstationId !== 'string') {\n          throw new TypeError('The \"config.options.workstationId\" property must be of type string.');\n        }\n        this.config.options.workstationId = config.options.workstationId;\n      }\n      if (config.options.lowerCaseGuids !== undefined) {\n        if (typeof config.options.lowerCaseGuids !== 'boolean') {\n          throw new TypeError('The \"config.options.lowerCaseGuids\" property must be of type boolean.');\n        }\n        this.config.options.lowerCaseGuids = config.options.lowerCaseGuids;\n      }\n    }\n    this.secureContextOptions = this.config.options.cryptoCredentialsDetails;\n    if (this.secureContextOptions.secureOptions === undefined) {\n      // If the caller has not specified their own `secureOptions`,\n      // we set `SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS` here.\n      // Older SQL Server instances running on older Windows versions have\n      // trouble with the BEAST workaround in OpenSSL.\n      // As BEAST is a browser specific exploit, we can just disable this option here.\n      this.secureContextOptions = Object.create(this.secureContextOptions, {\n        secureOptions: {\n          value: _constants.default.SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS\n        }\n      });\n    }\n    this.debug = this.createDebug();\n    this.inTransaction = false;\n    this.transactionDescriptors = [Buffer.from([0, 0, 0, 0, 0, 0, 0, 0])];\n\n    // 'beginTransaction', 'commitTransaction' and 'rollbackTransaction'\n    // events are utilized to maintain inTransaction property state which in\n    // turn is used in managing transactions. These events are only fired for\n    // TDS version 7.2 and beyond. The properties below are used to emulate\n    // equivalent behavior for TDS versions before 7.2.\n    this.transactionDepth = 0;\n    this.isSqlBatch = false;\n    this.closed = false;\n    this.messageBuffer = Buffer.alloc(0);\n    this.curTransientRetryCount = 0;\n    this.transientErrorLookup = new _transientErrorLookup.TransientErrorLookup();\n    this.state = this.STATE.INITIALIZED;\n    this._cancelAfterRequestSent = () => {\n      this.messageIo.sendMessage(_packet.TYPE.ATTENTION);\n      this.createCancelTimer();\n    };\n  }\n  connect(connectListener) {\n    if (this.state !== this.STATE.INITIALIZED) {\n      throw new _errors.ConnectionError('`.connect` can not be called on a Connection in `' + this.state.name + '` state.');\n    }\n    if (connectListener) {\n      const onConnect = err => {\n        this.removeListener('error', onError);\n        connectListener(err);\n      };\n      const onError = err => {\n        this.removeListener('connect', onConnect);\n        connectListener(err);\n      };\n      this.once('connect', onConnect);\n      this.once('error', onError);\n    }\n    this.transitionTo(this.STATE.CONNECTING);\n  }\n\n  /**\n   * The server has reported that the charset has changed.\n   */\n\n  /**\n   * The attempt to connect and validate has completed.\n   */\n\n  /**\n   * The server has reported that the active database has changed.\n   * This may be as a result of a successful login, or a `use` statement.\n   */\n\n  /**\n   * A debug message is available. It may be logged or ignored.\n   */\n\n  /**\n   * Internal error occurs.\n   */\n\n  /**\n   * The server has issued an error message.\n   */\n\n  /**\n   * The connection has ended.\n   *\n   * This may be as a result of the client calling [[close]], the server\n   * closing the connection, or a network error.\n   */\n\n  /**\n   * The server has issued an information message.\n   */\n\n  /**\n   * The server has reported that the language has changed.\n   */\n\n  /**\n   * The connection was reset.\n   */\n\n  /**\n   * A secure connection has been established.\n   */\n\n  on(event, listener) {\n    return super.on(event, listener);\n  }\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  /**\n   * @private\n   */\n\n  emit(event, ...args) {\n    return super.emit(event, ...args);\n  }\n\n  /**\n   * Closes the connection to the database.\n   *\n   * The [[Event_end]] will be emitted once the connection has been closed.\n   */\n  close() {\n    this.transitionTo(this.STATE.FINAL);\n  }\n\n  /**\n   * @private\n   */\n  initialiseConnection() {\n    const signal = this.createConnectTimer();\n    if (this.config.options.port) {\n      return this.connectOnPort(this.config.options.port, this.config.options.multiSubnetFailover, signal, this.config.options.connector);\n    } else {\n      return (0, _instanceLookup.instanceLookup)({\n        server: this.config.server,\n        instanceName: this.config.options.instanceName,\n        timeout: this.config.options.connectTimeout,\n        signal: signal\n      }).then(port => {\n        process.nextTick(() => {\n          this.connectOnPort(port, this.config.options.multiSubnetFailover, signal, this.config.options.connector);\n        });\n      }, err => {\n        this.clearConnectTimer();\n        if (signal.aborted) {\n          // Ignore the AbortError for now, this is still handled by the connectTimer firing\n          return;\n        }\n        process.nextTick(() => {\n          this.emit('connect', new _errors.ConnectionError(err.message, 'EINSTLOOKUP', {\n            cause: err\n          }));\n        });\n      });\n    }\n  }\n\n  /**\n   * @private\n   */\n  cleanupConnection(cleanupType) {\n    if (!this.closed) {\n      this.clearConnectTimer();\n      this.clearRequestTimer();\n      this.clearRetryTimer();\n      this.closeConnection();\n      if (cleanupType === CLEANUP_TYPE.REDIRECT) {\n        this.emit('rerouting');\n      } else if (cleanupType !== CLEANUP_TYPE.RETRY) {\n        process.nextTick(() => {\n          this.emit('end');\n        });\n      }\n      const request = this.request;\n      if (request) {\n        const err = new _errors.RequestError('Connection closed before request completed.', 'ECLOSE');\n        request.callback(err);\n        this.request = undefined;\n      }\n      this.closed = true;\n      this.loginError = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  createDebug() {\n    const debug = new _debug.default(this.config.options.debug);\n    debug.on('debug', message => {\n      this.emit('debug', message);\n    });\n    return debug;\n  }\n\n  /**\n   * @private\n   */\n  createTokenStreamParser(message, handler) {\n    return new _tokenStreamParser.Parser(message, this.debug, handler, this.config.options);\n  }\n  socketHandlingForSendPreLogin(socket) {\n    socket.on('error', error => {\n      this.socketError(error);\n    });\n    socket.on('close', () => {\n      this.socketClose();\n    });\n    socket.on('end', () => {\n      this.socketEnd();\n    });\n    socket.setKeepAlive(true, KEEP_ALIVE_INITIAL_DELAY);\n    this.messageIo = new _messageIo.default(socket, this.config.options.packetSize, this.debug);\n    this.messageIo.on('secure', cleartext => {\n      this.emit('secure', cleartext);\n    });\n    this.socket = socket;\n    this.closed = false;\n    this.debug.log('connected to ' + this.config.server + ':' + this.config.options.port);\n    this.sendPreLogin();\n    this.transitionTo(this.STATE.SENT_PRELOGIN);\n  }\n  wrapWithTls(socket, signal) {\n    signal.throwIfAborted();\n    return new Promise((resolve, reject) => {\n      const secureContext = tls.createSecureContext(this.secureContextOptions);\n      // If connect to an ip address directly,\n      // need to set the servername to an empty string\n      // if the user has not given a servername explicitly\n      const serverName = !net.isIP(this.config.server) ? this.config.server : '';\n      const encryptOptions = {\n        host: this.config.server,\n        socket: socket,\n        ALPNProtocols: ['tds/8.0'],\n        secureContext: secureContext,\n        servername: this.config.options.serverName ? this.config.options.serverName : serverName\n      };\n      const encryptsocket = tls.connect(encryptOptions);\n      const onAbort = () => {\n        encryptsocket.removeListener('error', onError);\n        encryptsocket.removeListener('connect', onConnect);\n        encryptsocket.destroy();\n        reject(signal.reason);\n      };\n      const onError = err => {\n        signal.removeEventListener('abort', onAbort);\n        encryptsocket.removeListener('error', onError);\n        encryptsocket.removeListener('connect', onConnect);\n        encryptsocket.destroy();\n        reject(err);\n      };\n      const onConnect = () => {\n        signal.removeEventListener('abort', onAbort);\n        encryptsocket.removeListener('error', onError);\n        encryptsocket.removeListener('connect', onConnect);\n        resolve(encryptsocket);\n      };\n      signal.addEventListener('abort', onAbort, {\n        once: true\n      });\n      encryptsocket.on('error', onError);\n      encryptsocket.on('secureConnect', onConnect);\n    });\n  }\n  connectOnPort(port, multiSubnetFailover, signal, customConnector) {\n    const connectOpts = {\n      host: this.routingData ? this.routingData.server : this.config.server,\n      port: this.routingData ? this.routingData.port : port,\n      localAddress: this.config.options.localAddress\n    };\n    const connect = customConnector || (multiSubnetFailover ? _connector.connectInParallel : _connector.connectInSequence);\n    (async () => {\n      let socket = await connect(connectOpts, _dns.default.lookup, signal);\n      if (this.config.options.encrypt === 'strict') {\n        try {\n          // Wrap the socket with TLS for TDS 8.0\n          socket = await this.wrapWithTls(socket, signal);\n        } catch (err) {\n          socket.end();\n          throw err;\n        }\n      }\n      this.socketHandlingForSendPreLogin(socket);\n    })().catch(err => {\n      this.clearConnectTimer();\n      if (signal.aborted) {\n        return;\n      }\n      process.nextTick(() => {\n        this.socketError(err);\n      });\n    });\n  }\n\n  /**\n   * @private\n   */\n  closeConnection() {\n    if (this.socket) {\n      this.socket.destroy();\n    }\n  }\n\n  /**\n   * @private\n   */\n  createConnectTimer() {\n    const controller = new AbortController();\n    this.connectTimer = setTimeout(() => {\n      controller.abort();\n      this.connectTimeout();\n    }, this.config.options.connectTimeout);\n    return controller.signal;\n  }\n\n  /**\n   * @private\n   */\n  createCancelTimer() {\n    this.clearCancelTimer();\n    const timeout = this.config.options.cancelTimeout;\n    if (timeout > 0) {\n      this.cancelTimer = setTimeout(() => {\n        this.cancelTimeout();\n      }, timeout);\n    }\n  }\n\n  /**\n   * @private\n   */\n  createRequestTimer() {\n    this.clearRequestTimer(); // release old timer, just to be safe\n    const request = this.request;\n    const timeout = request.timeout !== undefined ? request.timeout : this.config.options.requestTimeout;\n    if (timeout) {\n      this.requestTimer = setTimeout(() => {\n        this.requestTimeout();\n      }, timeout);\n    }\n  }\n\n  /**\n   * @private\n   */\n  createRetryTimer() {\n    this.clearRetryTimer();\n    this.retryTimer = setTimeout(() => {\n      this.retryTimeout();\n    }, this.config.options.connectionRetryInterval);\n  }\n\n  /**\n   * @private\n   */\n  connectTimeout() {\n    const hostPostfix = this.config.options.port ? `:${this.config.options.port}` : `\\\\${this.config.options.instanceName}`;\n    // If we have routing data stored, this connection has been redirected\n    const server = this.routingData ? this.routingData.server : this.config.server;\n    const port = this.routingData ? `:${this.routingData.port}` : hostPostfix;\n    // Grab the target host from the connection configuration, and from a redirect message\n    // otherwise, leave the message empty.\n    const routingMessage = this.routingData ? ` (redirected from ${this.config.server}${hostPostfix})` : '';\n    const message = `Failed to connect to ${server}${port}${routingMessage} in ${this.config.options.connectTimeout}ms`;\n    this.debug.log(message);\n    this.emit('connect', new _errors.ConnectionError(message, 'ETIMEOUT'));\n    this.connectTimer = undefined;\n    this.dispatchEvent('connectTimeout');\n  }\n\n  /**\n   * @private\n   */\n  cancelTimeout() {\n    const message = `Failed to cancel request in ${this.config.options.cancelTimeout}ms`;\n    this.debug.log(message);\n    this.dispatchEvent('socketError', new _errors.ConnectionError(message, 'ETIMEOUT'));\n  }\n\n  /**\n   * @private\n   */\n  requestTimeout() {\n    this.requestTimer = undefined;\n    const request = this.request;\n    request.cancel();\n    const timeout = request.timeout !== undefined ? request.timeout : this.config.options.requestTimeout;\n    const message = 'Timeout: Request failed to complete in ' + timeout + 'ms';\n    request.error = new _errors.RequestError(message, 'ETIMEOUT');\n  }\n\n  /**\n   * @private\n   */\n  retryTimeout() {\n    this.retryTimer = undefined;\n    this.emit('retry');\n    this.transitionTo(this.STATE.CONNECTING);\n  }\n\n  /**\n   * @private\n   */\n  clearConnectTimer() {\n    if (this.connectTimer) {\n      clearTimeout(this.connectTimer);\n      this.connectTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  clearCancelTimer() {\n    if (this.cancelTimer) {\n      clearTimeout(this.cancelTimer);\n      this.cancelTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  clearRequestTimer() {\n    if (this.requestTimer) {\n      clearTimeout(this.requestTimer);\n      this.requestTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  clearRetryTimer() {\n    if (this.retryTimer) {\n      clearTimeout(this.retryTimer);\n      this.retryTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  transitionTo(newState) {\n    if (this.state === newState) {\n      this.debug.log('State is already ' + newState.name);\n      return;\n    }\n    if (this.state && this.state.exit) {\n      this.state.exit.call(this, newState);\n    }\n    this.debug.log('State change: ' + (this.state ? this.state.name : 'undefined') + ' -> ' + newState.name);\n    this.state = newState;\n    if (this.state.enter) {\n      this.state.enter.apply(this);\n    }\n  }\n\n  /**\n   * @private\n   */\n  getEventHandler(eventName) {\n    const handler = this.state.events[eventName];\n    if (!handler) {\n      throw new Error(`No event '${eventName}' in state '${this.state.name}'`);\n    }\n    return handler;\n  }\n\n  /**\n   * @private\n   */\n  dispatchEvent(eventName, ...args) {\n    const handler = this.state.events[eventName];\n    if (handler) {\n      handler.apply(this, args);\n    } else {\n      this.emit('error', new Error(`No event '${eventName}' in state '${this.state.name}'`));\n      this.close();\n    }\n  }\n\n  /**\n   * @private\n   */\n  socketError(error) {\n    if (this.state === this.STATE.CONNECTING || this.state === this.STATE.SENT_TLSSSLNEGOTIATION) {\n      const hostPostfix = this.config.options.port ? `:${this.config.options.port}` : `\\\\${this.config.options.instanceName}`;\n      // If we have routing data stored, this connection has been redirected\n      const server = this.routingData ? this.routingData.server : this.config.server;\n      const port = this.routingData ? `:${this.routingData.port}` : hostPostfix;\n      // Grab the target host from the connection configuration, and from a redirect message\n      // otherwise, leave the message empty.\n      const routingMessage = this.routingData ? ` (redirected from ${this.config.server}${hostPostfix})` : '';\n      const message = `Failed to connect to ${server}${port}${routingMessage} - ${error.message}`;\n      this.debug.log(message);\n      this.emit('connect', new _errors.ConnectionError(message, 'ESOCKET', {\n        cause: error\n      }));\n    } else {\n      const message = `Connection lost - ${error.message}`;\n      this.debug.log(message);\n      this.emit('error', new _errors.ConnectionError(message, 'ESOCKET', {\n        cause: error\n      }));\n    }\n    this.dispatchEvent('socketError', error);\n  }\n\n  /**\n   * @private\n   */\n  socketEnd() {\n    this.debug.log('socket ended');\n    if (this.state !== this.STATE.FINAL) {\n      const error = new Error('socket hang up');\n      error.code = 'ECONNRESET';\n      this.socketError(error);\n    }\n  }\n\n  /**\n   * @private\n   */\n  socketClose() {\n    this.debug.log('connection to ' + this.config.server + ':' + this.config.options.port + ' closed');\n    if (this.state === this.STATE.REROUTING) {\n      this.debug.log('Rerouting to ' + this.routingData.server + ':' + this.routingData.port);\n      this.dispatchEvent('reconnect');\n    } else if (this.state === this.STATE.TRANSIENT_FAILURE_RETRY) {\n      const server = this.routingData ? this.routingData.server : this.config.server;\n      const port = this.routingData ? this.routingData.port : this.config.options.port;\n      this.debug.log('Retry after transient failure connecting to ' + server + ':' + port);\n      this.dispatchEvent('retry');\n    } else {\n      this.transitionTo(this.STATE.FINAL);\n    }\n  }\n\n  /**\n   * @private\n   */\n  sendPreLogin() {\n    var _exec;\n    const [, major, minor, build] = (_exec = /^(\\d+)\\.(\\d+)\\.(\\d+)/.exec(_package.version)) !== null && _exec !== void 0 ? _exec : ['0.0.0', '0', '0', '0'];\n    const payload = new _preloginPayload.default({\n      // If encrypt setting is set to 'strict', then we should have already done the encryption before calling\n      // this function. Therefore, the encrypt will be set to false here.\n      // Otherwise, we will set encrypt here based on the encrypt Boolean value from the configuration.\n      encrypt: typeof this.config.options.encrypt === 'boolean' && this.config.options.encrypt,\n      version: {\n        major: Number(major),\n        minor: Number(minor),\n        build: Number(build),\n        subbuild: 0\n      }\n    });\n    this.messageIo.sendMessage(_packet.TYPE.PRELOGIN, payload.data);\n    this.debug.payload(function () {\n      return payload.toString('  ');\n    });\n  }\n\n  /**\n   * @private\n   */\n  sendLogin7Packet() {\n    const payload = new _login7Payload.default({\n      tdsVersion: _tdsVersions.versions[this.config.options.tdsVersion],\n      packetSize: this.config.options.packetSize,\n      clientProgVer: 0,\n      clientPid: process.pid,\n      connectionId: 0,\n      clientTimeZone: new Date().getTimezoneOffset(),\n      clientLcid: 0x00000409\n    });\n    const {\n      authentication\n    } = this.config;\n    switch (authentication.type) {\n      case 'azure-active-directory-password':\n        payload.fedAuth = {\n          type: 'ADAL',\n          echo: this.fedAuthRequired,\n          workflow: 'default'\n        };\n        break;\n      case 'azure-active-directory-access-token':\n        payload.fedAuth = {\n          type: 'SECURITYTOKEN',\n          echo: this.fedAuthRequired,\n          fedAuthToken: authentication.options.token\n        };\n        break;\n      case 'token-credential':\n      case 'azure-active-directory-msi-vm':\n      case 'azure-active-directory-default':\n      case 'azure-active-directory-msi-app-service':\n      case 'azure-active-directory-service-principal-secret':\n        payload.fedAuth = {\n          type: 'ADAL',\n          echo: this.fedAuthRequired,\n          workflow: 'integrated'\n        };\n        break;\n      case 'ntlm':\n        payload.sspi = (0, _ntlm.createNTLMRequest)({\n          domain: authentication.options.domain\n        });\n        break;\n      default:\n        payload.userName = authentication.options.userName;\n        payload.password = authentication.options.password;\n    }\n    payload.hostname = this.config.options.workstationId || _os.default.hostname();\n    payload.serverName = this.routingData ? this.routingData.server : this.config.server;\n    payload.appName = this.config.options.appName || 'Tedious';\n    payload.libraryName = _library.name;\n    payload.language = this.config.options.language;\n    payload.database = this.config.options.database;\n    payload.clientId = Buffer.from([1, 2, 3, 4, 5, 6]);\n    payload.readOnlyIntent = this.config.options.readOnlyIntent;\n    payload.initDbFatal = !this.config.options.fallbackToDefaultDb;\n    this.routingData = undefined;\n    this.messageIo.sendMessage(_packet.TYPE.LOGIN7, payload.toBuffer());\n    this.debug.payload(function () {\n      return payload.toString('  ');\n    });\n  }\n\n  /**\n   * @private\n   */\n  sendFedAuthTokenMessage(token) {\n    const accessTokenLen = Buffer.byteLength(token, 'ucs2');\n    const data = Buffer.alloc(8 + accessTokenLen);\n    let offset = 0;\n    offset = data.writeUInt32LE(accessTokenLen + 4, offset);\n    offset = data.writeUInt32LE(accessTokenLen, offset);\n    data.write(token, offset, 'ucs2');\n    this.messageIo.sendMessage(_packet.TYPE.FEDAUTH_TOKEN, data);\n    // sent the fedAuth token message, the rest is similar to standard login 7\n    this.transitionTo(this.STATE.SENT_LOGIN7_WITH_STANDARD_LOGIN);\n  }\n\n  /**\n   * @private\n   */\n  sendInitialSql() {\n    const payload = new _sqlbatchPayload.default(this.getInitialSql(), this.currentTransactionDescriptor(), this.config.options);\n    const message = new _message.default({\n      type: _packet.TYPE.SQL_BATCH\n    });\n    this.messageIo.outgoingMessageStream.write(message);\n    _stream.Readable.from(payload).pipe(message);\n  }\n\n  /**\n   * @private\n   */\n  getInitialSql() {\n    const options = [];\n    if (this.config.options.enableAnsiNull === true) {\n      options.push('set ansi_nulls on');\n    } else if (this.config.options.enableAnsiNull === false) {\n      options.push('set ansi_nulls off');\n    }\n    if (this.config.options.enableAnsiNullDefault === true) {\n      options.push('set ansi_null_dflt_on on');\n    } else if (this.config.options.enableAnsiNullDefault === false) {\n      options.push('set ansi_null_dflt_on off');\n    }\n    if (this.config.options.enableAnsiPadding === true) {\n      options.push('set ansi_padding on');\n    } else if (this.config.options.enableAnsiPadding === false) {\n      options.push('set ansi_padding off');\n    }\n    if (this.config.options.enableAnsiWarnings === true) {\n      options.push('set ansi_warnings on');\n    } else if (this.config.options.enableAnsiWarnings === false) {\n      options.push('set ansi_warnings off');\n    }\n    if (this.config.options.enableArithAbort === true) {\n      options.push('set arithabort on');\n    } else if (this.config.options.enableArithAbort === false) {\n      options.push('set arithabort off');\n    }\n    if (this.config.options.enableConcatNullYieldsNull === true) {\n      options.push('set concat_null_yields_null on');\n    } else if (this.config.options.enableConcatNullYieldsNull === false) {\n      options.push('set concat_null_yields_null off');\n    }\n    if (this.config.options.enableCursorCloseOnCommit === true) {\n      options.push('set cursor_close_on_commit on');\n    } else if (this.config.options.enableCursorCloseOnCommit === false) {\n      options.push('set cursor_close_on_commit off');\n    }\n    if (this.config.options.datefirst !== null) {\n      options.push(`set datefirst ${this.config.options.datefirst}`);\n    }\n    if (this.config.options.dateFormat !== null) {\n      options.push(`set dateformat ${this.config.options.dateFormat}`);\n    }\n    if (this.config.options.enableImplicitTransactions === true) {\n      options.push('set implicit_transactions on');\n    } else if (this.config.options.enableImplicitTransactions === false) {\n      options.push('set implicit_transactions off');\n    }\n    if (this.config.options.language !== null) {\n      options.push(`set language ${this.config.options.language}`);\n    }\n    if (this.config.options.enableNumericRoundabort === true) {\n      options.push('set numeric_roundabort on');\n    } else if (this.config.options.enableNumericRoundabort === false) {\n      options.push('set numeric_roundabort off');\n    }\n    if (this.config.options.enableQuotedIdentifier === true) {\n      options.push('set quoted_identifier on');\n    } else if (this.config.options.enableQuotedIdentifier === false) {\n      options.push('set quoted_identifier off');\n    }\n    if (this.config.options.textsize !== null) {\n      options.push(`set textsize ${this.config.options.textsize}`);\n    }\n    if (this.config.options.connectionIsolationLevel !== null) {\n      options.push(`set transaction isolation level ${this.getIsolationLevelText(this.config.options.connectionIsolationLevel)}`);\n    }\n    if (this.config.options.abortTransactionOnError === true) {\n      options.push('set xact_abort on');\n    } else if (this.config.options.abortTransactionOnError === false) {\n      options.push('set xact_abort off');\n    }\n    return options.join('\\n');\n  }\n\n  /**\n   * @private\n   */\n  processedInitialSql() {\n    this.clearConnectTimer();\n    this.emit('connect');\n  }\n\n  /**\n   * Execute the SQL batch represented by [[Request]].\n   * There is no param support, and unlike [[Request.execSql]],\n   * it is not likely that SQL Server will reuse the execution plan it generates for the SQL.\n   *\n   * In almost all cases, [[Request.execSql]] will be a better choice.\n   *\n   * @param request A [[Request]] object representing the request.\n   */\n  execSqlBatch(request) {\n    this.makeRequest(request, _packet.TYPE.SQL_BATCH, new _sqlbatchPayload.default(request.sqlTextOrProcedure, this.currentTransactionDescriptor(), this.config.options));\n  }\n\n  /**\n   *  Execute the SQL represented by [[Request]].\n   *\n   * As `sp_executesql` is used to execute the SQL, if the same SQL is executed multiples times\n   * using this function, the SQL Server query optimizer is likely to reuse the execution plan it generates\n   * for the first execution. This may also result in SQL server treating the request like a stored procedure\n   * which can result in the [[Event_doneInProc]] or [[Event_doneProc]] events being emitted instead of the\n   * [[Event_done]] event you might expect. Using [[execSqlBatch]] will prevent this from occurring but may have a negative performance impact.\n   *\n   * Beware of the way that scoping rules apply, and how they may [affect local temp tables](http://weblogs.sqlteam.com/mladenp/archive/2006/11/03/17197.aspx)\n   * If you're running in to scoping issues, then [[execSqlBatch]] may be a better choice.\n   * See also [issue #24](https://github.com/pekim/tedious/issues/24)\n   *\n   * @param request A [[Request]] object representing the request.\n   */\n  execSql(request) {\n    try {\n      request.validateParameters(this.databaseCollation);\n    } catch (error) {\n      request.error = error;\n      process.nextTick(() => {\n        this.debug.log(error.message);\n        request.callback(error);\n      });\n      return;\n    }\n    const parameters = [];\n    parameters.push({\n      type: _dataType.TYPES.NVarChar,\n      name: 'statement',\n      value: request.sqlTextOrProcedure,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n    if (request.parameters.length) {\n      parameters.push({\n        type: _dataType.TYPES.NVarChar,\n        name: 'params',\n        value: request.makeParamsParameter(request.parameters),\n        output: false,\n        length: undefined,\n        precision: undefined,\n        scale: undefined\n      });\n      parameters.push(...request.parameters);\n    }\n    this.makeRequest(request, _packet.TYPE.RPC_REQUEST, new _rpcrequestPayload.default(_specialStoredProcedure.default.Sp_ExecuteSql, parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Creates a new BulkLoad instance.\n   *\n   * @param table The name of the table to bulk-insert into.\n   * @param options A set of bulk load options.\n   */\n\n  newBulkLoad(table, callbackOrOptions, callback) {\n    let options;\n    if (callback === undefined) {\n      callback = callbackOrOptions;\n      options = {};\n    } else {\n      options = callbackOrOptions;\n    }\n    if (typeof options !== 'object') {\n      throw new TypeError('\"options\" argument must be an object');\n    }\n    return new _bulkLoad.default(table, this.databaseCollation, this.config.options, options, callback);\n  }\n\n  /**\n   * Execute a [[BulkLoad]].\n   *\n   * ```js\n   * // We want to perform a bulk load into a table with the following format:\n   * // CREATE TABLE employees (first_name nvarchar(255), last_name nvarchar(255), day_of_birth date);\n   *\n   * const bulkLoad = connection.newBulkLoad('employees', (err, rowCount) => {\n   *   // ...\n   * });\n   *\n   * // First, we need to specify the columns that we want to write to,\n   * // and their definitions. These definitions must match the actual table,\n   * // otherwise the bulk load will fail.\n   * bulkLoad.addColumn('first_name', TYPES.NVarchar, { nullable: false });\n   * bulkLoad.addColumn('last_name', TYPES.NVarchar, { nullable: false });\n   * bulkLoad.addColumn('date_of_birth', TYPES.Date, { nullable: false });\n   *\n   * // Execute a bulk load with a predefined list of rows.\n   * //\n   * // Note that these rows are held in memory until the\n   * // bulk load was performed, so if you need to write a large\n   * // number of rows (e.g. by reading from a CSV file),\n   * // passing an `AsyncIterable` is advisable to keep memory usage low.\n   * connection.execBulkLoad(bulkLoad, [\n   *   { 'first_name': 'Steve', 'last_name': 'Jobs', 'day_of_birth': new Date('02-24-1955') },\n   *   { 'first_name': 'Bill', 'last_name': 'Gates', 'day_of_birth': new Date('10-28-1955') }\n   * ]);\n   * ```\n   *\n   * @param bulkLoad A previously created [[BulkLoad]].\n   * @param rows A [[Iterable]] or [[AsyncIterable]] that contains the rows that should be bulk loaded.\n   */\n\n  execBulkLoad(bulkLoad, rows) {\n    bulkLoad.executionStarted = true;\n    if (rows) {\n      if (bulkLoad.streamingMode) {\n        throw new Error(\"Connection.execBulkLoad can't be called with a BulkLoad that was put in streaming mode.\");\n      }\n      if (bulkLoad.firstRowWritten) {\n        throw new Error(\"Connection.execBulkLoad can't be called with a BulkLoad that already has rows written to it.\");\n      }\n      const rowStream = _stream.Readable.from(rows);\n\n      // Destroy the packet transform if an error happens in the row stream,\n      // e.g. if an error is thrown from within a generator or stream.\n      rowStream.on('error', err => {\n        bulkLoad.rowToPacketTransform.destroy(err);\n      });\n\n      // Destroy the row stream if an error happens in the packet transform,\n      // e.g. if the bulk load is cancelled.\n      bulkLoad.rowToPacketTransform.on('error', err => {\n        rowStream.destroy(err);\n      });\n      rowStream.pipe(bulkLoad.rowToPacketTransform);\n    } else if (!bulkLoad.streamingMode) {\n      // If the bulkload was not put into streaming mode by the user,\n      // we end the rowToPacketTransform here for them.\n      //\n      // If it was put into streaming mode, it's the user's responsibility\n      // to end the stream.\n      bulkLoad.rowToPacketTransform.end();\n    }\n    const onCancel = () => {\n      request.cancel();\n    };\n    const payload = new _bulkLoadPayload.BulkLoadPayload(bulkLoad);\n    const request = new _request.default(bulkLoad.getBulkInsertSql(), error => {\n      bulkLoad.removeListener('cancel', onCancel);\n      if (error) {\n        if (error.code === 'UNKNOWN') {\n          error.message += ' This is likely because the schema of the BulkLoad does not match the schema of the table you are attempting to insert into.';\n        }\n        bulkLoad.error = error;\n        bulkLoad.callback(error);\n        return;\n      }\n      this.makeRequest(bulkLoad, _packet.TYPE.BULK_LOAD, payload);\n    });\n    bulkLoad.once('cancel', onCancel);\n    this.execSqlBatch(request);\n  }\n\n  /**\n   * Prepare the SQL represented by the request.\n   *\n   * The request can then be used in subsequent calls to\n   * [[execute]] and [[unprepare]]\n   *\n   * @param request A [[Request]] object representing the request.\n   *   Parameters only require a name and type. Parameter values are ignored.\n   */\n  prepare(request) {\n    const parameters = [];\n    parameters.push({\n      type: _dataType.TYPES.Int,\n      name: 'handle',\n      value: undefined,\n      output: true,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n    parameters.push({\n      type: _dataType.TYPES.NVarChar,\n      name: 'params',\n      value: request.parameters.length ? request.makeParamsParameter(request.parameters) : null,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n    parameters.push({\n      type: _dataType.TYPES.NVarChar,\n      name: 'stmt',\n      value: request.sqlTextOrProcedure,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n    request.preparing = true;\n\n    // TODO: We need to clean up this event handler, otherwise this leaks memory\n    request.on('returnValue', (name, value) => {\n      if (name === 'handle') {\n        request.handle = value;\n      } else {\n        request.error = new _errors.RequestError(`Tedious > Unexpected output parameter ${name} from sp_prepare`);\n      }\n    });\n    this.makeRequest(request, _packet.TYPE.RPC_REQUEST, new _rpcrequestPayload.default(_specialStoredProcedure.default.Sp_Prepare, parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Release the SQL Server resources associated with a previously prepared request.\n   *\n   * @param request A [[Request]] object representing the request.\n   *   Parameters only require a name and type.\n   *   Parameter values are ignored.\n   */\n  unprepare(request) {\n    const parameters = [];\n    parameters.push({\n      type: _dataType.TYPES.Int,\n      name: 'handle',\n      // TODO: Abort if `request.handle` is not set\n      value: request.handle,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n    this.makeRequest(request, _packet.TYPE.RPC_REQUEST, new _rpcrequestPayload.default(_specialStoredProcedure.default.Sp_Unprepare, parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Execute previously prepared SQL, using the supplied parameters.\n   *\n   * @param request A previously prepared [[Request]].\n   * @param parameters  An object whose names correspond to the names of\n   *   parameters that were added to the [[Request]] before it was prepared.\n   *   The object's values are passed as the parameters' values when the\n   *   request is executed.\n   */\n  execute(request, parameters) {\n    const executeParameters = [];\n    executeParameters.push({\n      type: _dataType.TYPES.Int,\n      name: '',\n      // TODO: Abort if `request.handle` is not set\n      value: request.handle,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n    try {\n      for (let i = 0, len = request.parameters.length; i < len; i++) {\n        const parameter = request.parameters[i];\n        executeParameters.push({\n          ...parameter,\n          value: parameter.type.validate(parameters ? parameters[parameter.name] : null, this.databaseCollation)\n        });\n      }\n    } catch (error) {\n      request.error = error;\n      process.nextTick(() => {\n        this.debug.log(error.message);\n        request.callback(error);\n      });\n      return;\n    }\n    this.makeRequest(request, _packet.TYPE.RPC_REQUEST, new _rpcrequestPayload.default(_specialStoredProcedure.default.Sp_Execute, executeParameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Call a stored procedure represented by [[Request]].\n   *\n   * @param request A [[Request]] object representing the request.\n   */\n  callProcedure(request) {\n    try {\n      request.validateParameters(this.databaseCollation);\n    } catch (error) {\n      request.error = error;\n      process.nextTick(() => {\n        this.debug.log(error.message);\n        request.callback(error);\n      });\n      return;\n    }\n    this.makeRequest(request, _packet.TYPE.RPC_REQUEST, new _rpcrequestPayload.default(request.sqlTextOrProcedure, request.parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Start a transaction.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\n   *   Optional, and defaults to an empty string. Required when `isolationLevel`\n   *   is present.\n   * @param isolationLevel The isolation level that the transaction is to be run with.\n   *\n   *   The isolation levels are available from `require('tedious').ISOLATION_LEVEL`.\n   *   * `READ_UNCOMMITTED`\n   *   * `READ_COMMITTED`\n   *   * `REPEATABLE_READ`\n   *   * `SERIALIZABLE`\n   *   * `SNAPSHOT`\n   *\n   *   Optional, and defaults to the Connection's isolation level.\n   */\n  beginTransaction(callback, name = '', isolationLevel = this.config.options.isolationLevel) {\n    (0, _transaction.assertValidIsolationLevel)(isolationLevel, 'isolationLevel');\n    const transaction = new _transaction.Transaction(name, isolationLevel);\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new _request.default('SET TRANSACTION ISOLATION LEVEL ' + transaction.isolationLevelToTSQL() + ';BEGIN TRAN ' + transaction.name, err => {\n        this.transactionDepth++;\n        if (this.transactionDepth === 1) {\n          this.inTransaction = true;\n        }\n        callback(err);\n      }));\n    }\n    const request = new _request.default(undefined, err => {\n      return callback(err, this.currentTransactionDescriptor());\n    });\n    return this.makeRequest(request, _packet.TYPE.TRANSACTION_MANAGER, transaction.beginPayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Commit a transaction.\n   *\n   * There should be an active transaction - that is, [[beginTransaction]]\n   * should have been previously called.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\n   *   Optional, and defaults to an empty string. Required when `isolationLevel`is present.\n   */\n  commitTransaction(callback, name = '') {\n    const transaction = new _transaction.Transaction(name);\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new _request.default('COMMIT TRAN ' + transaction.name, err => {\n        this.transactionDepth--;\n        if (this.transactionDepth === 0) {\n          this.inTransaction = false;\n        }\n        callback(err);\n      }));\n    }\n    const request = new _request.default(undefined, callback);\n    return this.makeRequest(request, _packet.TYPE.TRANSACTION_MANAGER, transaction.commitPayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Rollback a transaction.\n   *\n   * There should be an active transaction - that is, [[beginTransaction]]\n   * should have been previously called.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\n   *   Optional, and defaults to an empty string.\n   *   Required when `isolationLevel` is present.\n   */\n  rollbackTransaction(callback, name = '') {\n    const transaction = new _transaction.Transaction(name);\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new _request.default('ROLLBACK TRAN ' + transaction.name, err => {\n        this.transactionDepth--;\n        if (this.transactionDepth === 0) {\n          this.inTransaction = false;\n        }\n        callback(err);\n      }));\n    }\n    const request = new _request.default(undefined, callback);\n    return this.makeRequest(request, _packet.TYPE.TRANSACTION_MANAGER, transaction.rollbackPayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Set a savepoint within a transaction.\n   *\n   * There should be an active transaction - that is, [[beginTransaction]]\n   * should have been previously called.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\\\n   *   Optional, and defaults to an empty string.\n   *   Required when `isolationLevel` is present.\n   */\n  saveTransaction(callback, name) {\n    const transaction = new _transaction.Transaction(name);\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new _request.default('SAVE TRAN ' + transaction.name, err => {\n        this.transactionDepth++;\n        callback(err);\n      }));\n    }\n    const request = new _request.default(undefined, callback);\n    return this.makeRequest(request, _packet.TYPE.TRANSACTION_MANAGER, transaction.savePayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Run the given callback after starting a transaction, and commit or\n   * rollback the transaction afterwards.\n   *\n   * This is a helper that employs [[beginTransaction]], [[commitTransaction]],\n   * [[rollbackTransaction]], and [[saveTransaction]] to greatly simplify the\n   * use of database transactions and automatically handle transaction nesting.\n   *\n   * @param cb\n   * @param isolationLevel\n   *   The isolation level that the transaction is to be run with.\n   *\n   *   The isolation levels are available from `require('tedious').ISOLATION_LEVEL`.\n   *   * `READ_UNCOMMITTED`\n   *   * `READ_COMMITTED`\n   *   * `REPEATABLE_READ`\n   *   * `SERIALIZABLE`\n   *   * `SNAPSHOT`\n   *\n   *   Optional, and defaults to the Connection's isolation level.\n   */\n  transaction(cb, isolationLevel) {\n    if (typeof cb !== 'function') {\n      throw new TypeError('`cb` must be a function');\n    }\n    const useSavepoint = this.inTransaction;\n    const name = '_tedious_' + _crypto.default.randomBytes(10).toString('hex');\n    const txDone = (err, done, ...args) => {\n      if (err) {\n        if (this.inTransaction && this.state === this.STATE.LOGGED_IN) {\n          this.rollbackTransaction(txErr => {\n            done(txErr || err, ...args);\n          }, name);\n        } else {\n          done(err, ...args);\n        }\n      } else if (useSavepoint) {\n        if (this.config.options.tdsVersion < '7_2') {\n          this.transactionDepth--;\n        }\n        done(null, ...args);\n      } else {\n        this.commitTransaction(txErr => {\n          done(txErr, ...args);\n        }, name);\n      }\n    };\n    if (useSavepoint) {\n      return this.saveTransaction(err => {\n        if (err) {\n          return cb(err);\n        }\n        if (isolationLevel) {\n          return this.execSqlBatch(new _request.default('SET transaction isolation level ' + this.getIsolationLevelText(isolationLevel), err => {\n            return cb(err, txDone);\n          }));\n        } else {\n          return cb(null, txDone);\n        }\n      }, name);\n    } else {\n      return this.beginTransaction(err => {\n        if (err) {\n          return cb(err);\n        }\n        return cb(null, txDone);\n      }, name, isolationLevel);\n    }\n  }\n\n  /**\n   * @private\n   */\n  makeRequest(request, packetType, payload) {\n    if (this.state !== this.STATE.LOGGED_IN) {\n      const message = 'Requests can only be made in the ' + this.STATE.LOGGED_IN.name + ' state, not the ' + this.state.name + ' state';\n      this.debug.log(message);\n      request.callback(new _errors.RequestError(message, 'EINVALIDSTATE'));\n    } else if (request.canceled) {\n      process.nextTick(() => {\n        request.callback(new _errors.RequestError('Canceled.', 'ECANCEL'));\n      });\n    } else {\n      if (packetType === _packet.TYPE.SQL_BATCH) {\n        this.isSqlBatch = true;\n      } else {\n        this.isSqlBatch = false;\n      }\n      this.request = request;\n      request.connection = this;\n      request.rowCount = 0;\n      request.rows = [];\n      request.rst = [];\n      const onCancel = () => {\n        payloadStream.unpipe(message);\n        payloadStream.destroy(new _errors.RequestError('Canceled.', 'ECANCEL'));\n\n        // set the ignore bit and end the message.\n        message.ignore = true;\n        message.end();\n        if (request instanceof _request.default && request.paused) {\n          // resume the request if it was paused so we can read the remaining tokens\n          request.resume();\n        }\n      };\n      request.once('cancel', onCancel);\n      this.createRequestTimer();\n      const message = new _message.default({\n        type: packetType,\n        resetConnection: this.resetConnectionOnNextRequest\n      });\n      this.messageIo.outgoingMessageStream.write(message);\n      this.transitionTo(this.STATE.SENT_CLIENT_REQUEST);\n      message.once('finish', () => {\n        request.removeListener('cancel', onCancel);\n        request.once('cancel', this._cancelAfterRequestSent);\n        this.resetConnectionOnNextRequest = false;\n        this.debug.payload(function () {\n          return payload.toString('  ');\n        });\n      });\n      const payloadStream = _stream.Readable.from(payload);\n      payloadStream.once('error', error => {\n        payloadStream.unpipe(message);\n\n        // Only set a request error if no error was set yet.\n        request.error ??= error;\n        message.ignore = true;\n        message.end();\n      });\n      payloadStream.pipe(message);\n    }\n  }\n\n  /**\n   * Cancel currently executed request.\n   */\n  cancel() {\n    if (!this.request) {\n      return false;\n    }\n    if (this.request.canceled) {\n      return false;\n    }\n    this.request.cancel();\n    return true;\n  }\n\n  /**\n   * Reset the connection to its initial state.\n   * Can be useful for connection pool implementations.\n   *\n   * @param callback\n   */\n  reset(callback) {\n    const request = new _request.default(this.getInitialSql(), err => {\n      if (this.config.options.tdsVersion < '7_2') {\n        this.inTransaction = false;\n      }\n      callback(err);\n    });\n    this.resetConnectionOnNextRequest = true;\n    this.execSqlBatch(request);\n  }\n\n  /**\n   * @private\n   */\n  currentTransactionDescriptor() {\n    return this.transactionDescriptors[this.transactionDescriptors.length - 1];\n  }\n\n  /**\n   * @private\n   */\n  getIsolationLevelText(isolationLevel) {\n    switch (isolationLevel) {\n      case _transaction.ISOLATION_LEVEL.READ_UNCOMMITTED:\n        return 'read uncommitted';\n      case _transaction.ISOLATION_LEVEL.REPEATABLE_READ:\n        return 'repeatable read';\n      case _transaction.ISOLATION_LEVEL.SERIALIZABLE:\n        return 'serializable';\n      case _transaction.ISOLATION_LEVEL.SNAPSHOT:\n        return 'snapshot';\n      default:\n        return 'read committed';\n    }\n  }\n}\nfunction isTransientError(error) {\n  if (error instanceof AggregateError) {\n    error = error.errors[0];\n  }\n  return error instanceof _errors.ConnectionError && !!error.isTransient;\n}\nvar _default = exports.default = Connection;\nmodule.exports = Connection;\nConnection.prototype.STATE = {\n  INITIALIZED: {\n    name: 'Initialized',\n    events: {}\n  },\n  CONNECTING: {\n    name: 'Connecting',\n    enter: function () {\n      this.initialiseConnection();\n    },\n    events: {\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_PRELOGIN: {\n    name: 'SentPrelogin',\n    enter: function () {\n      (async () => {\n        let messageBuffer = Buffer.alloc(0);\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err) {\n          return this.socketError(err);\n        }\n        for await (const data of message) {\n          messageBuffer = Buffer.concat([messageBuffer, data]);\n        }\n        const preloginPayload = new _preloginPayload.default(messageBuffer);\n        this.debug.payload(function () {\n          return preloginPayload.toString('  ');\n        });\n        if (preloginPayload.fedAuthRequired === 1) {\n          this.fedAuthRequired = true;\n        }\n        if ('strict' !== this.config.options.encrypt && (preloginPayload.encryptionString === 'ON' || preloginPayload.encryptionString === 'REQ')) {\n          if (!this.config.options.encrypt) {\n            this.emit('connect', new _errors.ConnectionError(\"Server requires encryption, set 'encrypt' config option to true.\", 'EENCRYPT'));\n            return this.close();\n          }\n          try {\n            var _this$routingData$ser, _this$routingData;\n            this.transitionTo(this.STATE.SENT_TLSSSLNEGOTIATION);\n            await this.messageIo.startTls(this.secureContextOptions, this.config.options.serverName ? this.config.options.serverName : (_this$routingData$ser = (_this$routingData = this.routingData) === null || _this$routingData === void 0 ? void 0 : _this$routingData.server) !== null && _this$routingData$ser !== void 0 ? _this$routingData$ser : this.config.server, this.config.options.trustServerCertificate);\n          } catch (err) {\n            return this.socketError(err);\n          }\n        }\n        this.sendLogin7Packet();\n        const {\n          authentication\n        } = this.config;\n        switch (authentication.type) {\n          case 'token-credential':\n          case 'azure-active-directory-password':\n          case 'azure-active-directory-msi-vm':\n          case 'azure-active-directory-msi-app-service':\n          case 'azure-active-directory-service-principal-secret':\n          case 'azure-active-directory-default':\n            this.transitionTo(this.STATE.SENT_LOGIN7_WITH_FEDAUTH);\n            break;\n          case 'ntlm':\n            this.transitionTo(this.STATE.SENT_LOGIN7_WITH_NTLM);\n            break;\n          default:\n            this.transitionTo(this.STATE.SENT_LOGIN7_WITH_STANDARD_LOGIN);\n            break;\n        }\n      })().catch(err => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  REROUTING: {\n    name: 'ReRouting',\n    enter: function () {\n      this.cleanupConnection(CLEANUP_TYPE.REDIRECT);\n    },\n    events: {\n      message: function () {},\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      reconnect: function () {\n        this.transitionTo(this.STATE.CONNECTING);\n      }\n    }\n  },\n  TRANSIENT_FAILURE_RETRY: {\n    name: 'TRANSIENT_FAILURE_RETRY',\n    enter: function () {\n      this.curTransientRetryCount++;\n      this.cleanupConnection(CLEANUP_TYPE.RETRY);\n    },\n    events: {\n      message: function () {},\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      retry: function () {\n        this.createRetryTimer();\n      }\n    }\n  },\n  SENT_TLSSSLNEGOTIATION: {\n    name: 'SentTLSSSLNegotiation',\n    events: {\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_LOGIN7_WITH_STANDARD_LOGIN: {\n    name: 'SentLogin7WithStandardLogin',\n    enter: function () {\n      (async () => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err) {\n          return this.socketError(err);\n        }\n        const handler = new _handler.Login7TokenHandler(this);\n        const tokenStreamParser = this.createTokenStreamParser(message, handler);\n        await (0, _events.once)(tokenStreamParser, 'end');\n        if (handler.loginAckReceived) {\n          if (handler.routingData) {\n            this.routingData = handler.routingData;\n            this.transitionTo(this.STATE.REROUTING);\n          } else {\n            this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL);\n          }\n        } else if (this.loginError) {\n          if (isTransientError(this.loginError)) {\n            this.debug.log('Initiating retry on transient error');\n            this.transitionTo(this.STATE.TRANSIENT_FAILURE_RETRY);\n          } else {\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n          }\n        } else {\n          this.emit('connect', new _errors.ConnectionError('Login failed.', 'ELOGIN'));\n          this.transitionTo(this.STATE.FINAL);\n        }\n      })().catch(err => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_LOGIN7_WITH_NTLM: {\n    name: 'SentLogin7WithNTLMLogin',\n    enter: function () {\n      (async () => {\n        while (true) {\n          let message;\n          try {\n            message = await this.messageIo.readMessage();\n          } catch (err) {\n            return this.socketError(err);\n          }\n          const handler = new _handler.Login7TokenHandler(this);\n          const tokenStreamParser = this.createTokenStreamParser(message, handler);\n          await (0, _events.once)(tokenStreamParser, 'end');\n          if (handler.loginAckReceived) {\n            if (handler.routingData) {\n              this.routingData = handler.routingData;\n              return this.transitionTo(this.STATE.REROUTING);\n            } else {\n              return this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL);\n            }\n          } else if (this.ntlmpacket) {\n            const authentication = this.config.authentication;\n            const payload = new _ntlmPayload.default({\n              domain: authentication.options.domain,\n              userName: authentication.options.userName,\n              password: authentication.options.password,\n              ntlmpacket: this.ntlmpacket\n            });\n            this.messageIo.sendMessage(_packet.TYPE.NTLMAUTH_PKT, payload.data);\n            this.debug.payload(function () {\n              return payload.toString('  ');\n            });\n            this.ntlmpacket = undefined;\n          } else if (this.loginError) {\n            if (isTransientError(this.loginError)) {\n              this.debug.log('Initiating retry on transient error');\n              return this.transitionTo(this.STATE.TRANSIENT_FAILURE_RETRY);\n            } else {\n              this.emit('connect', this.loginError);\n              return this.transitionTo(this.STATE.FINAL);\n            }\n          } else {\n            this.emit('connect', new _errors.ConnectionError('Login failed.', 'ELOGIN'));\n            return this.transitionTo(this.STATE.FINAL);\n          }\n        }\n      })().catch(err => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_LOGIN7_WITH_FEDAUTH: {\n    name: 'SentLogin7Withfedauth',\n    enter: function () {\n      (async _authentication$optio => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err) {\n          return this.socketError(err);\n        }\n        const handler = new _handler.Login7TokenHandler(this);\n        const tokenStreamParser = this.createTokenStreamParser(message, handler);\n        await (0, _events.once)(tokenStreamParser, 'end');\n        if (handler.loginAckReceived) {\n          if (handler.routingData) {\n            this.routingData = handler.routingData;\n            this.transitionTo(this.STATE.REROUTING);\n          } else {\n            this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL);\n          }\n          return;\n        }\n        const fedAuthInfoToken = handler.fedAuthInfoToken;\n        if (fedAuthInfoToken && fedAuthInfoToken.stsurl && fedAuthInfoToken.spn) {\n          /** Federated authentication configation. */\n          const authentication = this.config.authentication;\n          /** Permission scope to pass to Entra ID when requesting an authentication token. */\n          const tokenScope = new _url.URL('/.default', fedAuthInfoToken.spn).toString();\n\n          /** Instance of the token credential to use to authenticate to the resource. */\n          let credentials;\n          switch (authentication.type) {\n            case 'token-credential':\n              credentials = authentication.options.credential;\n              break;\n            case 'azure-active-directory-password':\n              credentials = new _identity.UsernamePasswordCredential((_authentication$optio = authentication.options.tenantId) !== null && _authentication$optio !== void 0 ? _authentication$optio : 'common', authentication.options.clientId, authentication.options.userName, authentication.options.password);\n              break;\n            case 'azure-active-directory-msi-vm':\n            case 'azure-active-directory-msi-app-service':\n              const msiArgs = authentication.options.clientId ? [authentication.options.clientId, {}] : [{}];\n              credentials = new _identity.ManagedIdentityCredential(...msiArgs);\n              break;\n            case 'azure-active-directory-default':\n              const args = authentication.options.clientId ? {\n                managedIdentityClientId: authentication.options.clientId\n              } : {};\n              credentials = new _identity.DefaultAzureCredential(args);\n              break;\n            case 'azure-active-directory-service-principal-secret':\n              credentials = new _identity.ClientSecretCredential(authentication.options.tenantId, authentication.options.clientId, authentication.options.clientSecret);\n              break;\n          }\n\n          /** Access token retrieved from Entra ID for the configured permission scope(s). */\n          let tokenResponse;\n          try {\n            tokenResponse = await credentials.getToken(tokenScope);\n          } catch (err) {\n            this.loginError = new AggregateError([new _errors.ConnectionError('Security token could not be authenticated or authorized.', 'EFEDAUTH'), err]);\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n            return;\n          }\n\n          // Type guard the token value so that it is never null.\n          if (tokenResponse === null) {\n            this.loginError = new AggregateError([new _errors.ConnectionError('Security token could not be authenticated or authorized.', 'EFEDAUTH')]);\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n            return;\n          }\n          this.sendFedAuthTokenMessage(tokenResponse.token);\n        } else if (this.loginError) {\n          if (isTransientError(this.loginError)) {\n            this.debug.log('Initiating retry on transient error');\n            this.transitionTo(this.STATE.TRANSIENT_FAILURE_RETRY);\n          } else {\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n          }\n        } else {\n          this.emit('connect', new _errors.ConnectionError('Login failed.', 'ELOGIN'));\n          this.transitionTo(this.STATE.FINAL);\n        }\n      })().catch(err => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  LOGGED_IN_SENDING_INITIAL_SQL: {\n    name: 'LoggedInSendingInitialSql',\n    enter: function () {\n      (async () => {\n        this.sendInitialSql();\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err) {\n          return this.socketError(err);\n        }\n        const tokenStreamParser = this.createTokenStreamParser(message, new _handler.InitialSqlTokenHandler(this));\n        await (0, _events.once)(tokenStreamParser, 'end');\n        this.transitionTo(this.STATE.LOGGED_IN);\n        this.processedInitialSql();\n      })().catch(err => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function socketError() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  LOGGED_IN: {\n    name: 'LoggedIn',\n    events: {\n      socketError: function () {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_CLIENT_REQUEST: {\n    name: 'SentClientRequest',\n    enter: function () {\n      (async (_this$request, _this$request3, _this$request10) => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err) {\n          return this.socketError(err);\n        }\n        // request timer is stopped on first data package\n        this.clearRequestTimer();\n        const tokenStreamParser = this.createTokenStreamParser(message, new _handler.RequestTokenHandler(this, this.request));\n\n        // If the request was canceled and we have a `cancelTimer`\n        // defined, we send a attention message after the\n        // request message was fully sent off.\n        //\n        // We already started consuming the current message\n        // (but all the token handlers should be no-ops), and\n        // need to ensure the next message is handled by the\n        // `SENT_ATTENTION` state.\n        if ((_this$request = this.request) !== null && _this$request !== void 0 && _this$request.canceled && this.cancelTimer) {\n          return this.transitionTo(this.STATE.SENT_ATTENTION);\n        }\n        const onResume = () => {\n          tokenStreamParser.resume();\n        };\n        const onPause = () => {\n          var _this$request2;\n          tokenStreamParser.pause();\n          (_this$request2 = this.request) === null || _this$request2 === void 0 ? void 0 : _this$request2.once('resume', onResume);\n        };\n        (_this$request3 = this.request) === null || _this$request3 === void 0 ? void 0 : _this$request3.on('pause', onPause);\n        if (this.request instanceof _request.default && this.request.paused) {\n          onPause();\n        }\n        const onCancel = () => {\n          var _this$request4, _this$request5;\n          tokenStreamParser.removeListener('end', onEndOfMessage);\n          if (this.request instanceof _request.default && this.request.paused) {\n            // resume the request if it was paused so we can read the remaining tokens\n            this.request.resume();\n          }\n          (_this$request4 = this.request) === null || _this$request4 === void 0 ? void 0 : _this$request4.removeListener('pause', onPause);\n          (_this$request5 = this.request) === null || _this$request5 === void 0 ? void 0 : _this$request5.removeListener('resume', onResume);\n\n          // The `_cancelAfterRequestSent` callback will have sent a\n          // attention message, so now we need to also switch to\n          // the `SENT_ATTENTION` state to make sure the attention ack\n          // message is processed correctly.\n          this.transitionTo(this.STATE.SENT_ATTENTION);\n        };\n        const onEndOfMessage = () => {\n          var _this$request6, _this$request7, _this$request8, _this$request9;\n          (_this$request6 = this.request) === null || _this$request6 === void 0 ? void 0 : _this$request6.removeListener('cancel', this._cancelAfterRequestSent);\n          (_this$request7 = this.request) === null || _this$request7 === void 0 ? void 0 : _this$request7.removeListener('cancel', onCancel);\n          (_this$request8 = this.request) === null || _this$request8 === void 0 ? void 0 : _this$request8.removeListener('pause', onPause);\n          (_this$request9 = this.request) === null || _this$request9 === void 0 ? void 0 : _this$request9.removeListener('resume', onResume);\n          this.transitionTo(this.STATE.LOGGED_IN);\n          const sqlRequest = this.request;\n          this.request = undefined;\n          if (this.config.options.tdsVersion < '7_2' && sqlRequest.error && this.isSqlBatch) {\n            this.inTransaction = false;\n          }\n          sqlRequest.callback(sqlRequest.error, sqlRequest.rowCount, sqlRequest.rows);\n        };\n        tokenStreamParser.once('end', onEndOfMessage);\n        (_this$request10 = this.request) === null || _this$request10 === void 0 ? void 0 : _this$request10.once('cancel', onCancel);\n      })();\n    },\n    exit: function (nextState) {\n      this.clearRequestTimer();\n    },\n    events: {\n      socketError: function (err) {\n        const sqlRequest = this.request;\n        this.request = undefined;\n        this.transitionTo(this.STATE.FINAL);\n        sqlRequest.callback(err);\n      }\n    }\n  },\n  SENT_ATTENTION: {\n    name: 'SentAttention',\n    enter: function () {\n      (async () => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err) {\n          return this.socketError(err);\n        }\n        const handler = new _handler.AttentionTokenHandler(this, this.request);\n        const tokenStreamParser = this.createTokenStreamParser(message, handler);\n        await (0, _events.once)(tokenStreamParser, 'end');\n        // 3.2.5.7 Sent Attention State\n        // Discard any data contained in the response, until we receive the attention response\n        if (handler.attentionReceived) {\n          this.clearCancelTimer();\n          const sqlRequest = this.request;\n          this.request = undefined;\n          this.transitionTo(this.STATE.LOGGED_IN);\n          if (sqlRequest.error && sqlRequest.error instanceof _errors.RequestError && sqlRequest.error.code === 'ETIMEOUT') {\n            sqlRequest.callback(sqlRequest.error);\n          } else {\n            sqlRequest.callback(new _errors.RequestError('Canceled.', 'ECANCEL'));\n          }\n        }\n      })().catch(err => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function (err) {\n        const sqlRequest = this.request;\n        this.request = undefined;\n        this.transitionTo(this.STATE.FINAL);\n        sqlRequest.callback(err);\n      }\n    }\n  },\n  FINAL: {\n    name: 'Final',\n    enter: function () {\n      this.cleanupConnection(CLEANUP_TYPE.NORMAL);\n    },\n    events: {\n      connectTimeout: function () {\n        // Do nothing, as the timer should be cleaned up.\n      },\n      message: function () {\n        // Do nothing\n      },\n      socketError: function () {\n        // Do nothing\n      }\n    }\n  }\n};","map":{"version":3,"names":["_crypto","_interopRequireDefault","require","_os","tls","_interopRequireWildcard","net","_dns","_constants","_stream","_identity","_coreAuth","_bulkLoad","_debug","_events","_instanceLookup","_transientErrorLookup","_packet","_preloginPayload","_login7Payload","_ntlmPayload","_request","_rpcrequestPayload","_sqlbatchPayload","_messageIo","_tokenStreamParser","_transaction","_errors","_connector","_library","_tdsVersions","_message","_ntlm","_dataType","_bulkLoadPayload","_specialStoredProcedure","_package","_url","_handler","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","KEEP_ALIVE_INITIAL_DELAY","DEFAULT_CONNECT_TIMEOUT","DEFAULT_CLIENT_REQUEST_TIMEOUT","DEFAULT_CANCEL_TIMEOUT","DEFAULT_CONNECT_RETRY_INTERVAL","DEFAULT_PACKET_SIZE","DEFAULT_TEXTSIZE","DEFAULT_DATEFIRST","DEFAULT_PORT","DEFAULT_TDS_VERSION","DEFAULT_LANGUAGE","DEFAULT_DATEFORMAT","CLEANUP_TYPE","NORMAL","REDIRECT","RETRY","Connection","EventEmitter","constructor","config","TypeError","server","fedAuthRequired","authentication","undefined","type","options","domain","userName","password","toUpperCase","isTokenCredential","credential","clientId","tenantId","token","clientSecret","abortTransactionOnError","appName","camelCaseColumns","cancelTimeout","columnEncryptionKeyCacheTTL","columnEncryptionSetting","columnNameReplacer","connectionRetryInterval","connectTimeout","connector","connectionIsolationLevel","ISOLATION_LEVEL","READ_COMMITTED","cryptoCredentialsDetails","database","datefirst","dateFormat","debug","data","packet","payload","enableAnsiNull","enableAnsiNullDefault","enableAnsiPadding","enableAnsiWarnings","enableArithAbort","enableConcatNullYieldsNull","enableCursorCloseOnCommit","enableImplicitTransactions","enableNumericRoundabort","enableQuotedIdentifier","encrypt","fallbackToDefaultDb","encryptionKeyStoreProviders","instanceName","isolationLevel","language","localAddress","maxRetriesOnTransientErrors","multiSubnetFailover","packetSize","port","readOnlyIntent","requestTimeout","rowCollectionOnDone","rowCollectionOnRequestCompletion","serverName","serverSupportsColumnEncryption","tdsVersion","textsize","trustedServerNameAE","trustServerCertificate","useColumnNames","useUTC","workstationId","lowerCaseGuids","Error","assertValidIsolationLevel","RangeError","secureContextOptions","secureOptions","create","value","SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS","createDebug","inTransaction","transactionDescriptors","Buffer","from","transactionDepth","isSqlBatch","closed","messageBuffer","alloc","curTransientRetryCount","transientErrorLookup","TransientErrorLookup","state","STATE","INITIALIZED","_cancelAfterRequestSent","messageIo","sendMessage","TYPE","ATTENTION","createCancelTimer","connect","connectListener","ConnectionError","name","onConnect","err","removeListener","onError","once","transitionTo","CONNECTING","on","event","listener","emit","args","close","FINAL","initialiseConnection","signal","createConnectTimer","connectOnPort","instanceLookup","timeout","then","process","nextTick","clearConnectTimer","aborted","message","cause","cleanupConnection","cleanupType","clearRequestTimer","clearRetryTimer","closeConnection","request","RequestError","callback","loginError","createTokenStreamParser","handler","Parser","socketHandlingForSendPreLogin","socket","error","socketError","socketClose","socketEnd","setKeepAlive","cleartext","log","sendPreLogin","SENT_PRELOGIN","wrapWithTls","throwIfAborted","Promise","resolve","reject","secureContext","createSecureContext","isIP","encryptOptions","host","ALPNProtocols","servername","encryptsocket","onAbort","destroy","reason","removeEventListener","addEventListener","customConnector","connectOpts","routingData","connectInParallel","connectInSequence","lookup","end","catch","controller","AbortController","connectTimer","setTimeout","abort","clearCancelTimer","cancelTimer","createRequestTimer","requestTimer","createRetryTimer","retryTimer","retryTimeout","hostPostfix","routingMessage","dispatchEvent","cancel","clearTimeout","newState","exit","enter","apply","getEventHandler","eventName","events","SENT_TLSSSLNEGOTIATION","code","REROUTING","TRANSIENT_FAILURE_RETRY","_exec","major","minor","build","exec","version","Number","subbuild","PRELOGIN","toString","sendLogin7Packet","versions","clientProgVer","clientPid","pid","connectionId","clientTimeZone","Date","getTimezoneOffset","clientLcid","fedAuth","echo","workflow","fedAuthToken","sspi","createNTLMRequest","hostname","libraryName","initDbFatal","LOGIN7","toBuffer","sendFedAuthTokenMessage","accessTokenLen","byteLength","offset","writeUInt32LE","write","FEDAUTH_TOKEN","SENT_LOGIN7_WITH_STANDARD_LOGIN","sendInitialSql","getInitialSql","currentTransactionDescriptor","SQL_BATCH","outgoingMessageStream","Readable","pipe","push","getIsolationLevelText","join","processedInitialSql","execSqlBatch","makeRequest","sqlTextOrProcedure","execSql","validateParameters","databaseCollation","parameters","TYPES","NVarChar","output","length","precision","scale","makeParamsParameter","RPC_REQUEST","Sp_ExecuteSql","newBulkLoad","table","callbackOrOptions","execBulkLoad","bulkLoad","rows","executionStarted","streamingMode","firstRowWritten","rowStream","rowToPacketTransform","onCancel","BulkLoadPayload","getBulkInsertSql","BULK_LOAD","prepare","Int","preparing","handle","Sp_Prepare","unprepare","Sp_Unprepare","execute","executeParameters","len","parameter","validate","Sp_Execute","callProcedure","beginTransaction","transaction","Transaction","isolationLevelToTSQL","TRANSACTION_MANAGER","beginPayload","commitTransaction","commitPayload","rollbackTransaction","rollbackPayload","saveTransaction","savePayload","cb","useSavepoint","randomBytes","txDone","done","LOGGED_IN","txErr","packetType","canceled","connection","rowCount","rst","payloadStream","unpipe","ignore","paused","resume","resetConnection","resetConnectionOnNextRequest","SENT_CLIENT_REQUEST","reset","READ_UNCOMMITTED","REPEATABLE_READ","SERIALIZABLE","SNAPSHOT","isTransientError","AggregateError","errors","isTransient","_default","exports","module","readMessage","concat","preloginPayload","encryptionString","_this$routingData$ser","_this$routingData","startTls","SENT_LOGIN7_WITH_FEDAUTH","SENT_LOGIN7_WITH_NTLM","reconnect","retry","Login7TokenHandler","tokenStreamParser","loginAckReceived","LOGGED_IN_SENDING_INITIAL_SQL","ntlmpacket","NTLMAUTH_PKT","_authentication$optio","fedAuthInfoToken","stsurl","spn","tokenScope","URL","credentials","UsernamePasswordCredential","msiArgs","ManagedIdentityCredential","managedIdentityClientId","DefaultAzureCredential","ClientSecretCredential","tokenResponse","getToken","InitialSqlTokenHandler","_this$request","_this$request3","_this$request10","RequestTokenHandler","SENT_ATTENTION","onResume","onPause","_this$request2","pause","_this$request4","_this$request5","onEndOfMessage","_this$request6","_this$request7","_this$request8","_this$request9","sqlRequest","nextState","AttentionTokenHandler","attentionReceived"],"sources":["C:\\Users\\phlos\\wv-temperature-map\\src\\backend\\node_modules\\tedious\\src\\connection.ts"],"sourcesContent":["import crypto from 'crypto';\nimport os from 'os';\nimport * as tls from 'tls';\nimport * as net from 'net';\nimport dns from 'dns';\n\nimport constants from 'constants';\nimport { type SecureContextOptions } from 'tls';\n\nimport { Readable } from 'stream';\n\nimport {\n  ClientSecretCredential,\n  DefaultAzureCredential,\n  ManagedIdentityCredential,\n  UsernamePasswordCredential\n} from '@azure/identity';\nimport { type AccessToken, type TokenCredential, isTokenCredential } from '@azure/core-auth';\n\nimport BulkLoad, { type Options as BulkLoadOptions, type Callback as BulkLoadCallback } from './bulk-load';\nimport Debug from './debug';\nimport { EventEmitter, once } from 'events';\nimport { instanceLookup } from './instance-lookup';\nimport { TransientErrorLookup } from './transient-error-lookup';\nimport { TYPE } from './packet';\nimport PreloginPayload from './prelogin-payload';\nimport Login7Payload from './login7-payload';\nimport NTLMResponsePayload from './ntlm-payload';\nimport Request from './request';\nimport RpcRequestPayload from './rpcrequest-payload';\nimport SqlBatchPayload from './sqlbatch-payload';\nimport MessageIO from './message-io';\nimport { Parser as TokenStreamParser } from './token/token-stream-parser';\nimport { Transaction, ISOLATION_LEVEL, assertValidIsolationLevel } from './transaction';\nimport { ConnectionError, RequestError } from './errors';\nimport { connectInParallel, connectInSequence } from './connector';\nimport { name as libraryName } from './library';\nimport { versions } from './tds-versions';\nimport Message from './message';\nimport { type Metadata } from './metadata-parser';\nimport { createNTLMRequest } from './ntlm';\nimport { ColumnEncryptionAzureKeyVaultProvider } from './always-encrypted/keystore-provider-azure-key-vault';\n\nimport { type Parameter, TYPES } from './data-type';\nimport { BulkLoadPayload } from './bulk-load-payload';\nimport { Collation } from './collation';\nimport Procedures from './special-stored-procedure';\n\nimport { version } from '../package.json';\nimport { URL } from 'url';\nimport { AttentionTokenHandler, InitialSqlTokenHandler, Login7TokenHandler, RequestTokenHandler, TokenHandler } from './token/handler';\n\ntype BeginTransactionCallback =\n  /**\n   * The callback is called when the request to start the transaction has completed,\n   * either successfully or with an error.\n   * If an error occurred then `err` will describe the error.\n   *\n   * As only one request at a time may be executed on a connection, another request should not\n   * be initiated until this callback is called.\n   *\n   * @param err If an error occurred, an [[Error]] object with details of the error.\n   * @param transactionDescriptor A Buffer that describe the transaction\n   */\n  (err: Error | null | undefined, transactionDescriptor?: Buffer) => void\n\ntype SaveTransactionCallback =\n  /**\n   * The callback is called when the request to set a savepoint within the\n   * transaction has completed, either successfully or with an error.\n   * If an error occurred then `err` will describe the error.\n   *\n   * As only one request at a time may be executed on a connection, another request should not\n   * be initiated until this callback is called.\n   *\n   * @param err If an error occurred, an [[Error]] object with details of the error.\n   */\n  (err: Error | null | undefined) => void;\n\ntype CommitTransactionCallback =\n  /**\n   * The callback is called when the request to commit the transaction has completed,\n   * either successfully or with an error.\n   * If an error occurred then `err` will describe the error.\n   *\n   * As only one request at a time may be executed on a connection, another request should not\n   * be initiated until this callback is called.\n   *\n   * @param err If an error occurred, an [[Error]] object with details of the error.\n   */\n  (err: Error | null | undefined) => void;\n\ntype RollbackTransactionCallback =\n  /**\n   * The callback is called when the request to rollback the transaction has\n   * completed, either successfully or with an error.\n   * If an error occurred then err will describe the error.\n   *\n   * As only one request at a time may be executed on a connection, another request should not\n   * be initiated until this callback is called.\n   *\n   * @param err If an error occurred, an [[Error]] object with details of the error.\n   */\n  (err: Error | null | undefined) => void;\n\ntype ResetCallback =\n  /**\n   * The callback is called when the connection reset has completed,\n   * either successfully or with an error.\n   *\n   * If an error occurred then `err` will describe the error.\n   *\n   * As only one request at a time may be executed on a connection, another\n   * request should not be initiated until this callback is called\n   *\n   * @param err If an error occurred, an [[Error]] object with details of the error.\n   */\n  (err: Error | null | undefined) => void;\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ntype TransactionCallback<T extends (err: Error | null | undefined, ...args: any[]) => void> =\n  /**\n   * The callback is called when the request to start a transaction (or create a savepoint, in\n   * the case of a nested transaction) has completed, either successfully or with an error.\n   * If an error occurred, then `err` will describe the error.\n   * If no error occurred, the callback should perform its work and eventually call\n   * `done` with an error or null (to trigger a transaction rollback or a\n   * transaction commit) and an additional completion callback that will be called when the request\n   * to rollback or commit the current transaction has completed, either successfully or with an error.\n   * Additional arguments given to `done` will be passed through to this callback.\n   *\n   * As only one request at a time may be executed on a connection, another request should not\n   * be initiated until the completion callback is called.\n   *\n   * @param err If an error occurred, an [[Error]] object with details of the error.\n   * @param txDone If no error occurred, a function to be called to commit or rollback the transaction.\n   */\n  (err: Error | null | undefined, txDone?: TransactionDone<T>) => void;\n\ntype TransactionDoneCallback = (err: Error | null | undefined, ...args: any[]) => void;\ntype CallbackParameters<T extends (err: Error | null | undefined, ...args: any[]) => any> = T extends (err: Error | null | undefined, ...args: infer P) => any ? P : never;\n\ntype TransactionDone<T extends (err: Error | null | undefined, ...args: any[]) => void> =\n  /**\n   * If no error occurred, a function to be called to commit or rollback the transaction.\n   *\n   * @param err If an err occurred, a string with details of the error.\n   */\n  (err: Error | null | undefined, done: T, ...args: CallbackParameters<T>) => void;\n\n/**\n * @private\n */\nconst KEEP_ALIVE_INITIAL_DELAY = 30 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CONNECT_TIMEOUT = 15 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CLIENT_REQUEST_TIMEOUT = 15 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CANCEL_TIMEOUT = 5 * 1000;\n/**\n * @private\n */\nconst DEFAULT_CONNECT_RETRY_INTERVAL = 500;\n/**\n * @private\n */\nconst DEFAULT_PACKET_SIZE = 4 * 1024;\n/**\n * @private\n */\nconst DEFAULT_TEXTSIZE = 2147483647;\n/**\n * @private\n */\nconst DEFAULT_DATEFIRST = 7;\n/**\n * @private\n */\nconst DEFAULT_PORT = 1433;\n/**\n * @private\n */\nconst DEFAULT_TDS_VERSION = '7_4';\n/**\n * @private\n */\nconst DEFAULT_LANGUAGE = 'us_english';\n/**\n * @private\n */\nconst DEFAULT_DATEFORMAT = 'mdy';\n\ninterface AzureActiveDirectoryMsiAppServiceAuthentication {\n  type: 'azure-active-directory-msi-app-service';\n  options: {\n    /**\n     * If you user want to connect to an Azure app service using a specific client account\n     * they need to provide `clientId` associate to their created identity.\n     *\n     * This is optional for retrieve token from azure web app service\n     */\n    clientId?: string;\n  };\n}\n\ninterface AzureActiveDirectoryMsiVmAuthentication {\n  type: 'azure-active-directory-msi-vm';\n  options: {\n    /**\n     * If you want to connect using a specific client account\n     * they need to provide `clientId` associated to their created identity.\n     *\n     * This is optional for retrieve a token\n     */\n    clientId?: string;\n  };\n}\n\ninterface AzureActiveDirectoryDefaultAuthentication {\n  type: 'azure-active-directory-default';\n  options: {\n    /**\n     * If you want to connect using a specific client account\n     * they need to provide `clientId` associated to their created identity.\n     *\n     * This is optional for retrieving a token\n     */\n    clientId?: string;\n  };\n}\n\n\ninterface AzureActiveDirectoryAccessTokenAuthentication {\n  type: 'azure-active-directory-access-token';\n  options: {\n    /**\n     * A user need to provide `token` which they retrieved else where\n     * to forming the connection.\n     */\n    token: string;\n  };\n}\n\ninterface AzureActiveDirectoryPasswordAuthentication {\n  type: 'azure-active-directory-password';\n  options: {\n    /**\n     * A user need to provide `userName` associate to their account.\n     */\n    userName: string;\n\n    /**\n     * A user need to provide `password` associate to their account.\n     */\n    password: string;\n\n    /**\n     * A client id to use.\n     */\n    clientId: string;\n\n    /**\n     * Optional parameter for specific Azure tenant ID\n     */\n    tenantId: string;\n  };\n}\n\ninterface AzureActiveDirectoryServicePrincipalSecret {\n  type: 'azure-active-directory-service-principal-secret';\n  options: {\n    /**\n     * Application (`client`) ID from your registered Azure application\n     */\n    clientId: string;\n    /**\n     * The created `client secret` for this registered Azure application\n     */\n    clientSecret: string;\n    /**\n     * Directory (`tenant`) ID from your registered Azure application\n     */\n    tenantId: string;\n  };\n}\n\n/** Structure that defines the options that are necessary to authenticate the Tedious.JS instance with an `@azure/identity` token credential. */\ninterface TokenCredentialAuthentication {\n  /** Unique designator for the type of authentication to be used. */\n  type: 'token-credential';\n  /** Set of configurations that are required or allowed with this authentication type. */\n  options: {\n    /** Credential object used to authenticate to the resource. */\n    credential: TokenCredential;\n  };\n}\n\ninterface NtlmAuthentication {\n  type: 'ntlm';\n  options: {\n    /**\n     * User name from your windows account.\n     */\n    userName: string;\n    /**\n     * Password from your windows account.\n     */\n    password: string;\n    /**\n     * Once you set domain for ntlm authentication type, driver will connect to SQL Server using domain login.\n     *\n     * This is necessary for forming a connection using ntlm type\n     */\n    domain: string;\n  };\n}\n\ninterface DefaultAuthentication {\n  type: 'default';\n  options: {\n    /**\n     * User name to use for sql server login.\n     */\n    userName?: string | undefined;\n    /**\n     * Password to use for sql server login.\n     */\n    password?: string | undefined;\n  };\n}\n\ninterface ErrorWithCode extends Error {\n  code?: string;\n}\n\nexport type ConnectionAuthentication = DefaultAuthentication | NtlmAuthentication | TokenCredentialAuthentication | AzureActiveDirectoryPasswordAuthentication | AzureActiveDirectoryMsiAppServiceAuthentication | AzureActiveDirectoryMsiVmAuthentication | AzureActiveDirectoryAccessTokenAuthentication | AzureActiveDirectoryServicePrincipalSecret | AzureActiveDirectoryDefaultAuthentication;\n\ninterface InternalConnectionConfig {\n  server: string;\n  authentication: ConnectionAuthentication;\n  options: InternalConnectionOptions;\n}\n\nexport interface InternalConnectionOptions {\n  abortTransactionOnError: boolean;\n  appName: undefined | string;\n  camelCaseColumns: boolean;\n  cancelTimeout: number;\n  columnEncryptionKeyCacheTTL: number;\n  columnEncryptionSetting: boolean;\n  columnNameReplacer: undefined | ((colName: string, index: number, metadata: Metadata) => string);\n  connectionRetryInterval: number;\n  connector: undefined | (() => Promise<net.Socket>);\n  connectTimeout: number;\n  connectionIsolationLevel: typeof ISOLATION_LEVEL[keyof typeof ISOLATION_LEVEL];\n  cryptoCredentialsDetails: SecureContextOptions;\n  database: undefined | string;\n  datefirst: number;\n  dateFormat: string;\n  debug: {\n    data: boolean;\n    packet: boolean;\n    payload: boolean;\n    token: boolean;\n  };\n  enableAnsiNull: null | boolean;\n  enableAnsiNullDefault: null | boolean;\n  enableAnsiPadding: null | boolean;\n  enableAnsiWarnings: null | boolean;\n  enableArithAbort: null | boolean;\n  enableConcatNullYieldsNull: null | boolean;\n  enableCursorCloseOnCommit: null | boolean;\n  enableImplicitTransactions: null | boolean;\n  enableNumericRoundabort: null | boolean;\n  enableQuotedIdentifier: null | boolean;\n  encrypt: string | boolean;\n  encryptionKeyStoreProviders: KeyStoreProviderMap | undefined;\n  fallbackToDefaultDb: boolean;\n  instanceName: undefined | string;\n  isolationLevel: typeof ISOLATION_LEVEL[keyof typeof ISOLATION_LEVEL];\n  language: string;\n  localAddress: undefined | string;\n  maxRetriesOnTransientErrors: number;\n  multiSubnetFailover: boolean;\n  packetSize: number;\n  port: undefined | number;\n  readOnlyIntent: boolean;\n  requestTimeout: number;\n  rowCollectionOnDone: boolean;\n  rowCollectionOnRequestCompletion: boolean;\n  serverName: undefined | string;\n  serverSupportsColumnEncryption: boolean;\n  tdsVersion: string;\n  textsize: number;\n  trustedServerNameAE: string | undefined;\n  trustServerCertificate: boolean;\n  useColumnNames: boolean;\n  useUTC: boolean;\n  workstationId: undefined | string;\n  lowerCaseGuids: boolean;\n}\n\ninterface KeyStoreProviderMap {\n  [key: string]: ColumnEncryptionAzureKeyVaultProvider;\n}\n\n/**\n * @private\n */\ninterface State {\n  name: string;\n  enter?(this: Connection): void;\n  exit?(this: Connection, newState: State): void;\n  events: {\n    socketError?(this: Connection, err: Error): void;\n    connectTimeout?(this: Connection): void;\n    message?(this: Connection, message: Message): void;\n    retry?(this: Connection): void;\n    reconnect?(this: Connection): void;\n  };\n}\n\ntype Authentication = DefaultAuthentication |\n  NtlmAuthentication |\n  TokenCredentialAuthentication |\n  AzureActiveDirectoryPasswordAuthentication |\n  AzureActiveDirectoryMsiAppServiceAuthentication |\n  AzureActiveDirectoryMsiVmAuthentication |\n  AzureActiveDirectoryAccessTokenAuthentication |\n  AzureActiveDirectoryServicePrincipalSecret |\n  AzureActiveDirectoryDefaultAuthentication;\n\ntype AuthenticationType = Authentication['type'];\n\nexport interface ConnectionConfiguration {\n  /**\n   * Hostname to connect to.\n   */\n  server: string;\n  /**\n   * Configuration options for forming the connection.\n   */\n  options?: ConnectionOptions;\n  /**\n   * Authentication related options for connection.\n   */\n  authentication?: AuthenticationOptions;\n}\n\ninterface DebugOptions {\n  /**\n   * A boolean, controlling whether [[debug]] events will be emitted with text describing packet data details\n   *\n   * (default: `false`)\n   */\n  data: boolean;\n  /**\n   * A boolean, controlling whether [[debug]] events will be emitted with text describing packet details\n   *\n   * (default: `false`)\n   */\n  packet: boolean;\n  /**\n   * A boolean, controlling whether [[debug]] events will be emitted with text describing packet payload details\n   *\n   * (default: `false`)\n   */\n  payload: boolean;\n  /**\n   * A boolean, controlling whether [[debug]] events will be emitted with text describing token stream tokens\n   *\n   * (default: `false`)\n   */\n  token: boolean;\n}\n\ninterface AuthenticationOptions {\n  /**\n   * Type of the authentication method, valid types are `default`, `ntlm`,\n   * `azure-active-directory-password`, `azure-active-directory-access-token`,\n   * `azure-active-directory-msi-vm`, `azure-active-directory-msi-app-service`,\n   * `azure-active-directory-default`\n   * or `azure-active-directory-service-principal-secret`\n   */\n  type?: AuthenticationType;\n  /**\n   * Different options for authentication types:\n   *\n   * * `default`: [[DefaultAuthentication.options]]\n   * * `ntlm` :[[NtlmAuthentication]]\n   * * `token-credential`: [[CredentialChainAuthentication.options]]\n   * * `azure-active-directory-password` : [[AzureActiveDirectoryPasswordAuthentication.options]]\n   * * `azure-active-directory-access-token` : [[AzureActiveDirectoryAccessTokenAuthentication.options]]\n   * * `azure-active-directory-msi-vm` : [[AzureActiveDirectoryMsiVmAuthentication.options]]\n   * * `azure-active-directory-msi-app-service` : [[AzureActiveDirectoryMsiAppServiceAuthentication.options]]\n   * * `azure-active-directory-service-principal-secret` : [[AzureActiveDirectoryServicePrincipalSecret.options]]\n   * * `azure-active-directory-default` : [[AzureActiveDirectoryDefaultAuthentication.options]]\n   */\n  options?: any;\n}\n\nexport interface ConnectionOptions {\n  /**\n   * A boolean determining whether to rollback a transaction automatically if any error is encountered\n   * during the given transaction's execution. This sets the value for `SET XACT_ABORT` during the\n   * initial SQL phase of a connection [documentation](https://docs.microsoft.com/en-us/sql/t-sql/statements/set-xact-abort-transact-sql).\n   */\n  abortTransactionOnError?: boolean | undefined;\n\n  /**\n   * Application name used for identifying a specific application in profiling, logging or tracing tools of SQLServer.\n   *\n   * (default: `Tedious`)\n   */\n  appName?: string | undefined;\n\n  /**\n   * A boolean, controlling whether the column names returned will have the first letter converted to lower case\n   * (`true`) or not. This value is ignored if you provide a [[columnNameReplacer]].\n   *\n   * (default: `false`).\n   */\n  camelCaseColumns?: boolean;\n\n  /**\n   * The number of milliseconds before the [[Request.cancel]] (abort) of a request is considered failed\n   *\n   * (default: `5000`).\n   */\n  cancelTimeout?: number;\n\n  /**\n   * A function with parameters `(columnName, index, columnMetaData)` and returning a string. If provided,\n   * this will be called once per column per result-set. The returned value will be used instead of the SQL-provided\n   * column name on row and meta data objects. This allows you to dynamically convert between naming conventions.\n   *\n   * (default: `null`)\n   */\n  columnNameReplacer?: (colName: string, index: number, metadata: Metadata) => string;\n\n  /**\n   * Number of milliseconds before retrying to establish connection, in case of transient failure.\n   *\n   * (default:`500`)\n   */\n  connectionRetryInterval?: number;\n\n  /**\n   * Custom connector factory method.\n   *\n   * (default: `undefined`)\n   */\n  connector?: () => Promise<net.Socket>;\n\n  /**\n   * The number of milliseconds before the attempt to connect is considered failed\n   *\n   * (default: `15000`).\n   */\n  connectTimeout?: number;\n\n  /**\n   * The default isolation level for new connections. All out-of-transaction queries are executed with this setting.\n   *\n   * The isolation levels are available from `require('tedious').ISOLATION_LEVEL`.\n   * * `READ_UNCOMMITTED`\n   * * `READ_COMMITTED`\n   * * `REPEATABLE_READ`\n   * * `SERIALIZABLE`\n   * * `SNAPSHOT`\n   *\n   * (default: `READ_COMMITED`).\n   */\n  connectionIsolationLevel?: number;\n\n  /**\n   * When encryption is used, an object may be supplied that will be used\n   * for the first argument when calling [`tls.createSecurePair`](http://nodejs.org/docs/latest/api/tls.html#tls_tls_createsecurepair_credentials_isserver_requestcert_rejectunauthorized)\n   *\n   * (default: `{}`)\n   */\n  cryptoCredentialsDetails?: SecureContextOptions;\n\n  /**\n   * Database to connect to (default: dependent on server configuration).\n   */\n  database?: string | undefined;\n\n  /**\n   * Sets the first day of the week to a number from 1 through 7.\n   */\n  datefirst?: number;\n\n  /**\n   * A string representing position of month, day and year in temporal datatypes.\n   *\n   * (default: `mdy`)\n   */\n  dateFormat?: string;\n\n  debug?: DebugOptions;\n\n  /**\n   * A boolean, controls the way null values should be used during comparison operation.\n   *\n   * (default: `true`)\n   */\n  enableAnsiNull?: boolean;\n\n  /**\n   * If true, `SET ANSI_NULL_DFLT_ON ON` will be set in the initial sql. This means new columns will be\n   * nullable by default. See the [T-SQL documentation](https://msdn.microsoft.com/en-us/library/ms187375.aspx)\n   *\n   * (default: `true`).\n   */\n  enableAnsiNullDefault?: boolean;\n\n  /**\n   * A boolean, controls if padding should be applied for values shorter than the size of defined column.\n   *\n   * (default: `true`)\n   */\n  enableAnsiPadding?: boolean;\n\n  /**\n   * If true, SQL Server will follow ISO standard behavior during various error conditions. For details,\n   * see [documentation](https://docs.microsoft.com/en-us/sql/t-sql/statements/set-ansi-warnings-transact-sql)\n   *\n   * (default: `true`)\n   */\n  enableAnsiWarnings?: boolean;\n\n  /**\n   * Ends a query when an overflow or divide-by-zero error occurs during query execution.\n   * See [documentation](https://docs.microsoft.com/en-us/sql/t-sql/statements/set-arithabort-transact-sql?view=sql-server-2017)\n   * for more details.\n   *\n   * (default: `true`)\n   */\n  enableArithAbort?: boolean;\n\n  /**\n   * A boolean, determines if concatenation with NULL should result in NULL or empty string value, more details in\n   * [documentation](https://docs.microsoft.com/en-us/sql/t-sql/statements/set-concat-null-yields-null-transact-sql)\n   *\n   * (default: `true`)\n   */\n  enableConcatNullYieldsNull?: boolean;\n\n  /**\n   * A boolean, controls whether cursor should be closed, if the transaction opening it gets committed or rolled\n   * back.\n   *\n   * (default: `null`)\n   */\n  enableCursorCloseOnCommit?: boolean | null;\n\n  /**\n   * A boolean, sets the connection to either implicit or autocommit transaction mode.\n   *\n   * (default: `false`)\n   */\n  enableImplicitTransactions?: boolean;\n\n  /**\n   * If false, error is not generated during loss of precession.\n   *\n   * (default: `false`)\n   */\n  enableNumericRoundabort?: boolean;\n\n  /**\n   * If true, characters enclosed in single quotes are treated as literals and those enclosed double quotes are treated as identifiers.\n   *\n   * (default: `true`)\n   */\n  enableQuotedIdentifier?: boolean;\n\n  /**\n   * A string value that can be only set to 'strict', which indicates the usage TDS 8.0 protocol. Otherwise,\n   * a boolean determining whether or not the connection will be encrypted.\n   *\n   * (default: `true`)\n   */\n  encrypt?: string | boolean;\n\n  /**\n   * By default, if the database requested by [[database]] cannot be accessed,\n   * the connection will fail with an error. However, if [[fallbackToDefaultDb]] is\n   * set to `true`, then the user's default database will be used instead\n   *\n   * (default: `false`)\n   */\n  fallbackToDefaultDb?: boolean;\n\n  /**\n   * The instance name to connect to.\n   * The SQL Server Browser service must be running on the database server,\n   * and UDP port 1434 on the database server must be reachable.\n   *\n   * (no default)\n   *\n   * Mutually exclusive with [[port]].\n   */\n  instanceName?: string | undefined;\n\n  /**\n   * The default isolation level that transactions will be run with.\n   *\n   * The isolation levels are available from `require('tedious').ISOLATION_LEVEL`.\n   * * `READ_UNCOMMITTED`\n   * * `READ_COMMITTED`\n   * * `REPEATABLE_READ`\n   * * `SERIALIZABLE`\n   * * `SNAPSHOT`\n   *\n   * (default: `READ_COMMITED`).\n   */\n  isolationLevel?: number;\n\n  /**\n   * Specifies the language environment for the session. The session language determines the datetime formats and system messages.\n   *\n   * (default: `us_english`).\n   */\n  language?: string;\n\n  /**\n   * A string indicating which network interface (ip address) to use when connecting to SQL Server.\n   */\n  localAddress?: string | undefined;\n\n  /**\n   * A boolean determining whether to parse unique identifier type with lowercase case characters.\n   *\n   * (default: `false`).\n   */\n  lowerCaseGuids?: boolean;\n\n  /**\n   * The maximum number of connection retries for transient errors.、\n   *\n   * (default: `3`).\n   */\n  maxRetriesOnTransientErrors?: number;\n\n  /**\n   * Sets the MultiSubnetFailover = True parameter, which can help minimize the client recovery latency when failovers occur.\n   *\n   * (default: `false`).\n   */\n  multiSubnetFailover?: boolean;\n\n  /**\n   * The size of TDS packets (subject to negotiation with the server).\n   * Should be a power of 2.\n   *\n   * (default: `4096`).\n   */\n  packetSize?: number;\n\n  /**\n   * Port to connect to (default: `1433`).\n   *\n   * Mutually exclusive with [[instanceName]]\n   */\n  port?: number | undefined;\n\n  /**\n   * A boolean, determining whether the connection will request read only access from a SQL Server Availability\n   * Group. For more information, see [here](http://msdn.microsoft.com/en-us/library/hh710054.aspx \"Microsoft: Configure Read-Only Routing for an Availability Group (SQL Server)\")\n   *\n   * (default: `false`).\n   */\n  readOnlyIntent?: boolean;\n\n  /**\n   * The number of milliseconds before a request is considered failed, or `0` for no timeout.\n   *\n   * As soon as a response is received, the timeout is cleared. This means that queries that immediately return a response have ability to run longer than this timeout.\n   *\n   * (default: `15000`).\n   */\n  requestTimeout?: number;\n\n  /**\n   * A boolean, that when true will expose received rows in Requests done related events:\n   * * [[Request.Event_doneInProc]]\n   * * [[Request.Event_doneProc]]\n   * * [[Request.Event_done]]\n   *\n   * (default: `false`)\n   *\n   * Caution: If many row are received, enabling this option could result in\n   * excessive memory usage.\n   */\n  rowCollectionOnDone?: boolean;\n\n  /**\n   * A boolean, that when true will expose received rows in Requests' completion callback.See [[Request.constructor]].\n   *\n   * (default: `false`)\n   *\n   * Caution: If many row are received, enabling this option could result in\n   * excessive memory usage.\n   */\n  rowCollectionOnRequestCompletion?: boolean;\n\n  /**\n   * The version of TDS to use. If server doesn't support specified version, negotiated version is used instead.\n   *\n   * The versions are available from `require('tedious').TDS_VERSION`.\n   * * `7_1`\n   * * `7_2`\n   * * `7_3_A`\n   * * `7_3_B`\n   * * `7_4`\n   *\n   * (default: `7_4`)\n   */\n  tdsVersion?: string | undefined;\n\n  /**\n   * Specifies the size of varchar(max), nvarchar(max), varbinary(max), text, ntext, and image data returned by a SELECT statement.\n   *\n   * (default: `2147483647`)\n   */\n  textsize?: number;\n\n  /**\n   * If \"true\", the SQL Server SSL certificate is automatically trusted when the communication layer is encrypted using SSL.\n   *\n   * If \"false\", the SQL Server validates the server SSL certificate. If the server certificate validation fails,\n   * the driver raises an error and terminates the connection. Make sure the value passed to serverName exactly\n   * matches the Common Name (CN) or DNS name in the Subject Alternate Name in the server certificate for an SSL connection to succeed.\n   *\n   * (default: `true`)\n   */\n  trustServerCertificate?: boolean;\n\n  /**\n   *\n   */\n  serverName?: string;\n  /**\n   * A boolean determining whether to return rows as arrays or key-value collections.\n   *\n   * (default: `false`).\n   */\n  useColumnNames?: boolean;\n\n  /**\n   * A boolean determining whether to pass time values in UTC or local time.\n   *\n   * (default: `true`).\n   */\n  useUTC?: boolean;\n\n  /**\n   * The workstation ID (WSID) of the client, default os.hostname().\n   * Used for identifying a specific client in profiling, logging or\n   * tracing client activity in SQLServer.\n   *\n   * The value is reported by the TSQL function HOST_NAME().\n   */\n  workstationId?: string | undefined;\n}\n\n/**\n * @private\n */\nconst CLEANUP_TYPE = {\n  NORMAL: 0,\n  REDIRECT: 1,\n  RETRY: 2\n};\n\ninterface RoutingData {\n  server: string;\n  port: number;\n}\n\n/**\n * A [[Connection]] instance represents a single connection to a database server.\n *\n * ```js\n * var Connection = require('tedious').Connection;\n * var config = {\n *  \"authentication\": {\n *    ...,\n *    \"options\": {...}\n *  },\n *  \"options\": {...}\n * };\n * var connection = new Connection(config);\n * ```\n *\n * Only one request at a time may be executed on a connection. Once a [[Request]]\n * has been initiated (with [[Connection.callProcedure]], [[Connection.execSql]],\n * or [[Connection.execSqlBatch]]), another should not be initiated until the\n * [[Request]]'s completion callback is called.\n */\nclass Connection extends EventEmitter {\n  /**\n   * @private\n   */\n  declare fedAuthRequired: boolean;\n  /**\n   * @private\n   */\n  declare config: InternalConnectionConfig;\n  /**\n   * @private\n   */\n  declare secureContextOptions: SecureContextOptions;\n  /**\n   * @private\n   */\n  declare inTransaction: boolean;\n  /**\n   * @private\n   */\n  declare transactionDescriptors: Buffer[];\n  /**\n   * @private\n   */\n  declare transactionDepth: number;\n  /**\n   * @private\n   */\n  declare isSqlBatch: boolean;\n  /**\n   * @private\n   */\n  declare curTransientRetryCount: number;\n  /**\n   * @private\n   */\n  declare transientErrorLookup: TransientErrorLookup;\n  /**\n   * @private\n   */\n  declare closed: boolean;\n  /**\n   * @private\n   */\n  declare loginError: undefined | AggregateError | ConnectionError;\n  /**\n   * @private\n   */\n  declare debug: Debug;\n  /**\n   * @private\n   */\n  declare ntlmpacket: undefined | any;\n  /**\n   * @private\n   */\n  declare ntlmpacketBuffer: undefined | Buffer;\n\n  /**\n   * @private\n   */\n  declare STATE: {\n    INITIALIZED: State;\n    CONNECTING: State;\n    SENT_PRELOGIN: State;\n    REROUTING: State;\n    TRANSIENT_FAILURE_RETRY: State;\n    SENT_TLSSSLNEGOTIATION: State;\n    SENT_LOGIN7_WITH_STANDARD_LOGIN: State;\n    SENT_LOGIN7_WITH_NTLM: State;\n    SENT_LOGIN7_WITH_FEDAUTH: State;\n    LOGGED_IN_SENDING_INITIAL_SQL: State;\n    LOGGED_IN: State;\n    SENT_CLIENT_REQUEST: State;\n    SENT_ATTENTION: State;\n    FINAL: State;\n  };\n\n  /**\n   * @private\n   */\n  declare routingData: undefined | RoutingData;\n\n  /**\n   * @private\n   */\n  declare messageIo: MessageIO;\n  /**\n   * @private\n   */\n  declare state: State;\n  /**\n   * @private\n   */\n  declare resetConnectionOnNextRequest: undefined | boolean;\n\n  /**\n   * @private\n   */\n  declare request: undefined | Request | BulkLoad;\n  /**\n   * @private\n   */\n  declare procReturnStatusValue: undefined | any;\n  /**\n   * @private\n   */\n  declare socket: undefined | net.Socket;\n  /**\n   * @private\n   */\n  declare messageBuffer: Buffer;\n\n  /**\n   * @private\n   */\n  declare connectTimer: undefined | NodeJS.Timeout;\n  /**\n   * @private\n   */\n  declare cancelTimer: undefined | NodeJS.Timeout;\n  /**\n   * @private\n   */\n  declare requestTimer: undefined | NodeJS.Timeout;\n  /**\n   * @private\n   */\n  declare retryTimer: undefined | NodeJS.Timeout;\n\n  /**\n   * @private\n   */\n  _cancelAfterRequestSent: () => void;\n\n  /**\n   * @private\n   */\n  declare databaseCollation: Collation | undefined;\n\n  /**\n   * Note: be aware of the different options field:\n   * 1. config.authentication.options\n   * 2. config.options\n   *\n   * ```js\n   * const { Connection } = require('tedious');\n   *\n   * const config = {\n   *  \"authentication\": {\n   *    ...,\n   *    \"options\": {...}\n   *  },\n   *  \"options\": {...}\n   * };\n   *\n   * const connection = new Connection(config);\n   * ```\n   *\n   * @param config\n   */\n  constructor(config: ConnectionConfiguration) {\n    super();\n\n    if (typeof config !== 'object' || config === null) {\n      throw new TypeError('The \"config\" argument is required and must be of type Object.');\n    }\n\n    if (typeof config.server !== 'string') {\n      throw new TypeError('The \"config.server\" property is required and must be of type string.');\n    }\n\n    this.fedAuthRequired = false;\n\n    let authentication: ConnectionAuthentication;\n    if (config.authentication !== undefined) {\n      if (typeof config.authentication !== 'object' || config.authentication === null) {\n        throw new TypeError('The \"config.authentication\" property must be of type Object.');\n      }\n\n      const type = config.authentication.type;\n      const options = config.authentication.options === undefined ? {} : config.authentication.options;\n\n      if (typeof type !== 'string') {\n        throw new TypeError('The \"config.authentication.type\" property must be of type string.');\n      }\n\n      if (type !== 'default' && type !== 'ntlm' && type !== 'token-credential' && type !== 'azure-active-directory-password' && type !== 'azure-active-directory-access-token' && type !== 'azure-active-directory-msi-vm' && type !== 'azure-active-directory-msi-app-service' && type !== 'azure-active-directory-service-principal-secret' && type !== 'azure-active-directory-default') {\n        throw new TypeError('The \"type\" property must one of \"default\", \"ntlm\", \"token-credential\", \"azure-active-directory-password\", \"azure-active-directory-access-token\", \"azure-active-directory-default\", \"azure-active-directory-msi-vm\" or \"azure-active-directory-msi-app-service\" or \"azure-active-directory-service-principal-secret\".');\n      }\n\n      if (typeof options !== 'object' || options === null) {\n        throw new TypeError('The \"config.authentication.options\" property must be of type object.');\n      }\n\n      if (type === 'ntlm') {\n        if (typeof options.domain !== 'string') {\n          throw new TypeError('The \"config.authentication.options.domain\" property must be of type string.');\n        }\n\n        if (options.userName !== undefined && typeof options.userName !== 'string') {\n          throw new TypeError('The \"config.authentication.options.userName\" property must be of type string.');\n        }\n\n        if (options.password !== undefined && typeof options.password !== 'string') {\n          throw new TypeError('The \"config.authentication.options.password\" property must be of type string.');\n        }\n\n        authentication = {\n          type: 'ntlm',\n          options: {\n            userName: options.userName,\n            password: options.password,\n            domain: options.domain && options.domain.toUpperCase()\n          }\n        };\n      } else if (type === 'token-credential') {\n        if (!isTokenCredential(options.credential)) {\n          throw new TypeError('The \"config.authentication.options.credential\" property must be an instance of the token credential class.');\n        }\n\n        authentication = {\n          type: 'token-credential',\n          options: {\n            credential: options.credential\n          }\n        };\n      } else if (type === 'azure-active-directory-password') {\n        if (typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n\n        if (options.userName !== undefined && typeof options.userName !== 'string') {\n          throw new TypeError('The \"config.authentication.options.userName\" property must be of type string.');\n        }\n\n        if (options.password !== undefined && typeof options.password !== 'string') {\n          throw new TypeError('The \"config.authentication.options.password\" property must be of type string.');\n        }\n\n        if (options.tenantId !== undefined && typeof options.tenantId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.tenantId\" property must be of type string.');\n        }\n\n        authentication = {\n          type: 'azure-active-directory-password',\n          options: {\n            userName: options.userName,\n            password: options.password,\n            tenantId: options.tenantId,\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-access-token') {\n        if (typeof options.token !== 'string') {\n          throw new TypeError('The \"config.authentication.options.token\" property must be of type string.');\n        }\n\n        authentication = {\n          type: 'azure-active-directory-access-token',\n          options: {\n            token: options.token\n          }\n        };\n      } else if (type === 'azure-active-directory-msi-vm') {\n        if (options.clientId !== undefined && typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n\n        authentication = {\n          type: 'azure-active-directory-msi-vm',\n          options: {\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-default') {\n        if (options.clientId !== undefined && typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n        authentication = {\n          type: 'azure-active-directory-default',\n          options: {\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-msi-app-service') {\n        if (options.clientId !== undefined && typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n\n        authentication = {\n          type: 'azure-active-directory-msi-app-service',\n          options: {\n            clientId: options.clientId\n          }\n        };\n      } else if (type === 'azure-active-directory-service-principal-secret') {\n        if (typeof options.clientId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientId\" property must be of type string.');\n        }\n\n        if (typeof options.clientSecret !== 'string') {\n          throw new TypeError('The \"config.authentication.options.clientSecret\" property must be of type string.');\n        }\n\n        if (typeof options.tenantId !== 'string') {\n          throw new TypeError('The \"config.authentication.options.tenantId\" property must be of type string.');\n        }\n\n        authentication = {\n          type: 'azure-active-directory-service-principal-secret',\n          options: {\n            clientId: options.clientId,\n            clientSecret: options.clientSecret,\n            tenantId: options.tenantId\n          }\n        };\n      } else {\n        if (options.userName !== undefined && typeof options.userName !== 'string') {\n          throw new TypeError('The \"config.authentication.options.userName\" property must be of type string.');\n        }\n\n        if (options.password !== undefined && typeof options.password !== 'string') {\n          throw new TypeError('The \"config.authentication.options.password\" property must be of type string.');\n        }\n\n        authentication = {\n          type: 'default',\n          options: {\n            userName: options.userName,\n            password: options.password\n          }\n        };\n      }\n    } else {\n      authentication = {\n        type: 'default',\n        options: {\n          userName: undefined,\n          password: undefined\n        }\n      };\n    }\n\n    this.config = {\n      server: config.server,\n      authentication: authentication,\n      options: {\n        abortTransactionOnError: false,\n        appName: undefined,\n        camelCaseColumns: false,\n        cancelTimeout: DEFAULT_CANCEL_TIMEOUT,\n        columnEncryptionKeyCacheTTL: 2 * 60 * 60 * 1000,  // Units: milliseconds\n        columnEncryptionSetting: false,\n        columnNameReplacer: undefined,\n        connectionRetryInterval: DEFAULT_CONNECT_RETRY_INTERVAL,\n        connectTimeout: DEFAULT_CONNECT_TIMEOUT,\n        connector: undefined,\n        connectionIsolationLevel: ISOLATION_LEVEL.READ_COMMITTED,\n        cryptoCredentialsDetails: {},\n        database: undefined,\n        datefirst: DEFAULT_DATEFIRST,\n        dateFormat: DEFAULT_DATEFORMAT,\n        debug: {\n          data: false,\n          packet: false,\n          payload: false,\n          token: false\n        },\n        enableAnsiNull: true,\n        enableAnsiNullDefault: true,\n        enableAnsiPadding: true,\n        enableAnsiWarnings: true,\n        enableArithAbort: true,\n        enableConcatNullYieldsNull: true,\n        enableCursorCloseOnCommit: null,\n        enableImplicitTransactions: false,\n        enableNumericRoundabort: false,\n        enableQuotedIdentifier: true,\n        encrypt: true,\n        fallbackToDefaultDb: false,\n        encryptionKeyStoreProviders: undefined,\n        instanceName: undefined,\n        isolationLevel: ISOLATION_LEVEL.READ_COMMITTED,\n        language: DEFAULT_LANGUAGE,\n        localAddress: undefined,\n        maxRetriesOnTransientErrors: 3,\n        multiSubnetFailover: false,\n        packetSize: DEFAULT_PACKET_SIZE,\n        port: DEFAULT_PORT,\n        readOnlyIntent: false,\n        requestTimeout: DEFAULT_CLIENT_REQUEST_TIMEOUT,\n        rowCollectionOnDone: false,\n        rowCollectionOnRequestCompletion: false,\n        serverName: undefined,\n        serverSupportsColumnEncryption: false,\n        tdsVersion: DEFAULT_TDS_VERSION,\n        textsize: DEFAULT_TEXTSIZE,\n        trustedServerNameAE: undefined,\n        trustServerCertificate: false,\n        useColumnNames: false,\n        useUTC: true,\n        workstationId: undefined,\n        lowerCaseGuids: false\n      }\n    };\n\n    if (config.options) {\n      if (config.options.port && config.options.instanceName) {\n        throw new Error('Port and instanceName are mutually exclusive, but ' + config.options.port + ' and ' + config.options.instanceName + ' provided');\n      }\n\n      if (config.options.abortTransactionOnError !== undefined) {\n        if (typeof config.options.abortTransactionOnError !== 'boolean' && config.options.abortTransactionOnError !== null) {\n          throw new TypeError('The \"config.options.abortTransactionOnError\" property must be of type string or null.');\n        }\n\n        this.config.options.abortTransactionOnError = config.options.abortTransactionOnError;\n      }\n\n      if (config.options.appName !== undefined) {\n        if (typeof config.options.appName !== 'string') {\n          throw new TypeError('The \"config.options.appName\" property must be of type string.');\n        }\n\n        this.config.options.appName = config.options.appName;\n      }\n\n      if (config.options.camelCaseColumns !== undefined) {\n        if (typeof config.options.camelCaseColumns !== 'boolean') {\n          throw new TypeError('The \"config.options.camelCaseColumns\" property must be of type boolean.');\n        }\n\n        this.config.options.camelCaseColumns = config.options.camelCaseColumns;\n      }\n\n      if (config.options.cancelTimeout !== undefined) {\n        if (typeof config.options.cancelTimeout !== 'number') {\n          throw new TypeError('The \"config.options.cancelTimeout\" property must be of type number.');\n        }\n\n        this.config.options.cancelTimeout = config.options.cancelTimeout;\n      }\n\n      if (config.options.columnNameReplacer) {\n        if (typeof config.options.columnNameReplacer !== 'function') {\n          throw new TypeError('The \"config.options.cancelTimeout\" property must be of type function.');\n        }\n\n        this.config.options.columnNameReplacer = config.options.columnNameReplacer;\n      }\n\n      if (config.options.connectionIsolationLevel !== undefined) {\n        assertValidIsolationLevel(config.options.connectionIsolationLevel, 'config.options.connectionIsolationLevel');\n\n        this.config.options.connectionIsolationLevel = config.options.connectionIsolationLevel;\n      }\n\n      if (config.options.connectTimeout !== undefined) {\n        if (typeof config.options.connectTimeout !== 'number') {\n          throw new TypeError('The \"config.options.connectTimeout\" property must be of type number.');\n        }\n\n        this.config.options.connectTimeout = config.options.connectTimeout;\n      }\n\n      if (config.options.connector !== undefined) {\n        if (typeof config.options.connector !== 'function') {\n          throw new TypeError('The \"config.options.connector\" property must be a function.');\n        }\n\n        this.config.options.connector = config.options.connector;\n      }\n\n      if (config.options.cryptoCredentialsDetails !== undefined) {\n        if (typeof config.options.cryptoCredentialsDetails !== 'object' || config.options.cryptoCredentialsDetails === null) {\n          throw new TypeError('The \"config.options.cryptoCredentialsDetails\" property must be of type Object.');\n        }\n\n        this.config.options.cryptoCredentialsDetails = config.options.cryptoCredentialsDetails;\n      }\n\n      if (config.options.database !== undefined) {\n        if (typeof config.options.database !== 'string') {\n          throw new TypeError('The \"config.options.database\" property must be of type string.');\n        }\n\n        this.config.options.database = config.options.database;\n      }\n\n      if (config.options.datefirst !== undefined) {\n        if (typeof config.options.datefirst !== 'number' && config.options.datefirst !== null) {\n          throw new TypeError('The \"config.options.datefirst\" property must be of type number.');\n        }\n\n        if (config.options.datefirst !== null && (config.options.datefirst < 1 || config.options.datefirst > 7)) {\n          throw new RangeError('The \"config.options.datefirst\" property must be >= 1 and <= 7');\n        }\n\n        this.config.options.datefirst = config.options.datefirst;\n      }\n\n      if (config.options.dateFormat !== undefined) {\n        if (typeof config.options.dateFormat !== 'string' && config.options.dateFormat !== null) {\n          throw new TypeError('The \"config.options.dateFormat\" property must be of type string or null.');\n        }\n\n        this.config.options.dateFormat = config.options.dateFormat;\n      }\n\n      if (config.options.debug) {\n        if (config.options.debug.data !== undefined) {\n          if (typeof config.options.debug.data !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.data\" property must be of type boolean.');\n          }\n\n          this.config.options.debug.data = config.options.debug.data;\n        }\n\n        if (config.options.debug.packet !== undefined) {\n          if (typeof config.options.debug.packet !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.packet\" property must be of type boolean.');\n          }\n\n          this.config.options.debug.packet = config.options.debug.packet;\n        }\n\n        if (config.options.debug.payload !== undefined) {\n          if (typeof config.options.debug.payload !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.payload\" property must be of type boolean.');\n          }\n\n          this.config.options.debug.payload = config.options.debug.payload;\n        }\n\n        if (config.options.debug.token !== undefined) {\n          if (typeof config.options.debug.token !== 'boolean') {\n            throw new TypeError('The \"config.options.debug.token\" property must be of type boolean.');\n          }\n\n          this.config.options.debug.token = config.options.debug.token;\n        }\n      }\n\n      if (config.options.enableAnsiNull !== undefined) {\n        if (typeof config.options.enableAnsiNull !== 'boolean' && config.options.enableAnsiNull !== null) {\n          throw new TypeError('The \"config.options.enableAnsiNull\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableAnsiNull = config.options.enableAnsiNull;\n      }\n\n      if (config.options.enableAnsiNullDefault !== undefined) {\n        if (typeof config.options.enableAnsiNullDefault !== 'boolean' && config.options.enableAnsiNullDefault !== null) {\n          throw new TypeError('The \"config.options.enableAnsiNullDefault\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableAnsiNullDefault = config.options.enableAnsiNullDefault;\n      }\n\n      if (config.options.enableAnsiPadding !== undefined) {\n        if (typeof config.options.enableAnsiPadding !== 'boolean' && config.options.enableAnsiPadding !== null) {\n          throw new TypeError('The \"config.options.enableAnsiPadding\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableAnsiPadding = config.options.enableAnsiPadding;\n      }\n\n      if (config.options.enableAnsiWarnings !== undefined) {\n        if (typeof config.options.enableAnsiWarnings !== 'boolean' && config.options.enableAnsiWarnings !== null) {\n          throw new TypeError('The \"config.options.enableAnsiWarnings\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableAnsiWarnings = config.options.enableAnsiWarnings;\n      }\n\n      if (config.options.enableArithAbort !== undefined) {\n        if (typeof config.options.enableArithAbort !== 'boolean' && config.options.enableArithAbort !== null) {\n          throw new TypeError('The \"config.options.enableArithAbort\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableArithAbort = config.options.enableArithAbort;\n      }\n\n      if (config.options.enableConcatNullYieldsNull !== undefined) {\n        if (typeof config.options.enableConcatNullYieldsNull !== 'boolean' && config.options.enableConcatNullYieldsNull !== null) {\n          throw new TypeError('The \"config.options.enableConcatNullYieldsNull\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableConcatNullYieldsNull = config.options.enableConcatNullYieldsNull;\n      }\n\n      if (config.options.enableCursorCloseOnCommit !== undefined) {\n        if (typeof config.options.enableCursorCloseOnCommit !== 'boolean' && config.options.enableCursorCloseOnCommit !== null) {\n          throw new TypeError('The \"config.options.enableCursorCloseOnCommit\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableCursorCloseOnCommit = config.options.enableCursorCloseOnCommit;\n      }\n\n      if (config.options.enableImplicitTransactions !== undefined) {\n        if (typeof config.options.enableImplicitTransactions !== 'boolean' && config.options.enableImplicitTransactions !== null) {\n          throw new TypeError('The \"config.options.enableImplicitTransactions\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableImplicitTransactions = config.options.enableImplicitTransactions;\n      }\n\n      if (config.options.enableNumericRoundabort !== undefined) {\n        if (typeof config.options.enableNumericRoundabort !== 'boolean' && config.options.enableNumericRoundabort !== null) {\n          throw new TypeError('The \"config.options.enableNumericRoundabort\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableNumericRoundabort = config.options.enableNumericRoundabort;\n      }\n\n      if (config.options.enableQuotedIdentifier !== undefined) {\n        if (typeof config.options.enableQuotedIdentifier !== 'boolean' && config.options.enableQuotedIdentifier !== null) {\n          throw new TypeError('The \"config.options.enableQuotedIdentifier\" property must be of type boolean or null.');\n        }\n\n        this.config.options.enableQuotedIdentifier = config.options.enableQuotedIdentifier;\n      }\n      if (config.options.encrypt !== undefined) {\n        if (typeof config.options.encrypt !== 'boolean') {\n          if (config.options.encrypt !== 'strict') {\n            throw new TypeError('The \"encrypt\" property must be set to \"strict\", or of type boolean.');\n          }\n        }\n\n        this.config.options.encrypt = config.options.encrypt;\n      }\n\n      if (config.options.fallbackToDefaultDb !== undefined) {\n        if (typeof config.options.fallbackToDefaultDb !== 'boolean') {\n          throw new TypeError('The \"config.options.fallbackToDefaultDb\" property must be of type boolean.');\n        }\n\n        this.config.options.fallbackToDefaultDb = config.options.fallbackToDefaultDb;\n      }\n\n      if (config.options.instanceName !== undefined) {\n        if (typeof config.options.instanceName !== 'string') {\n          throw new TypeError('The \"config.options.instanceName\" property must be of type string.');\n        }\n\n        this.config.options.instanceName = config.options.instanceName;\n        this.config.options.port = undefined;\n      }\n\n      if (config.options.isolationLevel !== undefined) {\n        assertValidIsolationLevel(config.options.isolationLevel, 'config.options.isolationLevel');\n\n        this.config.options.isolationLevel = config.options.isolationLevel;\n      }\n\n      if (config.options.language !== undefined) {\n        if (typeof config.options.language !== 'string' && config.options.language !== null) {\n          throw new TypeError('The \"config.options.language\" property must be of type string or null.');\n        }\n\n        this.config.options.language = config.options.language;\n      }\n\n      if (config.options.localAddress !== undefined) {\n        if (typeof config.options.localAddress !== 'string') {\n          throw new TypeError('The \"config.options.localAddress\" property must be of type string.');\n        }\n\n        this.config.options.localAddress = config.options.localAddress;\n      }\n\n      if (config.options.multiSubnetFailover !== undefined) {\n        if (typeof config.options.multiSubnetFailover !== 'boolean') {\n          throw new TypeError('The \"config.options.multiSubnetFailover\" property must be of type boolean.');\n        }\n\n        this.config.options.multiSubnetFailover = config.options.multiSubnetFailover;\n      }\n\n      if (config.options.packetSize !== undefined) {\n        if (typeof config.options.packetSize !== 'number') {\n          throw new TypeError('The \"config.options.packetSize\" property must be of type number.');\n        }\n\n        this.config.options.packetSize = config.options.packetSize;\n      }\n\n      if (config.options.port !== undefined) {\n        if (typeof config.options.port !== 'number') {\n          throw new TypeError('The \"config.options.port\" property must be of type number.');\n        }\n\n        if (config.options.port <= 0 || config.options.port >= 65536) {\n          throw new RangeError('The \"config.options.port\" property must be > 0 and < 65536');\n        }\n\n        this.config.options.port = config.options.port;\n        this.config.options.instanceName = undefined;\n      }\n\n      if (config.options.readOnlyIntent !== undefined) {\n        if (typeof config.options.readOnlyIntent !== 'boolean') {\n          throw new TypeError('The \"config.options.readOnlyIntent\" property must be of type boolean.');\n        }\n\n        this.config.options.readOnlyIntent = config.options.readOnlyIntent;\n      }\n\n      if (config.options.requestTimeout !== undefined) {\n        if (typeof config.options.requestTimeout !== 'number') {\n          throw new TypeError('The \"config.options.requestTimeout\" property must be of type number.');\n        }\n\n        this.config.options.requestTimeout = config.options.requestTimeout;\n      }\n\n      if (config.options.maxRetriesOnTransientErrors !== undefined) {\n        if (typeof config.options.maxRetriesOnTransientErrors !== 'number') {\n          throw new TypeError('The \"config.options.maxRetriesOnTransientErrors\" property must be of type number.');\n        }\n\n        if (config.options.maxRetriesOnTransientErrors < 0) {\n          throw new TypeError('The \"config.options.maxRetriesOnTransientErrors\" property must be equal or greater than 0.');\n        }\n\n        this.config.options.maxRetriesOnTransientErrors = config.options.maxRetriesOnTransientErrors;\n      }\n\n      if (config.options.connectionRetryInterval !== undefined) {\n        if (typeof config.options.connectionRetryInterval !== 'number') {\n          throw new TypeError('The \"config.options.connectionRetryInterval\" property must be of type number.');\n        }\n\n        if (config.options.connectionRetryInterval <= 0) {\n          throw new TypeError('The \"config.options.connectionRetryInterval\" property must be greater than 0.');\n        }\n\n        this.config.options.connectionRetryInterval = config.options.connectionRetryInterval;\n      }\n\n      if (config.options.rowCollectionOnDone !== undefined) {\n        if (typeof config.options.rowCollectionOnDone !== 'boolean') {\n          throw new TypeError('The \"config.options.rowCollectionOnDone\" property must be of type boolean.');\n        }\n\n        this.config.options.rowCollectionOnDone = config.options.rowCollectionOnDone;\n      }\n\n      if (config.options.rowCollectionOnRequestCompletion !== undefined) {\n        if (typeof config.options.rowCollectionOnRequestCompletion !== 'boolean') {\n          throw new TypeError('The \"config.options.rowCollectionOnRequestCompletion\" property must be of type boolean.');\n        }\n\n        this.config.options.rowCollectionOnRequestCompletion = config.options.rowCollectionOnRequestCompletion;\n      }\n\n      if (config.options.tdsVersion !== undefined) {\n        if (typeof config.options.tdsVersion !== 'string') {\n          throw new TypeError('The \"config.options.tdsVersion\" property must be of type string.');\n        }\n\n        this.config.options.tdsVersion = config.options.tdsVersion;\n      }\n\n      if (config.options.textsize !== undefined) {\n        if (typeof config.options.textsize !== 'number' && config.options.textsize !== null) {\n          throw new TypeError('The \"config.options.textsize\" property must be of type number or null.');\n        }\n\n        if (config.options.textsize > 2147483647) {\n          throw new TypeError('The \"config.options.textsize\" can\\'t be greater than 2147483647.');\n        } else if (config.options.textsize < -1) {\n          throw new TypeError('The \"config.options.textsize\" can\\'t be smaller than -1.');\n        }\n\n        this.config.options.textsize = config.options.textsize | 0;\n      }\n\n      if (config.options.trustServerCertificate !== undefined) {\n        if (typeof config.options.trustServerCertificate !== 'boolean') {\n          throw new TypeError('The \"config.options.trustServerCertificate\" property must be of type boolean.');\n        }\n\n        this.config.options.trustServerCertificate = config.options.trustServerCertificate;\n      }\n\n      if (config.options.serverName !== undefined) {\n        if (typeof config.options.serverName !== 'string') {\n          throw new TypeError('The \"config.options.serverName\" property must be of type string.');\n        }\n        this.config.options.serverName = config.options.serverName;\n      }\n\n      if (config.options.useColumnNames !== undefined) {\n        if (typeof config.options.useColumnNames !== 'boolean') {\n          throw new TypeError('The \"config.options.useColumnNames\" property must be of type boolean.');\n        }\n\n        this.config.options.useColumnNames = config.options.useColumnNames;\n      }\n\n      if (config.options.useUTC !== undefined) {\n        if (typeof config.options.useUTC !== 'boolean') {\n          throw new TypeError('The \"config.options.useUTC\" property must be of type boolean.');\n        }\n\n        this.config.options.useUTC = config.options.useUTC;\n      }\n\n      if (config.options.workstationId !== undefined) {\n        if (typeof config.options.workstationId !== 'string') {\n          throw new TypeError('The \"config.options.workstationId\" property must be of type string.');\n        }\n\n        this.config.options.workstationId = config.options.workstationId;\n      }\n\n      if (config.options.lowerCaseGuids !== undefined) {\n        if (typeof config.options.lowerCaseGuids !== 'boolean') {\n          throw new TypeError('The \"config.options.lowerCaseGuids\" property must be of type boolean.');\n        }\n\n        this.config.options.lowerCaseGuids = config.options.lowerCaseGuids;\n      }\n    }\n\n    this.secureContextOptions = this.config.options.cryptoCredentialsDetails;\n    if (this.secureContextOptions.secureOptions === undefined) {\n      // If the caller has not specified their own `secureOptions`,\n      // we set `SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS` here.\n      // Older SQL Server instances running on older Windows versions have\n      // trouble with the BEAST workaround in OpenSSL.\n      // As BEAST is a browser specific exploit, we can just disable this option here.\n      this.secureContextOptions = Object.create(this.secureContextOptions, {\n        secureOptions: {\n          value: constants.SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS\n        }\n      });\n    }\n\n    this.debug = this.createDebug();\n    this.inTransaction = false;\n    this.transactionDescriptors = [Buffer.from([0, 0, 0, 0, 0, 0, 0, 0])];\n\n    // 'beginTransaction', 'commitTransaction' and 'rollbackTransaction'\n    // events are utilized to maintain inTransaction property state which in\n    // turn is used in managing transactions. These events are only fired for\n    // TDS version 7.2 and beyond. The properties below are used to emulate\n    // equivalent behavior for TDS versions before 7.2.\n    this.transactionDepth = 0;\n    this.isSqlBatch = false;\n    this.closed = false;\n    this.messageBuffer = Buffer.alloc(0);\n\n    this.curTransientRetryCount = 0;\n    this.transientErrorLookup = new TransientErrorLookup();\n\n    this.state = this.STATE.INITIALIZED;\n\n    this._cancelAfterRequestSent = () => {\n      this.messageIo.sendMessage(TYPE.ATTENTION);\n      this.createCancelTimer();\n    };\n  }\n\n  connect(connectListener?: (err?: Error) => void) {\n    if (this.state !== this.STATE.INITIALIZED) {\n      throw new ConnectionError('`.connect` can not be called on a Connection in `' + this.state.name + '` state.');\n    }\n\n    if (connectListener) {\n      const onConnect = (err?: Error) => {\n        this.removeListener('error', onError);\n        connectListener(err);\n      };\n\n      const onError = (err: Error) => {\n        this.removeListener('connect', onConnect);\n        connectListener(err);\n      };\n\n      this.once('connect', onConnect);\n      this.once('error', onError);\n    }\n\n    this.transitionTo(this.STATE.CONNECTING);\n  }\n\n  /**\n   * The server has reported that the charset has changed.\n   */\n  on(event: 'charsetChange', listener: (charset: string) => void): this\n\n  /**\n   * The attempt to connect and validate has completed.\n   */\n  on(\n    event: 'connect',\n    /**\n     * @param err If successfully connected, will be falsey. If there was a\n     *   problem (with either connecting or validation), will be an [[Error]] object.\n     */\n    listener: (err: Error | undefined) => void\n  ): this\n\n  /**\n   * The server has reported that the active database has changed.\n   * This may be as a result of a successful login, or a `use` statement.\n   */\n  on(event: 'databaseChange', listener: (databaseName: string) => void): this\n\n  /**\n   * A debug message is available. It may be logged or ignored.\n   */\n  on(event: 'debug', listener: (messageText: string) => void): this\n\n  /**\n   * Internal error occurs.\n   */\n  on(event: 'error', listener: (err: Error) => void): this\n\n  /**\n   * The server has issued an error message.\n   */\n  on(event: 'errorMessage', listener: (message: import('./token/token').ErrorMessageToken) => void): this\n\n  /**\n   * The connection has ended.\n   *\n   * This may be as a result of the client calling [[close]], the server\n   * closing the connection, or a network error.\n   */\n  on(event: 'end', listener: () => void): this\n\n  /**\n   * The server has issued an information message.\n   */\n  on(event: 'infoMessage', listener: (message: import('./token/token').InfoMessageToken) => void): this\n\n  /**\n   * The server has reported that the language has changed.\n   */\n  on(event: 'languageChange', listener: (languageName: string) => void): this\n\n  /**\n   * The connection was reset.\n   */\n  on(event: 'resetConnection', listener: () => void): this\n\n  /**\n   * A secure connection has been established.\n   */\n  on(event: 'secure', listener: (cleartext: import('tls').TLSSocket) => void): this\n\n  on(event: string | symbol, listener: (...args: any[]) => void) {\n    return super.on(event, listener);\n  }\n\n  /**\n   * @private\n   */\n  emit(event: 'charsetChange', charset: string): boolean\n  /**\n   * @private\n   */\n  emit(event: 'connect', error?: Error): boolean\n  /**\n   * @private\n   */\n  emit(event: 'databaseChange', databaseName: string): boolean\n  /**\n   * @private\n   */\n  emit(event: 'debug', messageText: string): boolean\n  /**\n   * @private\n   */\n  emit(event: 'error', error: Error): boolean\n  /**\n   * @private\n   */\n  emit(event: 'errorMessage', message: import('./token/token').ErrorMessageToken): boolean\n  /**\n   * @private\n   */\n  emit(event: 'end'): boolean\n  /**\n   * @private\n   */\n  emit(event: 'infoMessage', message: import('./token/token').InfoMessageToken): boolean\n  /**\n   * @private\n   */\n  emit(event: 'languageChange', languageName: string): boolean\n  /**\n   * @private\n   */\n  emit(event: 'secure', cleartext: import('tls').TLSSocket): boolean\n  /**\n   * @private\n   */\n  emit(event: 'rerouting'): boolean\n  /**\n   * @private\n   */\n  emit(event: 'resetConnection'): boolean\n  /**\n   * @private\n   */\n  emit(event: 'retry'): boolean\n  /**\n   * @private\n   */\n  emit(event: 'rollbackTransaction'): boolean\n\n  emit(event: string | symbol, ...args: any[]) {\n    return super.emit(event, ...args);\n  }\n\n  /**\n   * Closes the connection to the database.\n   *\n   * The [[Event_end]] will be emitted once the connection has been closed.\n   */\n  close() {\n    this.transitionTo(this.STATE.FINAL);\n  }\n\n  /**\n   * @private\n   */\n  initialiseConnection() {\n    const signal = this.createConnectTimer();\n\n    if (this.config.options.port) {\n      return this.connectOnPort(this.config.options.port, this.config.options.multiSubnetFailover, signal, this.config.options.connector);\n    } else {\n      return instanceLookup({\n        server: this.config.server,\n        instanceName: this.config.options.instanceName!,\n        timeout: this.config.options.connectTimeout,\n        signal: signal\n      }).then((port) => {\n        process.nextTick(() => {\n          this.connectOnPort(port, this.config.options.multiSubnetFailover, signal, this.config.options.connector);\n        });\n      }, (err) => {\n        this.clearConnectTimer();\n\n        if (signal.aborted) {\n          // Ignore the AbortError for now, this is still handled by the connectTimer firing\n          return;\n        }\n\n        process.nextTick(() => {\n          this.emit('connect', new ConnectionError(err.message, 'EINSTLOOKUP', { cause: err }));\n        });\n      });\n    }\n  }\n\n  /**\n   * @private\n   */\n  cleanupConnection(cleanupType: typeof CLEANUP_TYPE[keyof typeof CLEANUP_TYPE]) {\n    if (!this.closed) {\n      this.clearConnectTimer();\n      this.clearRequestTimer();\n      this.clearRetryTimer();\n      this.closeConnection();\n      if (cleanupType === CLEANUP_TYPE.REDIRECT) {\n        this.emit('rerouting');\n      } else if (cleanupType !== CLEANUP_TYPE.RETRY) {\n        process.nextTick(() => {\n          this.emit('end');\n        });\n      }\n\n      const request = this.request;\n      if (request) {\n        const err = new RequestError('Connection closed before request completed.', 'ECLOSE');\n        request.callback(err);\n        this.request = undefined;\n      }\n\n      this.closed = true;\n      this.loginError = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  createDebug() {\n    const debug = new Debug(this.config.options.debug);\n    debug.on('debug', (message) => {\n      this.emit('debug', message);\n    });\n    return debug;\n  }\n\n  /**\n   * @private\n   */\n  createTokenStreamParser(message: Message, handler: TokenHandler) {\n    return new TokenStreamParser(message, this.debug, handler, this.config.options);\n  }\n\n  socketHandlingForSendPreLogin(socket: net.Socket) {\n    socket.on('error', (error) => { this.socketError(error); });\n    socket.on('close', () => { this.socketClose(); });\n    socket.on('end', () => { this.socketEnd(); });\n    socket.setKeepAlive(true, KEEP_ALIVE_INITIAL_DELAY);\n\n    this.messageIo = new MessageIO(socket, this.config.options.packetSize, this.debug);\n    this.messageIo.on('secure', (cleartext) => { this.emit('secure', cleartext); });\n\n    this.socket = socket;\n\n    this.closed = false;\n    this.debug.log('connected to ' + this.config.server + ':' + this.config.options.port);\n\n    this.sendPreLogin();\n    this.transitionTo(this.STATE.SENT_PRELOGIN);\n  }\n\n  wrapWithTls(socket: net.Socket, signal: AbortSignal): Promise<tls.TLSSocket> {\n    signal.throwIfAborted();\n\n    return new Promise((resolve, reject) => {\n      const secureContext = tls.createSecureContext(this.secureContextOptions);\n      // If connect to an ip address directly,\n      // need to set the servername to an empty string\n      // if the user has not given a servername explicitly\n      const serverName = !net.isIP(this.config.server) ? this.config.server : '';\n      const encryptOptions = {\n        host: this.config.server,\n        socket: socket,\n        ALPNProtocols: ['tds/8.0'],\n        secureContext: secureContext,\n        servername: this.config.options.serverName ? this.config.options.serverName : serverName,\n      };\n\n      const encryptsocket = tls.connect(encryptOptions);\n\n      const onAbort = () => {\n        encryptsocket.removeListener('error', onError);\n        encryptsocket.removeListener('connect', onConnect);\n\n        encryptsocket.destroy();\n\n        reject(signal.reason);\n      };\n\n      const onError = (err: Error) => {\n        signal.removeEventListener('abort', onAbort);\n\n        encryptsocket.removeListener('error', onError);\n        encryptsocket.removeListener('connect', onConnect);\n\n        encryptsocket.destroy();\n\n        reject(err);\n      };\n\n      const onConnect = () => {\n        signal.removeEventListener('abort', onAbort);\n\n        encryptsocket.removeListener('error', onError);\n        encryptsocket.removeListener('connect', onConnect);\n\n        resolve(encryptsocket);\n      };\n\n      signal.addEventListener('abort', onAbort, { once: true });\n\n      encryptsocket.on('error', onError);\n      encryptsocket.on('secureConnect', onConnect);\n    });\n  }\n\n  connectOnPort(port: number, multiSubnetFailover: boolean, signal: AbortSignal, customConnector?: () => Promise<net.Socket>) {\n    const connectOpts = {\n      host: this.routingData ? this.routingData.server : this.config.server,\n      port: this.routingData ? this.routingData.port : port,\n      localAddress: this.config.options.localAddress\n    };\n\n    const connect = customConnector || (multiSubnetFailover ? connectInParallel : connectInSequence);\n\n    (async () => {\n      let socket = await connect(connectOpts, dns.lookup, signal);\n\n      if (this.config.options.encrypt === 'strict') {\n        try {\n          // Wrap the socket with TLS for TDS 8.0\n          socket = await this.wrapWithTls(socket, signal);\n        } catch (err) {\n          socket.end();\n\n          throw err;\n        }\n      }\n\n      this.socketHandlingForSendPreLogin(socket);\n    })().catch((err) => {\n      this.clearConnectTimer();\n\n      if (signal.aborted) {\n        return;\n      }\n\n      process.nextTick(() => { this.socketError(err); });\n    });\n  }\n\n  /**\n   * @private\n   */\n  closeConnection() {\n    if (this.socket) {\n      this.socket.destroy();\n    }\n  }\n\n  /**\n   * @private\n   */\n  createConnectTimer() {\n    const controller = new AbortController();\n    this.connectTimer = setTimeout(() => {\n      controller.abort();\n      this.connectTimeout();\n    }, this.config.options.connectTimeout);\n    return controller.signal;\n  }\n\n  /**\n   * @private\n   */\n  createCancelTimer() {\n    this.clearCancelTimer();\n    const timeout = this.config.options.cancelTimeout;\n    if (timeout > 0) {\n      this.cancelTimer = setTimeout(() => {\n        this.cancelTimeout();\n      }, timeout);\n    }\n  }\n\n  /**\n   * @private\n   */\n  createRequestTimer() {\n    this.clearRequestTimer(); // release old timer, just to be safe\n    const request = this.request as Request;\n    const timeout = (request.timeout !== undefined) ? request.timeout : this.config.options.requestTimeout;\n    if (timeout) {\n      this.requestTimer = setTimeout(() => {\n        this.requestTimeout();\n      }, timeout);\n    }\n  }\n\n  /**\n   * @private\n   */\n  createRetryTimer() {\n    this.clearRetryTimer();\n    this.retryTimer = setTimeout(() => {\n      this.retryTimeout();\n    }, this.config.options.connectionRetryInterval);\n  }\n\n  /**\n   * @private\n   */\n  connectTimeout() {\n    const hostPostfix = this.config.options.port ? `:${this.config.options.port}` : `\\\\${this.config.options.instanceName}`;\n    // If we have routing data stored, this connection has been redirected\n    const server = this.routingData ? this.routingData.server : this.config.server;\n    const port = this.routingData ? `:${this.routingData.port}` : hostPostfix;\n    // Grab the target host from the connection configuration, and from a redirect message\n    // otherwise, leave the message empty.\n    const routingMessage = this.routingData ? ` (redirected from ${this.config.server}${hostPostfix})` : '';\n    const message = `Failed to connect to ${server}${port}${routingMessage} in ${this.config.options.connectTimeout}ms`;\n    this.debug.log(message);\n    this.emit('connect', new ConnectionError(message, 'ETIMEOUT'));\n    this.connectTimer = undefined;\n    this.dispatchEvent('connectTimeout');\n  }\n\n  /**\n   * @private\n   */\n  cancelTimeout() {\n    const message = `Failed to cancel request in ${this.config.options.cancelTimeout}ms`;\n    this.debug.log(message);\n    this.dispatchEvent('socketError', new ConnectionError(message, 'ETIMEOUT'));\n  }\n\n  /**\n   * @private\n   */\n  requestTimeout() {\n    this.requestTimer = undefined;\n    const request = this.request!;\n    request.cancel();\n    const timeout = (request.timeout !== undefined) ? request.timeout : this.config.options.requestTimeout;\n    const message = 'Timeout: Request failed to complete in ' + timeout + 'ms';\n    request.error = new RequestError(message, 'ETIMEOUT');\n  }\n\n  /**\n   * @private\n   */\n  retryTimeout() {\n    this.retryTimer = undefined;\n    this.emit('retry');\n    this.transitionTo(this.STATE.CONNECTING);\n  }\n\n  /**\n   * @private\n   */\n  clearConnectTimer() {\n    if (this.connectTimer) {\n      clearTimeout(this.connectTimer);\n      this.connectTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  clearCancelTimer() {\n    if (this.cancelTimer) {\n      clearTimeout(this.cancelTimer);\n      this.cancelTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  clearRequestTimer() {\n    if (this.requestTimer) {\n      clearTimeout(this.requestTimer);\n      this.requestTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  clearRetryTimer() {\n    if (this.retryTimer) {\n      clearTimeout(this.retryTimer);\n      this.retryTimer = undefined;\n    }\n  }\n\n  /**\n   * @private\n   */\n  transitionTo(newState: State) {\n    if (this.state === newState) {\n      this.debug.log('State is already ' + newState.name);\n      return;\n    }\n\n    if (this.state && this.state.exit) {\n      this.state.exit.call(this, newState);\n    }\n\n    this.debug.log('State change: ' + (this.state ? this.state.name : 'undefined') + ' -> ' + newState.name);\n    this.state = newState;\n\n    if (this.state.enter) {\n      this.state.enter.apply(this);\n    }\n  }\n\n  /**\n   * @private\n   */\n  getEventHandler<T extends keyof State['events']>(eventName: T): NonNullable<State['events'][T]> {\n    const handler = this.state.events[eventName];\n\n    if (!handler) {\n      throw new Error(`No event '${eventName}' in state '${this.state.name}'`);\n    }\n\n    return handler!;\n  }\n\n  /**\n   * @private\n   */\n  dispatchEvent<T extends keyof State['events']>(eventName: T, ...args: Parameters<NonNullable<State['events'][T]>>) {\n    const handler = this.state.events[eventName] as ((this: Connection, ...args: any[]) => void) | undefined;\n    if (handler) {\n      handler.apply(this, args);\n    } else {\n      this.emit('error', new Error(`No event '${eventName}' in state '${this.state.name}'`));\n      this.close();\n    }\n  }\n\n  /**\n   * @private\n   */\n  socketError(error: Error) {\n    if (this.state === this.STATE.CONNECTING || this.state === this.STATE.SENT_TLSSSLNEGOTIATION) {\n      const hostPostfix = this.config.options.port ? `:${this.config.options.port}` : `\\\\${this.config.options.instanceName}`;\n      // If we have routing data stored, this connection has been redirected\n      const server = this.routingData ? this.routingData.server : this.config.server;\n      const port = this.routingData ? `:${this.routingData.port}` : hostPostfix;\n      // Grab the target host from the connection configuration, and from a redirect message\n      // otherwise, leave the message empty.\n      const routingMessage = this.routingData ? ` (redirected from ${this.config.server}${hostPostfix})` : '';\n      const message = `Failed to connect to ${server}${port}${routingMessage} - ${error.message}`;\n      this.debug.log(message);\n      this.emit('connect', new ConnectionError(message, 'ESOCKET', { cause: error }));\n    } else {\n      const message = `Connection lost - ${error.message}`;\n      this.debug.log(message);\n      this.emit('error', new ConnectionError(message, 'ESOCKET', { cause: error }));\n    }\n    this.dispatchEvent('socketError', error);\n  }\n\n  /**\n   * @private\n   */\n  socketEnd() {\n    this.debug.log('socket ended');\n    if (this.state !== this.STATE.FINAL) {\n      const error: ErrorWithCode = new Error('socket hang up');\n      error.code = 'ECONNRESET';\n      this.socketError(error);\n    }\n  }\n\n  /**\n   * @private\n   */\n  socketClose() {\n    this.debug.log('connection to ' + this.config.server + ':' + this.config.options.port + ' closed');\n    if (this.state === this.STATE.REROUTING) {\n      this.debug.log('Rerouting to ' + this.routingData!.server + ':' + this.routingData!.port);\n\n      this.dispatchEvent('reconnect');\n    } else if (this.state === this.STATE.TRANSIENT_FAILURE_RETRY) {\n      const server = this.routingData ? this.routingData.server : this.config.server;\n      const port = this.routingData ? this.routingData.port : this.config.options.port;\n      this.debug.log('Retry after transient failure connecting to ' + server + ':' + port);\n\n      this.dispatchEvent('retry');\n    } else {\n      this.transitionTo(this.STATE.FINAL);\n    }\n  }\n\n  /**\n   * @private\n   */\n  sendPreLogin() {\n    const [, major, minor, build] = /^(\\d+)\\.(\\d+)\\.(\\d+)/.exec(version) ?? ['0.0.0', '0', '0', '0'];\n    const payload = new PreloginPayload({\n      // If encrypt setting is set to 'strict', then we should have already done the encryption before calling\n      // this function. Therefore, the encrypt will be set to false here.\n      // Otherwise, we will set encrypt here based on the encrypt Boolean value from the configuration.\n      encrypt: typeof this.config.options.encrypt === 'boolean' && this.config.options.encrypt,\n      version: { major: Number(major), minor: Number(minor), build: Number(build), subbuild: 0 }\n    });\n\n    this.messageIo.sendMessage(TYPE.PRELOGIN, payload.data);\n    this.debug.payload(function() {\n      return payload.toString('  ');\n    });\n  }\n\n  /**\n   * @private\n   */\n  sendLogin7Packet() {\n    const payload = new Login7Payload({\n      tdsVersion: versions[this.config.options.tdsVersion],\n      packetSize: this.config.options.packetSize,\n      clientProgVer: 0,\n      clientPid: process.pid,\n      connectionId: 0,\n      clientTimeZone: new Date().getTimezoneOffset(),\n      clientLcid: 0x00000409\n    });\n\n    const { authentication } = this.config;\n    switch (authentication.type) {\n      case 'azure-active-directory-password':\n        payload.fedAuth = {\n          type: 'ADAL',\n          echo: this.fedAuthRequired,\n          workflow: 'default'\n        };\n        break;\n\n      case 'azure-active-directory-access-token':\n        payload.fedAuth = {\n          type: 'SECURITYTOKEN',\n          echo: this.fedAuthRequired,\n          fedAuthToken: authentication.options.token\n        };\n        break;\n\n      case 'token-credential':\n      case 'azure-active-directory-msi-vm':\n      case 'azure-active-directory-default':\n      case 'azure-active-directory-msi-app-service':\n      case 'azure-active-directory-service-principal-secret':\n        payload.fedAuth = {\n          type: 'ADAL',\n          echo: this.fedAuthRequired,\n          workflow: 'integrated'\n        };\n        break;\n\n      case 'ntlm':\n        payload.sspi = createNTLMRequest({ domain: authentication.options.domain });\n        break;\n\n      default:\n        payload.userName = authentication.options.userName;\n        payload.password = authentication.options.password;\n    }\n\n    payload.hostname = this.config.options.workstationId || os.hostname();\n    payload.serverName = this.routingData ? this.routingData.server : this.config.server;\n    payload.appName = this.config.options.appName || 'Tedious';\n    payload.libraryName = libraryName;\n    payload.language = this.config.options.language;\n    payload.database = this.config.options.database;\n    payload.clientId = Buffer.from([1, 2, 3, 4, 5, 6]);\n\n    payload.readOnlyIntent = this.config.options.readOnlyIntent;\n    payload.initDbFatal = !this.config.options.fallbackToDefaultDb;\n\n    this.routingData = undefined;\n    this.messageIo.sendMessage(TYPE.LOGIN7, payload.toBuffer());\n\n    this.debug.payload(function() {\n      return payload.toString('  ');\n    });\n  }\n\n  /**\n   * @private\n   */\n  sendFedAuthTokenMessage(token: string) {\n    const accessTokenLen = Buffer.byteLength(token, 'ucs2');\n    const data = Buffer.alloc(8 + accessTokenLen);\n    let offset = 0;\n    offset = data.writeUInt32LE(accessTokenLen + 4, offset);\n    offset = data.writeUInt32LE(accessTokenLen, offset);\n    data.write(token, offset, 'ucs2');\n    this.messageIo.sendMessage(TYPE.FEDAUTH_TOKEN, data);\n    // sent the fedAuth token message, the rest is similar to standard login 7\n    this.transitionTo(this.STATE.SENT_LOGIN7_WITH_STANDARD_LOGIN);\n  }\n\n  /**\n   * @private\n   */\n  sendInitialSql() {\n    const payload = new SqlBatchPayload(this.getInitialSql(), this.currentTransactionDescriptor(), this.config.options);\n\n    const message = new Message({ type: TYPE.SQL_BATCH });\n    this.messageIo.outgoingMessageStream.write(message);\n    Readable.from(payload).pipe(message);\n  }\n\n  /**\n   * @private\n   */\n  getInitialSql() {\n    const options = [];\n\n    if (this.config.options.enableAnsiNull === true) {\n      options.push('set ansi_nulls on');\n    } else if (this.config.options.enableAnsiNull === false) {\n      options.push('set ansi_nulls off');\n    }\n\n    if (this.config.options.enableAnsiNullDefault === true) {\n      options.push('set ansi_null_dflt_on on');\n    } else if (this.config.options.enableAnsiNullDefault === false) {\n      options.push('set ansi_null_dflt_on off');\n    }\n\n    if (this.config.options.enableAnsiPadding === true) {\n      options.push('set ansi_padding on');\n    } else if (this.config.options.enableAnsiPadding === false) {\n      options.push('set ansi_padding off');\n    }\n\n    if (this.config.options.enableAnsiWarnings === true) {\n      options.push('set ansi_warnings on');\n    } else if (this.config.options.enableAnsiWarnings === false) {\n      options.push('set ansi_warnings off');\n    }\n\n    if (this.config.options.enableArithAbort === true) {\n      options.push('set arithabort on');\n    } else if (this.config.options.enableArithAbort === false) {\n      options.push('set arithabort off');\n    }\n\n    if (this.config.options.enableConcatNullYieldsNull === true) {\n      options.push('set concat_null_yields_null on');\n    } else if (this.config.options.enableConcatNullYieldsNull === false) {\n      options.push('set concat_null_yields_null off');\n    }\n\n    if (this.config.options.enableCursorCloseOnCommit === true) {\n      options.push('set cursor_close_on_commit on');\n    } else if (this.config.options.enableCursorCloseOnCommit === false) {\n      options.push('set cursor_close_on_commit off');\n    }\n\n    if (this.config.options.datefirst !== null) {\n      options.push(`set datefirst ${this.config.options.datefirst}`);\n    }\n\n    if (this.config.options.dateFormat !== null) {\n      options.push(`set dateformat ${this.config.options.dateFormat}`);\n    }\n\n    if (this.config.options.enableImplicitTransactions === true) {\n      options.push('set implicit_transactions on');\n    } else if (this.config.options.enableImplicitTransactions === false) {\n      options.push('set implicit_transactions off');\n    }\n\n    if (this.config.options.language !== null) {\n      options.push(`set language ${this.config.options.language}`);\n    }\n\n    if (this.config.options.enableNumericRoundabort === true) {\n      options.push('set numeric_roundabort on');\n    } else if (this.config.options.enableNumericRoundabort === false) {\n      options.push('set numeric_roundabort off');\n    }\n\n    if (this.config.options.enableQuotedIdentifier === true) {\n      options.push('set quoted_identifier on');\n    } else if (this.config.options.enableQuotedIdentifier === false) {\n      options.push('set quoted_identifier off');\n    }\n\n    if (this.config.options.textsize !== null) {\n      options.push(`set textsize ${this.config.options.textsize}`);\n    }\n\n    if (this.config.options.connectionIsolationLevel !== null) {\n      options.push(`set transaction isolation level ${this.getIsolationLevelText(this.config.options.connectionIsolationLevel)}`);\n    }\n\n    if (this.config.options.abortTransactionOnError === true) {\n      options.push('set xact_abort on');\n    } else if (this.config.options.abortTransactionOnError === false) {\n      options.push('set xact_abort off');\n    }\n\n    return options.join('\\n');\n  }\n\n  /**\n   * @private\n   */\n  processedInitialSql() {\n    this.clearConnectTimer();\n    this.emit('connect');\n  }\n\n  /**\n   * Execute the SQL batch represented by [[Request]].\n   * There is no param support, and unlike [[Request.execSql]],\n   * it is not likely that SQL Server will reuse the execution plan it generates for the SQL.\n   *\n   * In almost all cases, [[Request.execSql]] will be a better choice.\n   *\n   * @param request A [[Request]] object representing the request.\n   */\n  execSqlBatch(request: Request) {\n    this.makeRequest(request, TYPE.SQL_BATCH, new SqlBatchPayload(request.sqlTextOrProcedure!, this.currentTransactionDescriptor(), this.config.options));\n  }\n\n  /**\n   *  Execute the SQL represented by [[Request]].\n   *\n   * As `sp_executesql` is used to execute the SQL, if the same SQL is executed multiples times\n   * using this function, the SQL Server query optimizer is likely to reuse the execution plan it generates\n   * for the first execution. This may also result in SQL server treating the request like a stored procedure\n   * which can result in the [[Event_doneInProc]] or [[Event_doneProc]] events being emitted instead of the\n   * [[Event_done]] event you might expect. Using [[execSqlBatch]] will prevent this from occurring but may have a negative performance impact.\n   *\n   * Beware of the way that scoping rules apply, and how they may [affect local temp tables](http://weblogs.sqlteam.com/mladenp/archive/2006/11/03/17197.aspx)\n   * If you're running in to scoping issues, then [[execSqlBatch]] may be a better choice.\n   * See also [issue #24](https://github.com/pekim/tedious/issues/24)\n   *\n   * @param request A [[Request]] object representing the request.\n   */\n  execSql(request: Request) {\n    try {\n      request.validateParameters(this.databaseCollation);\n    } catch (error: any) {\n      request.error = error;\n\n      process.nextTick(() => {\n        this.debug.log(error.message);\n        request.callback(error);\n      });\n\n      return;\n    }\n\n    const parameters: Parameter[] = [];\n\n    parameters.push({\n      type: TYPES.NVarChar,\n      name: 'statement',\n      value: request.sqlTextOrProcedure,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n\n    if (request.parameters.length) {\n      parameters.push({\n        type: TYPES.NVarChar,\n        name: 'params',\n        value: request.makeParamsParameter(request.parameters),\n        output: false,\n        length: undefined,\n        precision: undefined,\n        scale: undefined\n      });\n\n      parameters.push(...request.parameters);\n    }\n\n    this.makeRequest(request, TYPE.RPC_REQUEST, new RpcRequestPayload(Procedures.Sp_ExecuteSql, parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Creates a new BulkLoad instance.\n   *\n   * @param table The name of the table to bulk-insert into.\n   * @param options A set of bulk load options.\n   */\n  newBulkLoad(table: string, callback: BulkLoadCallback): BulkLoad\n  newBulkLoad(table: string, options: BulkLoadOptions, callback: BulkLoadCallback): BulkLoad\n  newBulkLoad(table: string, callbackOrOptions: BulkLoadOptions | BulkLoadCallback, callback?: BulkLoadCallback) {\n    let options: BulkLoadOptions;\n\n    if (callback === undefined) {\n      callback = callbackOrOptions as BulkLoadCallback;\n      options = {};\n    } else {\n      options = callbackOrOptions as BulkLoadOptions;\n    }\n\n    if (typeof options !== 'object') {\n      throw new TypeError('\"options\" argument must be an object');\n    }\n    return new BulkLoad(table, this.databaseCollation, this.config.options, options, callback);\n  }\n\n  /**\n   * Execute a [[BulkLoad]].\n   *\n   * ```js\n   * // We want to perform a bulk load into a table with the following format:\n   * // CREATE TABLE employees (first_name nvarchar(255), last_name nvarchar(255), day_of_birth date);\n   *\n   * const bulkLoad = connection.newBulkLoad('employees', (err, rowCount) => {\n   *   // ...\n   * });\n   *\n   * // First, we need to specify the columns that we want to write to,\n   * // and their definitions. These definitions must match the actual table,\n   * // otherwise the bulk load will fail.\n   * bulkLoad.addColumn('first_name', TYPES.NVarchar, { nullable: false });\n   * bulkLoad.addColumn('last_name', TYPES.NVarchar, { nullable: false });\n   * bulkLoad.addColumn('date_of_birth', TYPES.Date, { nullable: false });\n   *\n   * // Execute a bulk load with a predefined list of rows.\n   * //\n   * // Note that these rows are held in memory until the\n   * // bulk load was performed, so if you need to write a large\n   * // number of rows (e.g. by reading from a CSV file),\n   * // passing an `AsyncIterable` is advisable to keep memory usage low.\n   * connection.execBulkLoad(bulkLoad, [\n   *   { 'first_name': 'Steve', 'last_name': 'Jobs', 'day_of_birth': new Date('02-24-1955') },\n   *   { 'first_name': 'Bill', 'last_name': 'Gates', 'day_of_birth': new Date('10-28-1955') }\n   * ]);\n   * ```\n   *\n   * @param bulkLoad A previously created [[BulkLoad]].\n   * @param rows A [[Iterable]] or [[AsyncIterable]] that contains the rows that should be bulk loaded.\n   */\n  execBulkLoad(bulkLoad: BulkLoad, rows: AsyncIterable<unknown[] | { [columnName: string]: unknown }> | Iterable<unknown[] | { [columnName: string]: unknown }>): void\n\n  execBulkLoad(bulkLoad: BulkLoad, rows?: AsyncIterable<unknown[] | { [columnName: string]: unknown }> | Iterable<unknown[] | { [columnName: string]: unknown }>) {\n    bulkLoad.executionStarted = true;\n\n    if (rows) {\n      if (bulkLoad.streamingMode) {\n        throw new Error(\"Connection.execBulkLoad can't be called with a BulkLoad that was put in streaming mode.\");\n      }\n\n      if (bulkLoad.firstRowWritten) {\n        throw new Error(\"Connection.execBulkLoad can't be called with a BulkLoad that already has rows written to it.\");\n      }\n\n      const rowStream = Readable.from(rows);\n\n      // Destroy the packet transform if an error happens in the row stream,\n      // e.g. if an error is thrown from within a generator or stream.\n      rowStream.on('error', (err) => {\n        bulkLoad.rowToPacketTransform.destroy(err);\n      });\n\n      // Destroy the row stream if an error happens in the packet transform,\n      // e.g. if the bulk load is cancelled.\n      bulkLoad.rowToPacketTransform.on('error', (err) => {\n        rowStream.destroy(err);\n      });\n\n      rowStream.pipe(bulkLoad.rowToPacketTransform);\n    } else if (!bulkLoad.streamingMode) {\n      // If the bulkload was not put into streaming mode by the user,\n      // we end the rowToPacketTransform here for them.\n      //\n      // If it was put into streaming mode, it's the user's responsibility\n      // to end the stream.\n      bulkLoad.rowToPacketTransform.end();\n    }\n\n    const onCancel = () => {\n      request.cancel();\n    };\n\n    const payload = new BulkLoadPayload(bulkLoad);\n\n    const request = new Request(bulkLoad.getBulkInsertSql(), (error: (Error & { code?: string }) | null | undefined) => {\n      bulkLoad.removeListener('cancel', onCancel);\n\n      if (error) {\n        if (error.code === 'UNKNOWN') {\n          error.message += ' This is likely because the schema of the BulkLoad does not match the schema of the table you are attempting to insert into.';\n        }\n        bulkLoad.error = error;\n        bulkLoad.callback(error);\n        return;\n      }\n\n      this.makeRequest(bulkLoad, TYPE.BULK_LOAD, payload);\n    });\n\n    bulkLoad.once('cancel', onCancel);\n\n    this.execSqlBatch(request);\n  }\n\n  /**\n   * Prepare the SQL represented by the request.\n   *\n   * The request can then be used in subsequent calls to\n   * [[execute]] and [[unprepare]]\n   *\n   * @param request A [[Request]] object representing the request.\n   *   Parameters only require a name and type. Parameter values are ignored.\n   */\n  prepare(request: Request) {\n    const parameters: Parameter[] = [];\n\n    parameters.push({\n      type: TYPES.Int,\n      name: 'handle',\n      value: undefined,\n      output: true,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n\n    parameters.push({\n      type: TYPES.NVarChar,\n      name: 'params',\n      value: request.parameters.length ? request.makeParamsParameter(request.parameters) : null,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n\n    parameters.push({\n      type: TYPES.NVarChar,\n      name: 'stmt',\n      value: request.sqlTextOrProcedure,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n\n    request.preparing = true;\n\n    // TODO: We need to clean up this event handler, otherwise this leaks memory\n    request.on('returnValue', (name: string, value: any) => {\n      if (name === 'handle') {\n        request.handle = value;\n      } else {\n        request.error = new RequestError(`Tedious > Unexpected output parameter ${name} from sp_prepare`);\n      }\n    });\n\n    this.makeRequest(request, TYPE.RPC_REQUEST, new RpcRequestPayload(Procedures.Sp_Prepare, parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Release the SQL Server resources associated with a previously prepared request.\n   *\n   * @param request A [[Request]] object representing the request.\n   *   Parameters only require a name and type.\n   *   Parameter values are ignored.\n   */\n  unprepare(request: Request) {\n    const parameters: Parameter[] = [];\n\n    parameters.push({\n      type: TYPES.Int,\n      name: 'handle',\n      // TODO: Abort if `request.handle` is not set\n      value: request.handle,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n\n    this.makeRequest(request, TYPE.RPC_REQUEST, new RpcRequestPayload(Procedures.Sp_Unprepare, parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Execute previously prepared SQL, using the supplied parameters.\n   *\n   * @param request A previously prepared [[Request]].\n   * @param parameters  An object whose names correspond to the names of\n   *   parameters that were added to the [[Request]] before it was prepared.\n   *   The object's values are passed as the parameters' values when the\n   *   request is executed.\n   */\n  execute(request: Request, parameters?: { [key: string]: unknown }) {\n    const executeParameters: Parameter[] = [];\n\n    executeParameters.push({\n      type: TYPES.Int,\n      name: '',\n      // TODO: Abort if `request.handle` is not set\n      value: request.handle,\n      output: false,\n      length: undefined,\n      precision: undefined,\n      scale: undefined\n    });\n\n    try {\n      for (let i = 0, len = request.parameters.length; i < len; i++) {\n        const parameter = request.parameters[i];\n\n        executeParameters.push({\n          ...parameter,\n          value: parameter.type.validate(parameters ? parameters[parameter.name] : null, this.databaseCollation)\n        });\n      }\n    } catch (error: any) {\n      request.error = error;\n\n      process.nextTick(() => {\n        this.debug.log(error.message);\n        request.callback(error);\n      });\n\n      return;\n    }\n\n    this.makeRequest(request, TYPE.RPC_REQUEST, new RpcRequestPayload(Procedures.Sp_Execute, executeParameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Call a stored procedure represented by [[Request]].\n   *\n   * @param request A [[Request]] object representing the request.\n   */\n  callProcedure(request: Request) {\n    try {\n      request.validateParameters(this.databaseCollation);\n    } catch (error: any) {\n      request.error = error;\n\n      process.nextTick(() => {\n        this.debug.log(error.message);\n        request.callback(error);\n      });\n\n      return;\n    }\n\n    this.makeRequest(request, TYPE.RPC_REQUEST, new RpcRequestPayload(request.sqlTextOrProcedure!, request.parameters, this.currentTransactionDescriptor(), this.config.options, this.databaseCollation));\n  }\n\n  /**\n   * Start a transaction.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\n   *   Optional, and defaults to an empty string. Required when `isolationLevel`\n   *   is present.\n   * @param isolationLevel The isolation level that the transaction is to be run with.\n   *\n   *   The isolation levels are available from `require('tedious').ISOLATION_LEVEL`.\n   *   * `READ_UNCOMMITTED`\n   *   * `READ_COMMITTED`\n   *   * `REPEATABLE_READ`\n   *   * `SERIALIZABLE`\n   *   * `SNAPSHOT`\n   *\n   *   Optional, and defaults to the Connection's isolation level.\n   */\n  beginTransaction(callback: BeginTransactionCallback, name = '', isolationLevel = this.config.options.isolationLevel) {\n    assertValidIsolationLevel(isolationLevel, 'isolationLevel');\n\n    const transaction = new Transaction(name, isolationLevel);\n\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new Request('SET TRANSACTION ISOLATION LEVEL ' + (transaction.isolationLevelToTSQL()) + ';BEGIN TRAN ' + transaction.name, (err) => {\n        this.transactionDepth++;\n        if (this.transactionDepth === 1) {\n          this.inTransaction = true;\n        }\n        callback(err);\n      }));\n    }\n\n    const request = new Request(undefined, (err) => {\n      return callback(err, this.currentTransactionDescriptor());\n    });\n    return this.makeRequest(request, TYPE.TRANSACTION_MANAGER, transaction.beginPayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Commit a transaction.\n   *\n   * There should be an active transaction - that is, [[beginTransaction]]\n   * should have been previously called.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\n   *   Optional, and defaults to an empty string. Required when `isolationLevel`is present.\n   */\n  commitTransaction(callback: CommitTransactionCallback, name = '') {\n    const transaction = new Transaction(name);\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new Request('COMMIT TRAN ' + transaction.name, (err) => {\n        this.transactionDepth--;\n        if (this.transactionDepth === 0) {\n          this.inTransaction = false;\n        }\n\n        callback(err);\n      }));\n    }\n    const request = new Request(undefined, callback);\n    return this.makeRequest(request, TYPE.TRANSACTION_MANAGER, transaction.commitPayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Rollback a transaction.\n   *\n   * There should be an active transaction - that is, [[beginTransaction]]\n   * should have been previously called.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\n   *   Optional, and defaults to an empty string.\n   *   Required when `isolationLevel` is present.\n   */\n  rollbackTransaction(callback: RollbackTransactionCallback, name = '') {\n    const transaction = new Transaction(name);\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new Request('ROLLBACK TRAN ' + transaction.name, (err) => {\n        this.transactionDepth--;\n        if (this.transactionDepth === 0) {\n          this.inTransaction = false;\n        }\n        callback(err);\n      }));\n    }\n    const request = new Request(undefined, callback);\n    return this.makeRequest(request, TYPE.TRANSACTION_MANAGER, transaction.rollbackPayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Set a savepoint within a transaction.\n   *\n   * There should be an active transaction - that is, [[beginTransaction]]\n   * should have been previously called.\n   *\n   * @param callback\n   * @param name A string representing a name to associate with the transaction.\\\n   *   Optional, and defaults to an empty string.\n   *   Required when `isolationLevel` is present.\n   */\n  saveTransaction(callback: SaveTransactionCallback, name: string) {\n    const transaction = new Transaction(name);\n    if (this.config.options.tdsVersion < '7_2') {\n      return this.execSqlBatch(new Request('SAVE TRAN ' + transaction.name, (err) => {\n        this.transactionDepth++;\n        callback(err);\n      }));\n    }\n    const request = new Request(undefined, callback);\n    return this.makeRequest(request, TYPE.TRANSACTION_MANAGER, transaction.savePayload(this.currentTransactionDescriptor()));\n  }\n\n  /**\n   * Run the given callback after starting a transaction, and commit or\n   * rollback the transaction afterwards.\n   *\n   * This is a helper that employs [[beginTransaction]], [[commitTransaction]],\n   * [[rollbackTransaction]], and [[saveTransaction]] to greatly simplify the\n   * use of database transactions and automatically handle transaction nesting.\n   *\n   * @param cb\n   * @param isolationLevel\n   *   The isolation level that the transaction is to be run with.\n   *\n   *   The isolation levels are available from `require('tedious').ISOLATION_LEVEL`.\n   *   * `READ_UNCOMMITTED`\n   *   * `READ_COMMITTED`\n   *   * `REPEATABLE_READ`\n   *   * `SERIALIZABLE`\n   *   * `SNAPSHOT`\n   *\n   *   Optional, and defaults to the Connection's isolation level.\n   */\n  transaction(cb: (err: Error | null | undefined, txDone?: <T extends TransactionDoneCallback>(err: Error | null | undefined, done: T, ...args: CallbackParameters<T>) => void) => void, isolationLevel?: typeof ISOLATION_LEVEL[keyof typeof ISOLATION_LEVEL]) {\n    if (typeof cb !== 'function') {\n      throw new TypeError('`cb` must be a function');\n    }\n\n    const useSavepoint = this.inTransaction;\n    const name = '_tedious_' + (crypto.randomBytes(10).toString('hex'));\n    const txDone: <T extends TransactionDoneCallback>(err: Error | null | undefined, done: T, ...args: CallbackParameters<T>) => void = (err, done, ...args) => {\n      if (err) {\n        if (this.inTransaction && this.state === this.STATE.LOGGED_IN) {\n          this.rollbackTransaction((txErr) => {\n            done(txErr || err, ...args);\n          }, name);\n        } else {\n          done(err, ...args);\n        }\n      } else if (useSavepoint) {\n        if (this.config.options.tdsVersion < '7_2') {\n          this.transactionDepth--;\n        }\n        done(null, ...args);\n      } else {\n        this.commitTransaction((txErr) => {\n          done(txErr, ...args);\n        }, name);\n      }\n    };\n\n    if (useSavepoint) {\n      return this.saveTransaction((err) => {\n        if (err) {\n          return cb(err);\n        }\n\n        if (isolationLevel) {\n          return this.execSqlBatch(new Request('SET transaction isolation level ' + this.getIsolationLevelText(isolationLevel), (err) => {\n            return cb(err, txDone);\n          }));\n        } else {\n          return cb(null, txDone);\n        }\n      }, name);\n    } else {\n      return this.beginTransaction((err) => {\n        if (err) {\n          return cb(err);\n        }\n\n        return cb(null, txDone);\n      }, name, isolationLevel);\n    }\n  }\n\n  /**\n   * @private\n   */\n  makeRequest(request: Request | BulkLoad, packetType: number, payload: (Iterable<Buffer> | AsyncIterable<Buffer>) & { toString: (indent?: string) => string }) {\n    if (this.state !== this.STATE.LOGGED_IN) {\n      const message = 'Requests can only be made in the ' + this.STATE.LOGGED_IN.name + ' state, not the ' + this.state.name + ' state';\n      this.debug.log(message);\n      request.callback(new RequestError(message, 'EINVALIDSTATE'));\n    } else if (request.canceled) {\n      process.nextTick(() => {\n        request.callback(new RequestError('Canceled.', 'ECANCEL'));\n      });\n    } else {\n      if (packetType === TYPE.SQL_BATCH) {\n        this.isSqlBatch = true;\n      } else {\n        this.isSqlBatch = false;\n      }\n\n      this.request = request;\n      request.connection! = this;\n      request.rowCount! = 0;\n      request.rows! = [];\n      request.rst! = [];\n\n      const onCancel = () => {\n        payloadStream.unpipe(message);\n        payloadStream.destroy(new RequestError('Canceled.', 'ECANCEL'));\n\n        // set the ignore bit and end the message.\n        message.ignore = true;\n        message.end();\n\n        if (request instanceof Request && request.paused) {\n          // resume the request if it was paused so we can read the remaining tokens\n          request.resume();\n        }\n      };\n\n      request.once('cancel', onCancel);\n\n      this.createRequestTimer();\n\n      const message = new Message({ type: packetType, resetConnection: this.resetConnectionOnNextRequest });\n      this.messageIo.outgoingMessageStream.write(message);\n      this.transitionTo(this.STATE.SENT_CLIENT_REQUEST);\n\n      message.once('finish', () => {\n        request.removeListener('cancel', onCancel);\n        request.once('cancel', this._cancelAfterRequestSent);\n\n        this.resetConnectionOnNextRequest = false;\n        this.debug.payload(function() {\n          return payload!.toString('  ');\n        });\n      });\n\n      const payloadStream = Readable.from(payload);\n      payloadStream.once('error', (error) => {\n        payloadStream.unpipe(message);\n\n        // Only set a request error if no error was set yet.\n        request.error ??= error;\n\n        message.ignore = true;\n        message.end();\n      });\n      payloadStream.pipe(message);\n    }\n  }\n\n  /**\n   * Cancel currently executed request.\n   */\n  cancel() {\n    if (!this.request) {\n      return false;\n    }\n\n    if (this.request.canceled) {\n      return false;\n    }\n\n    this.request.cancel();\n    return true;\n  }\n\n  /**\n   * Reset the connection to its initial state.\n   * Can be useful for connection pool implementations.\n   *\n   * @param callback\n   */\n  reset(callback: ResetCallback) {\n    const request = new Request(this.getInitialSql(), (err) => {\n      if (this.config.options.tdsVersion < '7_2') {\n        this.inTransaction = false;\n      }\n      callback(err);\n    });\n    this.resetConnectionOnNextRequest = true;\n    this.execSqlBatch(request);\n  }\n\n  /**\n   * @private\n   */\n  currentTransactionDescriptor() {\n    return this.transactionDescriptors[this.transactionDescriptors.length - 1];\n  }\n\n  /**\n   * @private\n   */\n  getIsolationLevelText(isolationLevel: typeof ISOLATION_LEVEL[keyof typeof ISOLATION_LEVEL]) {\n    switch (isolationLevel) {\n      case ISOLATION_LEVEL.READ_UNCOMMITTED:\n        return 'read uncommitted';\n      case ISOLATION_LEVEL.REPEATABLE_READ:\n        return 'repeatable read';\n      case ISOLATION_LEVEL.SERIALIZABLE:\n        return 'serializable';\n      case ISOLATION_LEVEL.SNAPSHOT:\n        return 'snapshot';\n      default:\n        return 'read committed';\n    }\n  }\n}\n\nfunction isTransientError(error: AggregateError | ConnectionError): boolean {\n  if (error instanceof AggregateError) {\n    error = error.errors[0];\n  }\n  return (error instanceof ConnectionError) && !!error.isTransient;\n}\n\nexport default Connection;\nmodule.exports = Connection;\n\nConnection.prototype.STATE = {\n  INITIALIZED: {\n    name: 'Initialized',\n    events: {}\n  },\n  CONNECTING: {\n    name: 'Connecting',\n    enter: function() {\n      this.initialiseConnection();\n    },\n    events: {\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_PRELOGIN: {\n    name: 'SentPrelogin',\n    enter: function() {\n      (async () => {\n        let messageBuffer = Buffer.alloc(0);\n\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err: any) {\n          return this.socketError(err);\n        }\n\n        for await (const data of message) {\n          messageBuffer = Buffer.concat([messageBuffer, data]);\n        }\n\n        const preloginPayload = new PreloginPayload(messageBuffer);\n        this.debug.payload(function() {\n          return preloginPayload.toString('  ');\n        });\n\n        if (preloginPayload.fedAuthRequired === 1) {\n          this.fedAuthRequired = true;\n        }\n        if ('strict' !== this.config.options.encrypt && (preloginPayload.encryptionString === 'ON' || preloginPayload.encryptionString === 'REQ')) {\n          if (!this.config.options.encrypt) {\n            this.emit('connect', new ConnectionError(\"Server requires encryption, set 'encrypt' config option to true.\", 'EENCRYPT'));\n            return this.close();\n          }\n\n          try {\n            this.transitionTo(this.STATE.SENT_TLSSSLNEGOTIATION);\n            await this.messageIo.startTls(this.secureContextOptions, this.config.options.serverName ? this.config.options.serverName : this.routingData?.server ?? this.config.server, this.config.options.trustServerCertificate);\n          } catch (err: any) {\n            return this.socketError(err);\n          }\n        }\n\n        this.sendLogin7Packet();\n\n        const { authentication } = this.config;\n\n        switch (authentication.type) {\n          case 'token-credential':\n          case 'azure-active-directory-password':\n          case 'azure-active-directory-msi-vm':\n          case 'azure-active-directory-msi-app-service':\n          case 'azure-active-directory-service-principal-secret':\n          case 'azure-active-directory-default':\n            this.transitionTo(this.STATE.SENT_LOGIN7_WITH_FEDAUTH);\n            break;\n          case 'ntlm':\n            this.transitionTo(this.STATE.SENT_LOGIN7_WITH_NTLM);\n            break;\n          default:\n            this.transitionTo(this.STATE.SENT_LOGIN7_WITH_STANDARD_LOGIN);\n            break;\n        }\n      })().catch((err) => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  REROUTING: {\n    name: 'ReRouting',\n    enter: function() {\n      this.cleanupConnection(CLEANUP_TYPE.REDIRECT);\n    },\n    events: {\n      message: function() {\n      },\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      reconnect: function() {\n        this.transitionTo(this.STATE.CONNECTING);\n      }\n    }\n  },\n  TRANSIENT_FAILURE_RETRY: {\n    name: 'TRANSIENT_FAILURE_RETRY',\n    enter: function() {\n      this.curTransientRetryCount++;\n      this.cleanupConnection(CLEANUP_TYPE.RETRY);\n    },\n    events: {\n      message: function() {\n      },\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      retry: function() {\n        this.createRetryTimer();\n      }\n    }\n  },\n  SENT_TLSSSLNEGOTIATION: {\n    name: 'SentTLSSSLNegotiation',\n    events: {\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_LOGIN7_WITH_STANDARD_LOGIN: {\n    name: 'SentLogin7WithStandardLogin',\n    enter: function() {\n      (async () => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err: any) {\n          return this.socketError(err);\n        }\n\n        const handler = new Login7TokenHandler(this);\n        const tokenStreamParser = this.createTokenStreamParser(message, handler);\n\n        await once(tokenStreamParser, 'end');\n\n        if (handler.loginAckReceived) {\n          if (handler.routingData) {\n            this.routingData = handler.routingData;\n            this.transitionTo(this.STATE.REROUTING);\n          } else {\n            this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL);\n          }\n        } else if (this.loginError) {\n          if (isTransientError(this.loginError)) {\n            this.debug.log('Initiating retry on transient error');\n            this.transitionTo(this.STATE.TRANSIENT_FAILURE_RETRY);\n          } else {\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n          }\n        } else {\n          this.emit('connect', new ConnectionError('Login failed.', 'ELOGIN'));\n          this.transitionTo(this.STATE.FINAL);\n        }\n      })().catch((err) => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_LOGIN7_WITH_NTLM: {\n    name: 'SentLogin7WithNTLMLogin',\n    enter: function() {\n      (async () => {\n        while (true) {\n          let message;\n          try {\n            message = await this.messageIo.readMessage();\n          } catch (err: any) {\n            return this.socketError(err);\n          }\n\n          const handler = new Login7TokenHandler(this);\n          const tokenStreamParser = this.createTokenStreamParser(message, handler);\n\n          await once(tokenStreamParser, 'end');\n\n          if (handler.loginAckReceived) {\n            if (handler.routingData) {\n              this.routingData = handler.routingData;\n              return this.transitionTo(this.STATE.REROUTING);\n            } else {\n              return this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL);\n            }\n          } else if (this.ntlmpacket) {\n            const authentication = this.config.authentication as NtlmAuthentication;\n\n            const payload = new NTLMResponsePayload({\n              domain: authentication.options.domain,\n              userName: authentication.options.userName,\n              password: authentication.options.password,\n              ntlmpacket: this.ntlmpacket\n            });\n\n            this.messageIo.sendMessage(TYPE.NTLMAUTH_PKT, payload.data);\n            this.debug.payload(function() {\n              return payload.toString('  ');\n            });\n\n            this.ntlmpacket = undefined;\n          } else if (this.loginError) {\n            if (isTransientError(this.loginError)) {\n              this.debug.log('Initiating retry on transient error');\n              return this.transitionTo(this.STATE.TRANSIENT_FAILURE_RETRY);\n            } else {\n              this.emit('connect', this.loginError);\n              return this.transitionTo(this.STATE.FINAL);\n            }\n          } else {\n            this.emit('connect', new ConnectionError('Login failed.', 'ELOGIN'));\n            return this.transitionTo(this.STATE.FINAL);\n          }\n        }\n\n      })().catch((err) => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_LOGIN7_WITH_FEDAUTH: {\n    name: 'SentLogin7Withfedauth',\n    enter: function() {\n      (async () => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err: any) {\n          return this.socketError(err);\n        }\n\n        const handler = new Login7TokenHandler(this);\n        const tokenStreamParser = this.createTokenStreamParser(message, handler);\n        await once(tokenStreamParser, 'end');\n        if (handler.loginAckReceived) {\n          if (handler.routingData) {\n            this.routingData = handler.routingData;\n            this.transitionTo(this.STATE.REROUTING);\n          } else {\n            this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL);\n          }\n\n          return;\n        }\n\n        const fedAuthInfoToken = handler.fedAuthInfoToken;\n\n        if (fedAuthInfoToken && fedAuthInfoToken.stsurl && fedAuthInfoToken.spn) {\n          /** Federated authentication configation. */\n          const authentication = this.config.authentication as TokenCredentialAuthentication | AzureActiveDirectoryPasswordAuthentication | AzureActiveDirectoryMsiVmAuthentication | AzureActiveDirectoryMsiAppServiceAuthentication | AzureActiveDirectoryServicePrincipalSecret | AzureActiveDirectoryDefaultAuthentication;\n          /** Permission scope to pass to Entra ID when requesting an authentication token. */\n          const tokenScope = new URL('/.default', fedAuthInfoToken.spn).toString();\n\n          /** Instance of the token credential to use to authenticate to the resource. */\n          let credentials: TokenCredential;\n\n          switch (authentication.type) {\n            case 'token-credential':\n              credentials = authentication.options.credential;\n              break;\n            case 'azure-active-directory-password':\n              credentials = new UsernamePasswordCredential(\n                authentication.options.tenantId ?? 'common',\n                authentication.options.clientId,\n                authentication.options.userName,\n                authentication.options.password\n              );\n              break;\n            case 'azure-active-directory-msi-vm':\n            case 'azure-active-directory-msi-app-service':\n              const msiArgs = authentication.options.clientId ? [authentication.options.clientId, {}] : [{}];\n              credentials = new ManagedIdentityCredential(...msiArgs);\n              break;\n            case 'azure-active-directory-default':\n              const args = authentication.options.clientId ? { managedIdentityClientId: authentication.options.clientId } : {};\n              credentials = new DefaultAzureCredential(args);\n              break;\n            case 'azure-active-directory-service-principal-secret':\n              credentials = new ClientSecretCredential(\n                authentication.options.tenantId,\n                authentication.options.clientId,\n                authentication.options.clientSecret\n              );\n              break;\n          }\n\n          /** Access token retrieved from Entra ID for the configured permission scope(s). */\n          let tokenResponse: AccessToken | null;\n\n          try {\n            tokenResponse = await credentials.getToken(tokenScope);\n          } catch (err) {\n            this.loginError = new AggregateError(\n              [new ConnectionError('Security token could not be authenticated or authorized.', 'EFEDAUTH'), err]);\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n            return;\n          }\n\n          // Type guard the token value so that it is never null.\n          if (tokenResponse === null) {\n            this.loginError = new AggregateError(\n              [new ConnectionError('Security token could not be authenticated or authorized.', 'EFEDAUTH')]);\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n            return;\n          }\n\n          this.sendFedAuthTokenMessage(tokenResponse.token);\n\n        } else if (this.loginError) {\n          if (isTransientError(this.loginError)) {\n            this.debug.log('Initiating retry on transient error');\n            this.transitionTo(this.STATE.TRANSIENT_FAILURE_RETRY);\n          } else {\n            this.emit('connect', this.loginError);\n            this.transitionTo(this.STATE.FINAL);\n          }\n        } else {\n          this.emit('connect', new ConnectionError('Login failed.', 'ELOGIN'));\n          this.transitionTo(this.STATE.FINAL);\n        }\n\n      })().catch((err) => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  LOGGED_IN_SENDING_INITIAL_SQL: {\n    name: 'LoggedInSendingInitialSql',\n    enter: function() {\n      (async () => {\n        this.sendInitialSql();\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err: any) {\n          return this.socketError(err);\n        }\n        const tokenStreamParser = this.createTokenStreamParser(message, new InitialSqlTokenHandler(this));\n        await once(tokenStreamParser, 'end');\n\n        this.transitionTo(this.STATE.LOGGED_IN);\n        this.processedInitialSql();\n\n      })().catch((err) => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function socketError() {\n        this.transitionTo(this.STATE.FINAL);\n      },\n      connectTimeout: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  LOGGED_IN: {\n    name: 'LoggedIn',\n    events: {\n      socketError: function() {\n        this.transitionTo(this.STATE.FINAL);\n      }\n    }\n  },\n  SENT_CLIENT_REQUEST: {\n    name: 'SentClientRequest',\n    enter: function() {\n      (async () => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err: any) {\n          return this.socketError(err);\n        }\n        // request timer is stopped on first data package\n        this.clearRequestTimer();\n\n        const tokenStreamParser = this.createTokenStreamParser(message, new RequestTokenHandler(this, this.request!));\n\n        // If the request was canceled and we have a `cancelTimer`\n        // defined, we send a attention message after the\n        // request message was fully sent off.\n        //\n        // We already started consuming the current message\n        // (but all the token handlers should be no-ops), and\n        // need to ensure the next message is handled by the\n        // `SENT_ATTENTION` state.\n        if (this.request?.canceled && this.cancelTimer) {\n          return this.transitionTo(this.STATE.SENT_ATTENTION);\n        }\n\n        const onResume = () => {\n          tokenStreamParser.resume();\n        };\n        const onPause = () => {\n          tokenStreamParser.pause();\n\n          this.request?.once('resume', onResume);\n        };\n\n        this.request?.on('pause', onPause);\n\n        if (this.request instanceof Request && this.request.paused) {\n          onPause();\n        }\n\n        const onCancel = () => {\n          tokenStreamParser.removeListener('end', onEndOfMessage);\n\n          if (this.request instanceof Request && this.request.paused) {\n            // resume the request if it was paused so we can read the remaining tokens\n            this.request.resume();\n          }\n\n          this.request?.removeListener('pause', onPause);\n          this.request?.removeListener('resume', onResume);\n\n          // The `_cancelAfterRequestSent` callback will have sent a\n          // attention message, so now we need to also switch to\n          // the `SENT_ATTENTION` state to make sure the attention ack\n          // message is processed correctly.\n          this.transitionTo(this.STATE.SENT_ATTENTION);\n        };\n\n        const onEndOfMessage = () => {\n          this.request?.removeListener('cancel', this._cancelAfterRequestSent);\n          this.request?.removeListener('cancel', onCancel);\n          this.request?.removeListener('pause', onPause);\n          this.request?.removeListener('resume', onResume);\n\n          this.transitionTo(this.STATE.LOGGED_IN);\n          const sqlRequest = this.request as Request;\n          this.request = undefined;\n          if (this.config.options.tdsVersion < '7_2' && sqlRequest.error && this.isSqlBatch) {\n            this.inTransaction = false;\n          }\n          sqlRequest.callback(sqlRequest.error, sqlRequest.rowCount, sqlRequest.rows);\n        };\n\n        tokenStreamParser.once('end', onEndOfMessage);\n        this.request?.once('cancel', onCancel);\n      })();\n\n    },\n    exit: function(nextState) {\n      this.clearRequestTimer();\n    },\n    events: {\n      socketError: function(err) {\n        const sqlRequest = this.request!;\n        this.request = undefined;\n        this.transitionTo(this.STATE.FINAL);\n\n        sqlRequest.callback(err);\n      }\n    }\n  },\n  SENT_ATTENTION: {\n    name: 'SentAttention',\n    enter: function() {\n      (async () => {\n        let message;\n        try {\n          message = await this.messageIo.readMessage();\n        } catch (err: any) {\n          return this.socketError(err);\n        }\n\n        const handler = new AttentionTokenHandler(this, this.request!);\n        const tokenStreamParser = this.createTokenStreamParser(message, handler);\n\n        await once(tokenStreamParser, 'end');\n        // 3.2.5.7 Sent Attention State\n        // Discard any data contained in the response, until we receive the attention response\n        if (handler.attentionReceived) {\n          this.clearCancelTimer();\n\n          const sqlRequest = this.request!;\n          this.request = undefined;\n          this.transitionTo(this.STATE.LOGGED_IN);\n\n          if (sqlRequest.error && sqlRequest.error instanceof RequestError && sqlRequest.error.code === 'ETIMEOUT') {\n            sqlRequest.callback(sqlRequest.error);\n          } else {\n            sqlRequest.callback(new RequestError('Canceled.', 'ECANCEL'));\n          }\n        }\n\n      })().catch((err) => {\n        process.nextTick(() => {\n          throw err;\n        });\n      });\n    },\n    events: {\n      socketError: function(err) {\n        const sqlRequest = this.request!;\n        this.request = undefined;\n\n        this.transitionTo(this.STATE.FINAL);\n\n        sqlRequest.callback(err);\n      }\n    }\n  },\n  FINAL: {\n    name: 'Final',\n    enter: function() {\n      this.cleanupConnection(CLEANUP_TYPE.NORMAL);\n    },\n    events: {\n      connectTimeout: function() {\n        // Do nothing, as the timer should be cleaned up.\n      },\n      message: function() {\n        // Do nothing\n      },\n      socketError: function() {\n        // Do nothing\n      }\n    }\n  }\n};\n"],"mappings":"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;AACA;AACA;AACA,MAAMC,uBAAuB,GAAG,EAAE,GAAG,IAAI;AACzC;AACA;AACA;AACA,MAAMC,8BAA8B,GAAG,EAAE,GAAG,IAAI;AAChD;AACA;AACA;AACA,MAAMC,sBAAsB,GAAG,CAAC,GAAG,IAAI;AACvC;AACA;AACA;AACA,MAAMC,8BAA8B,GAAG,GAAG;AAC1C;AACA;AACA;AACA,MAAMC,mBAAmB,GAAG,CAAC,GAAG,IAAI;AACpC;AACA;AACA;AACA,MAAMC,gBAAgB,GAAG,UAAU;AACnC;AACA;AACA;AACA,MAAMC,iBAAiB,GAAG,CAAC;AAC3B;AACA;AACA;AACA,MAAMC,YAAY,GAAG,IAAI;AACzB;AACA;AACA;AACA,MAAMC,mBAAmB,GAAG,KAAK;AACjC;AACA;AACA;AACA,MAAMC,gBAAgB,GAAG,YAAY;AACrC;AACA;AACA;AACA,MAAMC,kBAAkB,GAAG,KAAK;;AAgGhC;;AAwHA;AACA;AACA;;AA4cA;AACA;AACA;AACA,MAAMC,YAAY,GAAG;EACnBC,MAAM,EAAE,CAAC;EACTC,QAAQ,EAAE,CAAC;EACXC,KAAK,EAAE;AACT,CAAC;AAOD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,UAAU,SAAS/D,OAAA,CAAAgE,YAAY,CAAC;EACpC;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAGE;AACF;AACA;;EAkBE;AACF;AACA;;EAGE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAGE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAEE;AACF;AACA;;EAGE;AACF;AACA;;EAEE;AACF;AACA;;EAEE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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}