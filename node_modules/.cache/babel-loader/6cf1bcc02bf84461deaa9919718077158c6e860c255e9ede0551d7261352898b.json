{"ast":null,"code":"'use strict';\n\nconst {\n  EventEmitter\n} = require('node:events');\nconst debug = require('debug')('mssql:base');\nconst {\n  parseSqlConnectionString\n} = require('@tediousjs/connection-string');\nconst tarn = require('tarn');\nconst {\n  IDS\n} = require('../utils');\nconst ConnectionError = require('../error/connection-error');\nconst shared = require('../shared');\nconst clone = require('rfdc/default');\nconst {\n  MSSQLError\n} = require('../error');\n\n/**\n * Class ConnectionPool.\n *\n * Internally, each `Connection` instance is a separate pool of TDS connections. Once you create a new `Request`/`Transaction`/`Prepared Statement`, a new TDS connection is acquired from the pool and reserved for desired action. Once the action is complete, connection is released back to the pool.\n *\n * @property {Boolean} connected If true, connection is established.\n * @property {Boolean} connecting If true, connection is being established.\n *\n * @fires ConnectionPool#connect\n * @fires ConnectionPool#close\n */\n\nclass ConnectionPool extends EventEmitter {\n  /**\n   * Create new Connection.\n   *\n   * @param {Object|String} config Connection configuration object or connection string.\n   * @param {basicCallback} [callback] A callback which is called after connection has established, or an error has occurred.\n   */\n\n  constructor(config, callback) {\n    super();\n    IDS.add(this, 'ConnectionPool');\n    debug('pool(%d): created', IDS.get(this));\n    this._connectStack = [];\n    this._closeStack = [];\n    this._connected = false;\n    this._connecting = false;\n    this._healthy = false;\n    if (typeof config === 'string') {\n      try {\n        this.config = this.constructor.parseConnectionString(config);\n      } catch (ex) {\n        if (typeof callback === 'function') {\n          return setImmediate(callback, ex);\n        }\n        throw ex;\n      }\n    } else {\n      this.config = clone(config);\n    }\n\n    // set defaults\n    this.config.port = this.config.port || 1433;\n    this.config.options = this.config.options || {};\n    this.config.stream = this.config.stream || false;\n    this.config.parseJSON = this.config.parseJSON || false;\n    this.config.arrayRowMode = this.config.arrayRowMode || false;\n    this.config.validateConnection = 'validateConnection' in this.config ? this.config.validateConnection : true;\n    const namedServer = /^(.*)\\\\(.*)$/.exec(this.config.server);\n    if (namedServer) {\n      this.config.server = namedServer[1];\n      this.config.options.instanceName = namedServer[2];\n    }\n    if (typeof this.config.options.useColumnNames !== 'undefined' && this.config.options.useColumnNames !== true) {\n      const ex = new MSSQLError('Invalid options `useColumnNames`, use `arrayRowMode` instead');\n      if (typeof callback === 'function') {\n        return setImmediate(callback, ex);\n      }\n      throw ex;\n    }\n    if (typeof callback === 'function') {\n      this.connect(callback);\n    }\n  }\n  get connected() {\n    return this._connected;\n  }\n  get connecting() {\n    return this._connecting;\n  }\n  get healthy() {\n    return this._healthy;\n  }\n  static parseConnectionString(connectionString) {\n    return this._parseConnectionString(connectionString);\n  }\n  static _parseAuthenticationType(type, entries) {\n    switch (type.toLowerCase()) {\n      case 'active directory integrated':\n        if (entries.includes('token')) {\n          return 'azure-active-directory-access-token';\n        } else if (['client id', 'client secret', 'tenant id'].every(entry => entries.includes(entry))) {\n          return 'azure-active-directory-service-principal-secret';\n        } else if (['client id', 'msi endpoint', 'msi secret'].every(entry => entries.includes(entry))) {\n          return 'azure-active-directory-msi-app-service';\n        } else if (['client id', 'msi endpoint'].every(entry => entries.includes(entry))) {\n          return 'azure-active-directory-msi-vm';\n        }\n        return 'azure-active-directory-default';\n      case 'active directory password':\n        return 'azure-active-directory-password';\n      case 'ntlm':\n        return 'ntlm';\n      default:\n        return 'default';\n    }\n  }\n  static _parseConnectionString(connectionString) {\n    const parsed = parseSqlConnectionString(connectionString, true, true);\n    return Object.entries(parsed).reduce((config, [key, value]) => {\n      switch (key) {\n        case 'application name':\n          break;\n        case 'applicationintent':\n          Object.assign(config.options, {\n            readOnlyIntent: value === 'readonly'\n          });\n          break;\n        case 'asynchronous processing':\n          break;\n        case 'attachdbfilename':\n          break;\n        case 'authentication':\n          Object.assign(config, {\n            authentication_type: this._parseAuthenticationType(value, Object.keys(parsed))\n          });\n          break;\n        case 'column encryption setting':\n          break;\n        case 'connection timeout':\n          Object.assign(config, {\n            connectionTimeout: value * 1000\n          });\n          break;\n        case 'connection lifetime':\n          break;\n        case 'connectretrycount':\n          break;\n        case 'connectretryinterval':\n          Object.assign(config.options, {\n            connectionRetryInterval: value * 1000\n          });\n          break;\n        case 'context connection':\n          break;\n        case 'client id':\n          Object.assign(config, {\n            clientId: value\n          });\n          break;\n        case 'client secret':\n          Object.assign(config, {\n            clientSecret: value\n          });\n          break;\n        case 'current language':\n          Object.assign(config.options, {\n            language: value\n          });\n          break;\n        case 'data source':\n          {\n            let server = value;\n            let instanceName;\n            let port = 1433;\n            if (/^np:/i.test(server)) {\n              throw new Error('Connection via Named Pipes is not supported.');\n            }\n            if (/^tcp:/i.test(server)) {\n              server = server.substr(4);\n            }\n            const namedServerParts = /^(.*)\\\\(.*)$/.exec(server);\n            if (namedServerParts) {\n              server = namedServerParts[1].trim();\n              instanceName = namedServerParts[2].trim();\n            }\n            const serverParts = /^(.*),(.*)$/.exec(server);\n            if (serverParts) {\n              server = serverParts[1].trim();\n              port = parseInt(serverParts[2].trim(), 10);\n            } else {\n              const instanceParts = /^(.*),(.*)$/.exec(instanceName);\n              if (instanceParts) {\n                instanceName = instanceParts[1].trim();\n                port = parseInt(instanceParts[2].trim(), 10);\n              }\n            }\n            if (server === '.' || server === '(.)' || server.toLowerCase() === '(localdb)' || server.toLowerCase() === '(local)') {\n              server = 'localhost';\n            }\n            Object.assign(config, {\n              port,\n              server\n            });\n            if (instanceName) {\n              Object.assign(config.options, {\n                instanceName\n              });\n            }\n            break;\n          }\n        case 'encrypt':\n          Object.assign(config.options, {\n            encrypt: !!value\n          });\n          break;\n        case 'enlist':\n          break;\n        case 'failover partner':\n          break;\n        case 'initial catalog':\n          Object.assign(config, {\n            database: value\n          });\n          break;\n        case 'integrated security':\n          break;\n        case 'max pool size':\n          Object.assign(config.pool, {\n            max: value\n          });\n          break;\n        case 'min pool size':\n          Object.assign(config.pool, {\n            min: value\n          });\n          break;\n        case 'msi endpoint':\n          Object.assign(config, {\n            msiEndpoint: value\n          });\n          break;\n        case 'msi secret':\n          Object.assign(config, {\n            msiSecret: value\n          });\n          break;\n        case 'multipleactiveresultsets':\n          break;\n        case 'multisubnetfailover':\n          Object.assign(config.options, {\n            multiSubnetFailover: value\n          });\n          break;\n        case 'network library':\n          break;\n        case 'packet size':\n          Object.assign(config.options, {\n            packetSize: value\n          });\n          break;\n        case 'password':\n          Object.assign(config, {\n            password: value\n          });\n          break;\n        case 'persist security info':\n          break;\n        case 'poolblockingperiod':\n          break;\n        case 'pooling':\n          break;\n        case 'replication':\n          break;\n        case 'tenant id':\n          Object.assign(config, {\n            tenantId: value\n          });\n          break;\n        case 'token':\n          Object.assign(config, {\n            token: value\n          });\n          break;\n        case 'transaction binding':\n          Object.assign(config.options, {\n            enableImplicitTransactions: value.toLowerCase() === 'implicit unbind'\n          });\n          break;\n        case 'transparentnetworkipresolution':\n          break;\n        case 'trustservercertificate':\n          Object.assign(config.options, {\n            trustServerCertificate: value\n          });\n          break;\n        case 'type system version':\n          break;\n        case 'user id':\n          {\n            let user = value;\n            let domain;\n            const domainUser = /^(.*)\\\\(.*)$/.exec(user);\n            if (domainUser) {\n              domain = domainUser[1];\n              user = domainUser[2];\n            }\n            if (domain) {\n              Object.assign(config, {\n                domain\n              });\n            }\n            if (user) {\n              Object.assign(config, {\n                user\n              });\n            }\n            break;\n          }\n        case 'user instance':\n          break;\n        case 'workstation id':\n          Object.assign(config.options, {\n            workstationId: value\n          });\n          break;\n        case 'request timeout':\n          Object.assign(config, {\n            requestTimeout: parseInt(value, 10)\n          });\n          break;\n        case 'stream':\n          Object.assign(config, {\n            stream: !!value\n          });\n          break;\n        case 'useutc':\n          Object.assign(config.options, {\n            useUTC: !!value\n          });\n          break;\n        case 'parsejson':\n          Object.assign(config, {\n            parseJSON: !!value\n          });\n          break;\n      }\n      return config;\n    }, {\n      options: {},\n      pool: {}\n    });\n  }\n\n  /**\n   * Acquire connection from this connection pool.\n   *\n   * @param {ConnectionPool|Transaction|PreparedStatement} requester Requester.\n   * @param {acquireCallback} [callback] A callback which is called after connection has been acquired, or an error has occurred. If omited, method returns Promise.\n   * @return {ConnectionPool|Promise}\n   */\n\n  acquire(requester, callback) {\n    const acquirePromise = shared.Promise.resolve(this._acquire()).catch(err => {\n      this.emit('error', err);\n      throw err;\n    });\n    if (typeof callback === 'function') {\n      acquirePromise.then(connection => callback(null, connection, this.config)).catch(callback);\n      return this;\n    }\n    return acquirePromise;\n  }\n  _acquire() {\n    if (!this.pool) {\n      return shared.Promise.reject(new ConnectionError('Connection not yet open.', 'ENOTOPEN'));\n    } else if (this.pool.destroyed) {\n      return shared.Promise.reject(new ConnectionError('Connection is closing', 'ENOTOPEN'));\n    }\n    return this.pool.acquire().promise;\n  }\n\n  /**\n   * Release connection back to the pool.\n   *\n   * @param {Connection} connection Previously acquired connection.\n   * @return {ConnectionPool}\n   */\n\n  release(connection) {\n    debug('connection(%d): released', IDS.get(connection));\n    if (this.pool) {\n      this.pool.release(connection);\n    }\n    return this;\n  }\n\n  /**\n   * Creates a new connection pool with one active connection. This one initial connection serves as a probe to find out whether the configuration is valid.\n   *\n   * @param {basicCallback} [callback] A callback which is called after connection has established, or an error has occurred. If omited, method returns Promise.\n   * @return {ConnectionPool|Promise}\n   */\n\n  connect(callback) {\n    if (typeof callback === 'function') {\n      this._connect(callback);\n      return this;\n    }\n    return new shared.Promise((resolve, reject) => {\n      return this._connect(err => {\n        if (err) return reject(err);\n        resolve(this);\n      });\n    });\n  }\n\n  /**\n   * @private\n   * @param {basicCallback} callback\n   */\n\n  _connect(callback) {\n    if (this._connected) {\n      debug('pool(%d): already connected, executing connect callback immediately', IDS.get(this));\n      return setImmediate(callback, null, this);\n    }\n    this._connectStack.push(callback);\n    if (this._connecting) {\n      return;\n    }\n    this._connecting = true;\n    debug('pool(%d): connecting', IDS.get(this));\n\n    // create one test connection to check if everything is ok\n    this._poolCreate().then(connection => {\n      debug('pool(%d): connected', IDS.get(this));\n      this._healthy = true;\n      return this._poolDestroy(connection).then(() => {\n        // prepare pool\n        this.pool = new tarn.Pool(Object.assign({\n          create: () => this._poolCreate().then(connection => {\n            this._healthy = true;\n            return connection;\n          }).catch(err => {\n            if (this.pool.numUsed() + this.pool.numFree() <= 0) {\n              this._healthy = false;\n            }\n            throw err;\n          }),\n          validate: this._poolValidate.bind(this),\n          destroy: this._poolDestroy.bind(this),\n          max: 10,\n          min: 0,\n          idleTimeoutMillis: 30000,\n          propagateCreateError: true\n        }, this.config.pool));\n        this._connecting = false;\n        this._connected = true;\n      });\n    }).then(() => {\n      this._connectStack.forEach(cb => {\n        setImmediate(cb, null, this);\n      });\n    }).catch(err => {\n      this._connecting = false;\n      this._connectStack.forEach(cb => {\n        setImmediate(cb, err);\n      });\n    }).then(() => {\n      this._connectStack = [];\n    });\n  }\n  get size() {\n    return this.pool.numFree() + this.pool.numUsed() + this.pool.numPendingCreates();\n  }\n  get available() {\n    return this.pool.numFree();\n  }\n  get pending() {\n    return this.pool.numPendingAcquires();\n  }\n  get borrowed() {\n    return this.pool.numUsed();\n  }\n\n  /**\n   * Close all active connections in the pool.\n   *\n   * @param {basicCallback} [callback] A callback which is called after connection has closed, or an error has occurred. If omited, method returns Promise.\n   * @return {ConnectionPool|Promise}\n   */\n\n  close(callback) {\n    if (typeof callback === 'function') {\n      this._close(callback);\n      return this;\n    }\n    return new shared.Promise((resolve, reject) => {\n      this._close(err => {\n        if (err) return reject(err);\n        resolve(this);\n      });\n    });\n  }\n\n  /**\n   * @private\n   * @param {basicCallback} callback\n   */\n\n  _close(callback) {\n    // we don't allow pools in a connecting state to be closed because it means there are far too many\n    // edge cases to deal with\n    if (this._connecting) {\n      debug('pool(%d): close called while connecting', IDS.get(this));\n      setImmediate(callback, new ConnectionError('Cannot close a pool while it is connecting'));\n    }\n    if (!this.pool) {\n      debug('pool(%d): already closed, executing close callback immediately', IDS.get(this));\n      return setImmediate(callback, null);\n    }\n    this._closeStack.push(callback);\n    if (this.pool.destroyed) return;\n    this._connecting = this._connected = this._healthy = false;\n    this.pool.destroy().then(() => {\n      debug('pool(%d): pool closed, removing pool reference and executing close callbacks', IDS.get(this));\n      this.pool = null;\n      this._closeStack.forEach(cb => {\n        setImmediate(cb, null);\n      });\n    }).catch(err => {\n      this.pool = null;\n      this._closeStack.forEach(cb => {\n        setImmediate(cb, err);\n      });\n    }).then(() => {\n      this._closeStack = [];\n    });\n  }\n\n  /**\n   * Returns new request using this connection.\n   *\n   * @return {Request}\n   */\n\n  request() {\n    return new shared.driver.Request(this);\n  }\n\n  /**\n   * Returns new transaction using this connection.\n   *\n   * @return {Transaction}\n   */\n\n  transaction() {\n    return new shared.driver.Transaction(this);\n  }\n\n  /**\n   * Creates a new query using this connection from a tagged template string.\n   *\n   * @variation 1\n   * @param {Array} strings Array of string literals.\n   * @param {...*} keys Values.\n   * @return {Request}\n   */\n\n  /**\n   * Execute the SQL command.\n   *\n   * @variation 2\n   * @param {String} command T-SQL command to be executed.\n   * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n   * @return {Request|Promise}\n   */\n\n  query() {\n    if (typeof arguments[0] === 'string') {\n      return new shared.driver.Request(this).query(arguments[0], arguments[1]);\n    }\n    const values = Array.prototype.slice.call(arguments);\n    const strings = values.shift();\n    return new shared.driver.Request(this)._template(strings, values, 'query');\n  }\n\n  /**\n   * Creates a new batch using this connection from a tagged template string.\n   *\n   * @variation 1\n   * @param {Array} strings Array of string literals.\n   * @param {...*} keys Values.\n   * @return {Request}\n   */\n\n  /**\n   * Execute the SQL command.\n   *\n   * @variation 2\n   * @param {String} command T-SQL command to be executed.\n   * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n   * @return {Request|Promise}\n   */\n\n  batch() {\n    if (typeof arguments[0] === 'string') {\n      return new shared.driver.Request(this).batch(arguments[0], arguments[1]);\n    }\n    const values = Array.prototype.slice.call(arguments);\n    const strings = values.shift();\n    return new shared.driver.Request(this)._template(strings, values, 'batch');\n  }\n}\nmodule.exports = ConnectionPool;","map":{"version":3,"names":["EventEmitter","require","debug","parseSqlConnectionString","tarn","IDS","ConnectionError","shared","clone","MSSQLError","ConnectionPool","constructor","config","callback","add","get","_connectStack","_closeStack","_connected","_connecting","_healthy","parseConnectionString","ex","setImmediate","port","options","stream","parseJSON","arrayRowMode","validateConnection","namedServer","exec","server","instanceName","useColumnNames","connect","connected","connecting","healthy","connectionString","_parseConnectionString","_parseAuthenticationType","type","entries","toLowerCase","includes","every","entry","parsed","Object","reduce","key","value","assign","readOnlyIntent","authentication_type","keys","connectionTimeout","connectionRetryInterval","clientId","clientSecret","language","test","Error","substr","namedServerParts","trim","serverParts","parseInt","instanceParts","encrypt","database","pool","max","min","msiEndpoint","msiSecret","multiSubnetFailover","packetSize","password","tenantId","token","enableImplicitTransactions","trustServerCertificate","user","domain","domainUser","workstationId","requestTimeout","useUTC","acquire","requester","acquirePromise","Promise","resolve","_acquire","catch","err","emit","then","connection","reject","destroyed","promise","release","_connect","push","_poolCreate","_poolDestroy","Pool","create","numUsed","numFree","validate","_poolValidate","bind","destroy","idleTimeoutMillis","propagateCreateError","forEach","cb","size","numPendingCreates","available","pending","numPendingAcquires","borrowed","close","_close","request","driver","Request","transaction","Transaction","query","arguments","values","Array","prototype","slice","call","strings","shift","_template","batch","module","exports"],"sources":["C:/Users/phlos/wv-temperature-map/src/backend/node_modules/mssql/lib/base/connection-pool.js"],"sourcesContent":["'use strict'\n\nconst { EventEmitter } = require('node:events')\nconst debug = require('debug')('mssql:base')\nconst { parseSqlConnectionString } = require('@tediousjs/connection-string')\nconst tarn = require('tarn')\nconst { IDS } = require('../utils')\nconst ConnectionError = require('../error/connection-error')\nconst shared = require('../shared')\nconst clone = require('rfdc/default')\nconst { MSSQLError } = require('../error')\n\n/**\n * Class ConnectionPool.\n *\n * Internally, each `Connection` instance is a separate pool of TDS connections. Once you create a new `Request`/`Transaction`/`Prepared Statement`, a new TDS connection is acquired from the pool and reserved for desired action. Once the action is complete, connection is released back to the pool.\n *\n * @property {Boolean} connected If true, connection is established.\n * @property {Boolean} connecting If true, connection is being established.\n *\n * @fires ConnectionPool#connect\n * @fires ConnectionPool#close\n */\n\nclass ConnectionPool extends EventEmitter {\n  /**\n   * Create new Connection.\n   *\n   * @param {Object|String} config Connection configuration object or connection string.\n   * @param {basicCallback} [callback] A callback which is called after connection has established, or an error has occurred.\n   */\n\n  constructor (config, callback) {\n    super()\n\n    IDS.add(this, 'ConnectionPool')\n    debug('pool(%d): created', IDS.get(this))\n\n    this._connectStack = []\n    this._closeStack = []\n\n    this._connected = false\n    this._connecting = false\n    this._healthy = false\n\n    if (typeof config === 'string') {\n      try {\n        this.config = this.constructor.parseConnectionString(config)\n      } catch (ex) {\n        if (typeof callback === 'function') {\n          return setImmediate(callback, ex)\n        }\n        throw ex\n      }\n    } else {\n      this.config = clone(config)\n    }\n\n    // set defaults\n    this.config.port = this.config.port || 1433\n    this.config.options = this.config.options || {}\n    this.config.stream = this.config.stream || false\n    this.config.parseJSON = this.config.parseJSON || false\n    this.config.arrayRowMode = this.config.arrayRowMode || false\n    this.config.validateConnection = 'validateConnection' in this.config ? this.config.validateConnection : true\n\n    const namedServer = /^(.*)\\\\(.*)$/.exec(this.config.server)\n    if (namedServer) {\n      this.config.server = namedServer[1]\n      this.config.options.instanceName = namedServer[2]\n    }\n\n    if (typeof this.config.options.useColumnNames !== 'undefined' && this.config.options.useColumnNames !== true) {\n      const ex = new MSSQLError('Invalid options `useColumnNames`, use `arrayRowMode` instead')\n      if (typeof callback === 'function') {\n        return setImmediate(callback, ex)\n      }\n      throw ex\n    }\n\n    if (typeof callback === 'function') {\n      this.connect(callback)\n    }\n  }\n\n  get connected () {\n    return this._connected\n  }\n\n  get connecting () {\n    return this._connecting\n  }\n\n  get healthy () {\n    return this._healthy\n  }\n\n  static parseConnectionString (connectionString) {\n    return this._parseConnectionString(connectionString)\n  }\n\n  static _parseAuthenticationType (type, entries) {\n    switch (type.toLowerCase()) {\n      case 'active directory integrated':\n        if (entries.includes('token')) {\n          return 'azure-active-directory-access-token'\n        } else if (['client id', 'client secret', 'tenant id'].every(entry => entries.includes(entry))) {\n          return 'azure-active-directory-service-principal-secret'\n        } else if (['client id', 'msi endpoint', 'msi secret'].every(entry => entries.includes(entry))) {\n          return 'azure-active-directory-msi-app-service'\n        } else if (['client id', 'msi endpoint'].every(entry => entries.includes(entry))) {\n          return 'azure-active-directory-msi-vm'\n        }\n        return 'azure-active-directory-default'\n      case 'active directory password':\n        return 'azure-active-directory-password'\n      case 'ntlm':\n        return 'ntlm'\n      default:\n        return 'default'\n    }\n  }\n\n  static _parseConnectionString (connectionString) {\n    const parsed = parseSqlConnectionString(connectionString, true, true)\n    return Object.entries(parsed).reduce((config, [key, value]) => {\n      switch (key) {\n        case 'application name':\n          break\n        case 'applicationintent':\n          Object.assign(config.options, {\n            readOnlyIntent: value === 'readonly'\n          })\n          break\n        case 'asynchronous processing':\n          break\n        case 'attachdbfilename':\n          break\n        case 'authentication':\n          Object.assign(config, {\n            authentication_type: this._parseAuthenticationType(value, Object.keys(parsed))\n          })\n          break\n        case 'column encryption setting':\n          break\n        case 'connection timeout':\n          Object.assign(config, {\n            connectionTimeout: value * 1000\n          })\n          break\n        case 'connection lifetime':\n          break\n        case 'connectretrycount':\n          break\n        case 'connectretryinterval':\n          Object.assign(config.options, {\n            connectionRetryInterval: value * 1000\n          })\n          break\n        case 'context connection':\n          break\n        case 'client id':\n          Object.assign(config, {\n            clientId: value\n          })\n          break\n        case 'client secret':\n          Object.assign(config, {\n            clientSecret: value\n          })\n          break\n        case 'current language':\n          Object.assign(config.options, {\n            language: value\n          })\n          break\n        case 'data source':\n        {\n          let server = value\n          let instanceName\n          let port = 1433\n          if (/^np:/i.test(server)) {\n            throw new Error('Connection via Named Pipes is not supported.')\n          }\n          if (/^tcp:/i.test(server)) {\n            server = server.substr(4)\n          }\n          const namedServerParts = /^(.*)\\\\(.*)$/.exec(server)\n          if (namedServerParts) {\n            server = namedServerParts[1].trim()\n            instanceName = namedServerParts[2].trim()\n          }\n          const serverParts = /^(.*),(.*)$/.exec(server)\n          if (serverParts) {\n            server = serverParts[1].trim()\n            port = parseInt(serverParts[2].trim(), 10)\n          } else {\n            const instanceParts = /^(.*),(.*)$/.exec(instanceName)\n            if (instanceParts) {\n              instanceName = instanceParts[1].trim()\n              port = parseInt(instanceParts[2].trim(), 10)\n            }\n          }\n          if (server === '.' || server === '(.)' || server.toLowerCase() === '(localdb)' || server.toLowerCase() === '(local)') {\n            server = 'localhost'\n          }\n          Object.assign(config, {\n            port,\n            server\n          })\n          if (instanceName) {\n            Object.assign(config.options, {\n              instanceName\n            })\n          }\n          break\n        }\n        case 'encrypt':\n          Object.assign(config.options, {\n            encrypt: !!value\n          })\n          break\n        case 'enlist':\n          break\n        case 'failover partner':\n          break\n        case 'initial catalog':\n          Object.assign(config, {\n            database: value\n          })\n          break\n        case 'integrated security':\n          break\n        case 'max pool size':\n          Object.assign(config.pool, {\n            max: value\n          })\n          break\n        case 'min pool size':\n          Object.assign(config.pool, {\n            min: value\n          })\n          break\n        case 'msi endpoint':\n          Object.assign(config, {\n            msiEndpoint: value\n          })\n          break\n        case 'msi secret':\n          Object.assign(config, {\n            msiSecret: value\n          })\n          break\n        case 'multipleactiveresultsets':\n          break\n        case 'multisubnetfailover':\n          Object.assign(config.options, {\n            multiSubnetFailover: value\n          })\n          break\n        case 'network library':\n          break\n        case 'packet size':\n          Object.assign(config.options, {\n            packetSize: value\n          })\n          break\n        case 'password':\n          Object.assign(config, {\n            password: value\n          })\n          break\n        case 'persist security info':\n          break\n        case 'poolblockingperiod':\n          break\n        case 'pooling':\n          break\n        case 'replication':\n          break\n        case 'tenant id':\n          Object.assign(config, {\n            tenantId: value\n          })\n          break\n        case 'token':\n          Object.assign(config, {\n            token: value\n          })\n          break\n        case 'transaction binding':\n          Object.assign(config.options, {\n            enableImplicitTransactions: value.toLowerCase() === 'implicit unbind'\n          })\n          break\n        case 'transparentnetworkipresolution':\n          break\n        case 'trustservercertificate':\n          Object.assign(config.options, {\n            trustServerCertificate: value\n          })\n          break\n        case 'type system version':\n          break\n        case 'user id': {\n          let user = value\n          let domain\n          const domainUser = /^(.*)\\\\(.*)$/.exec(user)\n          if (domainUser) {\n            domain = domainUser[1]\n            user = domainUser[2]\n          }\n          if (domain) {\n            Object.assign(config, {\n              domain\n            })\n          }\n          if (user) {\n            Object.assign(config, {\n              user\n            })\n          }\n          break\n        }\n        case 'user instance':\n          break\n        case 'workstation id':\n          Object.assign(config.options, {\n            workstationId: value\n          })\n          break\n        case 'request timeout':\n          Object.assign(config, {\n            requestTimeout: parseInt(value, 10)\n          })\n          break\n        case 'stream':\n          Object.assign(config, {\n            stream: !!value\n          })\n          break\n        case 'useutc':\n          Object.assign(config.options, {\n            useUTC: !!value\n          })\n          break\n        case 'parsejson':\n          Object.assign(config, {\n            parseJSON: !!value\n          })\n          break\n      }\n      return config\n    }, { options: {}, pool: {} })\n  }\n\n  /**\n   * Acquire connection from this connection pool.\n   *\n   * @param {ConnectionPool|Transaction|PreparedStatement} requester Requester.\n   * @param {acquireCallback} [callback] A callback which is called after connection has been acquired, or an error has occurred. If omited, method returns Promise.\n   * @return {ConnectionPool|Promise}\n   */\n\n  acquire (requester, callback) {\n    const acquirePromise = shared.Promise.resolve(this._acquire()).catch(err => {\n      this.emit('error', err)\n      throw err\n    })\n    if (typeof callback === 'function') {\n      acquirePromise.then(connection => callback(null, connection, this.config)).catch(callback)\n      return this\n    }\n\n    return acquirePromise\n  }\n\n  _acquire () {\n    if (!this.pool) {\n      return shared.Promise.reject(new ConnectionError('Connection not yet open.', 'ENOTOPEN'))\n    } else if (this.pool.destroyed) {\n      return shared.Promise.reject(new ConnectionError('Connection is closing', 'ENOTOPEN'))\n    }\n\n    return this.pool.acquire().promise\n  }\n\n  /**\n   * Release connection back to the pool.\n   *\n   * @param {Connection} connection Previously acquired connection.\n   * @return {ConnectionPool}\n   */\n\n  release (connection) {\n    debug('connection(%d): released', IDS.get(connection))\n\n    if (this.pool) {\n      this.pool.release(connection)\n    }\n    return this\n  }\n\n  /**\n   * Creates a new connection pool with one active connection. This one initial connection serves as a probe to find out whether the configuration is valid.\n   *\n   * @param {basicCallback} [callback] A callback which is called after connection has established, or an error has occurred. If omited, method returns Promise.\n   * @return {ConnectionPool|Promise}\n   */\n\n  connect (callback) {\n    if (typeof callback === 'function') {\n      this._connect(callback)\n      return this\n    }\n\n    return new shared.Promise((resolve, reject) => {\n      return this._connect(err => {\n        if (err) return reject(err)\n        resolve(this)\n      })\n    })\n  }\n\n  /**\n   * @private\n   * @param {basicCallback} callback\n   */\n\n  _connect (callback) {\n    if (this._connected) {\n      debug('pool(%d): already connected, executing connect callback immediately', IDS.get(this))\n      return setImmediate(callback, null, this)\n    }\n\n    this._connectStack.push(callback)\n\n    if (this._connecting) {\n      return\n    }\n\n    this._connecting = true\n    debug('pool(%d): connecting', IDS.get(this))\n\n    // create one test connection to check if everything is ok\n    this._poolCreate().then((connection) => {\n      debug('pool(%d): connected', IDS.get(this))\n      this._healthy = true\n\n      return this._poolDestroy(connection).then(() => {\n        // prepare pool\n        this.pool = new tarn.Pool(\n          Object.assign({\n            create: () => this._poolCreate()\n              .then(connection => {\n                this._healthy = true\n                return connection\n              })\n              .catch(err => {\n                if (this.pool.numUsed() + this.pool.numFree() <= 0) {\n                  this._healthy = false\n                }\n                throw err\n              }),\n            validate: this._poolValidate.bind(this),\n            destroy: this._poolDestroy.bind(this),\n            max: 10,\n            min: 0,\n            idleTimeoutMillis: 30000,\n            propagateCreateError: true\n          }, this.config.pool)\n        )\n\n        this._connecting = false\n        this._connected = true\n      })\n    }).then(() => {\n      this._connectStack.forEach((cb) => {\n        setImmediate(cb, null, this)\n      })\n    }).catch(err => {\n      this._connecting = false\n      this._connectStack.forEach((cb) => {\n        setImmediate(cb, err)\n      })\n    }).then(() => {\n      this._connectStack = []\n    })\n  }\n\n  get size () {\n    return this.pool.numFree() + this.pool.numUsed() + this.pool.numPendingCreates()\n  }\n\n  get available () {\n    return this.pool.numFree()\n  }\n\n  get pending () {\n    return this.pool.numPendingAcquires()\n  }\n\n  get borrowed () {\n    return this.pool.numUsed()\n  }\n\n  /**\n   * Close all active connections in the pool.\n   *\n   * @param {basicCallback} [callback] A callback which is called after connection has closed, or an error has occurred. If omited, method returns Promise.\n   * @return {ConnectionPool|Promise}\n   */\n\n  close (callback) {\n    if (typeof callback === 'function') {\n      this._close(callback)\n      return this\n    }\n\n    return new shared.Promise((resolve, reject) => {\n      this._close(err => {\n        if (err) return reject(err)\n        resolve(this)\n      })\n    })\n  }\n\n  /**\n   * @private\n   * @param {basicCallback} callback\n   */\n\n  _close (callback) {\n    // we don't allow pools in a connecting state to be closed because it means there are far too many\n    // edge cases to deal with\n    if (this._connecting) {\n      debug('pool(%d): close called while connecting', IDS.get(this))\n      setImmediate(callback, new ConnectionError('Cannot close a pool while it is connecting'))\n    }\n\n    if (!this.pool) {\n      debug('pool(%d): already closed, executing close callback immediately', IDS.get(this))\n      return setImmediate(callback, null)\n    }\n\n    this._closeStack.push(callback)\n\n    if (this.pool.destroyed) return\n\n    this._connecting = this._connected = this._healthy = false\n\n    this.pool.destroy().then(() => {\n      debug('pool(%d): pool closed, removing pool reference and executing close callbacks', IDS.get(this))\n      this.pool = null\n      this._closeStack.forEach(cb => {\n        setImmediate(cb, null)\n      })\n    }).catch(err => {\n      this.pool = null\n      this._closeStack.forEach(cb => {\n        setImmediate(cb, err)\n      })\n    }).then(() => {\n      this._closeStack = []\n    })\n  }\n\n  /**\n   * Returns new request using this connection.\n   *\n   * @return {Request}\n   */\n\n  request () {\n    return new shared.driver.Request(this)\n  }\n\n  /**\n   * Returns new transaction using this connection.\n   *\n   * @return {Transaction}\n   */\n\n  transaction () {\n    return new shared.driver.Transaction(this)\n  }\n\n  /**\n   * Creates a new query using this connection from a tagged template string.\n   *\n   * @variation 1\n   * @param {Array} strings Array of string literals.\n   * @param {...*} keys Values.\n   * @return {Request}\n   */\n\n  /**\n   * Execute the SQL command.\n   *\n   * @variation 2\n   * @param {String} command T-SQL command to be executed.\n   * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n   * @return {Request|Promise}\n   */\n\n  query () {\n    if (typeof arguments[0] === 'string') { return new shared.driver.Request(this).query(arguments[0], arguments[1]) }\n\n    const values = Array.prototype.slice.call(arguments)\n    const strings = values.shift()\n\n    return new shared.driver.Request(this)._template(strings, values, 'query')\n  }\n\n  /**\n   * Creates a new batch using this connection from a tagged template string.\n   *\n   * @variation 1\n   * @param {Array} strings Array of string literals.\n   * @param {...*} keys Values.\n   * @return {Request}\n   */\n\n  /**\n   * Execute the SQL command.\n   *\n   * @variation 2\n   * @param {String} command T-SQL command to be executed.\n   * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n   * @return {Request|Promise}\n   */\n\n  batch () {\n    if (typeof arguments[0] === 'string') { return new shared.driver.Request(this).batch(arguments[0], arguments[1]) }\n\n    const values = Array.prototype.slice.call(arguments)\n    const strings = values.shift()\n\n    return new shared.driver.Request(this)._template(strings, values, 'batch')\n  }\n}\n\nmodule.exports = ConnectionPool\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}